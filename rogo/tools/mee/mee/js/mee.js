/*DO NOT MODIFY THIS FILE*/

(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async;}
async.noConflict=function(){root.async=previous_async;return async;};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments);}}
var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator);}
for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr);}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator);}
var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a));});return results;};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo);}
_each(arr,function(x,i,a){memo=iterator(memo,x,i,a);});return memo;};var _keys=function(obj){if(Object.keys){return Object.keys(obj);}
var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k);}}
return keys;};if(typeof process==='undefined'||!(process.nextTick)){if(typeof setImmediate==='function'){async.nextTick=function(fn){setImmediate(fn);};async.setImmediate=async.nextTick;}
else{async.nextTick=function(fn){setTimeout(fn,0);};async.setImmediate=async.nextTick;}}
else{async.nextTick=process.nextTick;if(typeof setImmediate!=='undefined'){async.setImmediate=setImmediate;}
else{async.setImmediate=async.nextTick;}}
async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback();}
var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){if(err){callback(err);callback=function(){};}
else{completed+=1;if(completed>=arr.length){callback(null);}}}));});};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback();}
var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){};}
else{completed+=1;if(completed>=arr.length){callback(null);}
else{iterate();}}});};iterate();};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback]);};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback();}
var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback();}
while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){};}
else{completed+=1;running-=1;if(completed>=arr.length){callback();}
else{replenish();}}});}})();};};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args));};};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args));};};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args));};};var _asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x};});eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err);});},function(err){callback(err,results);});};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback);};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap);};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err);});},function(err){callback(err,memo);});};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x;}).reverse();async.reduce(reversed,memo,iterator,callback);};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x};});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x);}
callback();});},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index;}),function(x){return x.value;}));});};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x};});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x);}
callback();});},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index;}),function(x){return x.value;}));});};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){};}
else{callback();}});},function(err){main_callback();});};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){};}
callback();});},function(err){main_callback(false);});};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){};}
callback();});},function(err){main_callback(true);});};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err);}
else{callback(null,{value:x,criteria:criteria});}});},function(err,results){if(err){return callback(err);}
else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;};callback(null,_map(results.sort(fn),function(x){return x.value;}));}});};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length){return callback(null);}
var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn);};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return;}}};var taskComplete=function(){_each(listeners.slice(0),function(fn){fn();});};addListener(function(){if(_keys(results).length===keys.length){callback(null,results);callback=function(){};}});_each(keys,function(k){var task=(tasks[k]instanceof Function)?[tasks[k]]:tasks[k];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0];}
if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey];});safeResults[k]=args;callback(err,safeResults);callback=function(){};}
else{results[k]=args;async.setImmediate(taskComplete);}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return(a&&results.hasOwnProperty(x));},true)&&!results.hasOwnProperty(k);};if(ready()){task[task.length-1](taskCallback,results);}
else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results);}};addListener(listener);}});};async.waterfall=function(tasks,callback){callback=callback||function(){};if(tasks.constructor!==Array){var err=new Error('First argument to waterfall must be an array of functions');return callback(err);}
if(!tasks.length){return callback();}
var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){};}
else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next));}
else{args.push(callback);}
async.setImmediate(function(){iterator.apply(null,args);});}};};wrapIterator(async.iterator(tasks))();};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0];}
callback.call(null,err,args);});}},callback);}
else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0];}
results[k]=args;callback(err);});},function(err){callback(err,results);});}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback);};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback);};async.series=function(tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0];}
callback.call(null,err,args);});}},callback);}
else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0];}
results[k]=args;callback(err);});},function(err){callback(err,results);});}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments);}
return fn.next();};fn.next=function(){return(index<tasks.length-1)?makeCallback(index+1):null;};return fn;};return makeCallback(0);};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)));};};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err);});},function(err){callback(err,r);});};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err);}
async.whilst(test,iterator,callback);});}
else{callback();}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err);}
if(test()){async.doWhilst(iterator,test,callback);}
else{callback();}});};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err);}
async.until(test,iterator,callback);});}
else{callback();}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err);}
if(!test()){async.doUntil(iterator,test,callback);}
else{callback();}});};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1;}
function _insert(q,data,pos,callback){if(data.constructor!==Array){data=[data];}
_each(data,function(task){var item={data:task,callback:typeof callback==='function'?callback:null};if(pos){q.tasks.unshift(item);}else{q.tasks.push(item);}
if(q.saturated&&q.tasks.length===concurrency){q.saturated();}
async.setImmediate(q.process);});}
var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,false,callback);},unshift:function(data,callback){_insert(q,data,true,callback);},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty();}
workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments);}
if(q.drain&&q.tasks.length+workers===0){q.drain();}
q.process();};var cb=only_once(next);worker(task.data,cb);}},length:function(){return q.tasks.length;},running:function(){return workers;}};return q;};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){if(data.constructor!==Array){data=[data];}
_each(data,function(task){tasks.push({data:task,callback:typeof callback==='function'?callback:null});if(cargo.saturated&&tasks.length===payload){cargo.saturated();}});async.setImmediate(cargo.process);},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain)cargo.drain();return;}
var ts=typeof payload==='number'?tasks.splice(0,payload):tasks.splice(0);var ds=_map(ts,function(task){return task.data;});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args);}});process();});},length:function(){return tasks.length;},running:function(){return working;}};return cargo;};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=='undefined'){if(err){if(console.error){console.error(err);}}
else if(console[name]){_each(args,function(x){console[name](x);});}}}]));};};async.log=_console_fn('log');async.dir=_console_fn('dir');async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x;};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){callback.apply(null,memo[key]);}
else if(key in queues){queues[key].push(callback);}
else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments);}}]));}};memoized.memo=memo;memoized.unmemoized=fn;return memoized;};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments);};};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i);}
return async.map(counter,iterator,callback);};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i);}
return async.mapSeries(counter,iterator,callback);};async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs);}]))},function(err,results){callback.apply(that,[err].concat(results));});};};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]));},callback);};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args);}
else{return go;}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err);}
throw err;}
fn(next);}
next();};if(typeof define!=='undefined'&&define.amd){define([],function(){return async;});}
else if(typeof module!=='undefined'&&module.exports){module.exports=async;}
else{root.async=async;}}());

function isUndefined(thing){if(typeof thing=="undefined")
return true;return false;};(function($,len,createRange,duplicate){$.fn.caret=function(options,opt2){var start,end,t=this[0];if(typeof options==="object"&&typeof options.start==="number"&&typeof options.end==="number"){start=options.start;end=options.end;}else if(typeof options==="number"&&typeof opt2==="number"){start=options;end=opt2;}else if(typeof options==="string"){if((start=t.value.indexOf(options))>-1)end=start+options[len];else start=null;}else if(Object.prototype.toString.call(options)==="[object RegExp]"){var re=options.exec(t.value);if(re!=null){start=re.index;end=start+re[0][len];}}
if(typeof start!="undefined"){if(document.selection){var selRange=this[0].createTextRange();selRange.collapse(true);selRange.moveStart('character',start);selRange.moveEnd('character',end-start);selRange.select();}else{t.selectionStart=start;t.selectionEnd=end;}
t.focus();return this}else{if($(t).css('display')!="none"){t.focus();if(!isUndefined(t.selectionStart)&&!isUndefined(t.selectionEnd)){var s=t.selectionStart;var e=t.selectionEnd;}else if(document.selection){var selection=document.selection;if(t.tagName.toLowerCase()!="textarea"){var val=this.val()
var range=selection[createRange]()[duplicate]();range.moveEnd("character",val[len]);var s=(range.text==""?val[len]:val.lastIndexOf(range.text));range=selection[createRange]()[duplicate]();range.moveStart("character",-val[len]);var e=range.text[len];}else{var range=selection[createRange]();var stored_range=range[duplicate]();stored_range.moveToElementText(t);stored_range.setEndPoint('EndToEnd',range);var s=stored_range.text[len]-range.text[len];var e=s+range.text[len];}}else if($(t).css('display')!="none"){var s=t.selectionStart;var e=t.selectionEnd;}}else{var s=0;var e=0;}
var te=t.value.substring(s,e);return{start:s,end:e,text:te,replace:function(st){return t.value.substring(0,s)+st+t.value.substring(e,t.value[len])}}}}})(jQuery,"length","createRange","duplicate");

(function($){var regs={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},getNext=function(current,nextPart,add){return current[nextPart]||(add&&(current[nextPart]={}));},isContainer=function(current){var type=typeof current;return type&&(type=='function'||type=='object');},getObject=function(objectName,roots,add){var parts=objectName?objectName.split(regs.dot):[],length=parts.length,currents=$.isArray(roots)?roots:[roots||window],current,ret,i,c=0,type;if(length==0){return currents[0];}
while(current=currents[c++]){for(i=0;i<length-1&&isContainer(current);i++){current=getNext(current,parts[i],add);}
if(isContainer(current)){ret=getNext(current,parts[i],add);if(ret!==undefined){if(add===false){delete current[parts[i]];}
return ret;}}}},str=$.String=$.extend($.String||{},{getObject:getObject,capitalize:function(s,cache){return s.charAt(0).toUpperCase()+s.substr(1);},camelize:function(s){s=str.classize(s);return s.charAt(0).toLowerCase()+s.substr(1);},classize:function(s,join){var parts=s.split(regs.undHash),i=0;for(;i<parts.length;i++){parts[i]=str.capitalize(parts[i]);}
return parts.join(join||'');},niceName:function(s){str.classize(parts[i],' ');},underscore:function(s){return s.replace(regs.colons,'/').replace(regs.words,'$1_$2').replace(regs.lowUp,'$1_$2').replace(regs.dash,'_').toLowerCase();},sub:function(s,data,remove){var obs=[];obs.push(s.replace(regs.replacer,function(whole,inside){var ob=getObject(inside,data,typeof remove=='boolean'?!remove:remove),type=typeof ob;if((type==='object'||type==='function')&&type!==null){obs.push(ob);return"";}else{return""+ob;}}));return obs.length<=1?obs[0]:obs;}});})(jQuery);(function($){var initializing=false,makeArray=$.makeArray,isFunction=$.isFunction,isArray=$.isArray,extend=$.extend,concatArgs=function(arr,args){return arr.concat(makeArray(args));},fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/,inheritProps=function(newProps,oldProps,addTo){addTo=addTo||newProps
for(var name in newProps){addTo[name]=isFunction(newProps[name])&&isFunction(oldProps[name])&&fnTest.test(newProps[name])?(function(name,fn){return function(){var tmp=this._super,ret;this._super=oldProps[name];ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,newProps[name]):newProps[name];}},clss=$.Class=function(){if(arguments.length){clss.extend.apply(clss,arguments);}};extend(clss,{callback:function(funcs){var args=makeArray(arguments),self;funcs=args.shift();if(!isArray(funcs)){funcs=[funcs];}
self=this;return function class_cb(){var cur=concatArgs(makeArray(this),concatArgs(args,arguments)),isString,length=funcs.length,f=0,func;for(;f<length;f++){func=funcs[f];if(!func){continue;}
isString=typeof func=="string";if(isString&&self._set_called){self.called=func;}
cur=(isString?self[func]:func).apply(self,cur||[]);if(f<length-1){cur=!isArray(cur)||cur._use_call?[cur]:cur}}
return cur;}},getObject:$.String.getObject,newInstance:function(){var inst=this.rawInstance(),args;if(inst.setup){args=inst.setup.apply(inst,arguments);}
if(inst.init){inst.init.apply(inst,isArray(args)?args:arguments);}
return inst;},setup:function(baseClass,fullName){this.defaults=extend(true,{},baseClass.defaults,this.defaults);return arguments;},rawInstance:function(){initializing=true;var inst=new this();initializing=false;return inst;},extend:function(fullName,klass,proto){if(typeof fullName!='string'){proto=klass;klass=fullName;fullName=null;}
if(!proto){proto=klass;klass=null;}
proto=proto||{};var _super_class=this,_super=this.prototype,name,shortName,namespace,prototype;initializing=true;prototype=new this();initializing=false;inheritProps(proto,_super,prototype);function Class(){if(initializing)return;if(this.constructor!==Class&&arguments.length){return arguments.callee.extend.apply(arguments.callee,arguments)}else{return this.Class.newInstance.apply(this.Class,arguments)}}
for(name in this){if(this.hasOwnProperty(name)){Class[name]=this[name];}}
inheritProps(klass,this,Class);if(fullName){var parts=fullName.split(/\./),shortName=parts.pop(),current=clss.getObject(parts.join('.'),window,true),namespace=current;current[shortName]=Class;}
extend(Class,{prototype:prototype,namespace:namespace,shortName:shortName,constructor:Class,fullName:fullName});Class.prototype.Class=Class.prototype.constructor=Class;var args=Class.setup.apply(Class,concatArgs([_super_class],arguments));if(Class.init){Class.init.apply(Class,args||[]);}
return Class;}})
clss.prototype.callback=clss.callback;})(jQuery)

var pxemScope=new Object();$.fn.toEm=function(settings){settings=jQuery.extend({scope:'body'},settings);if(this[0]==undefined)
return 0;var that=parseInt(this[0],10);var scopeVal=$(settings.scope).css('font-size');if(scopeVal){scopeVal=scopeVal.replace('px','');scopeVal=parseInt(scopeVal);}else{var scopeTest=jQuery('<div style="display: none; font-size: 1em; margin: 0; padding:0; height: auto; line-height: 1; border:0;">&nbsp;</div>').appendTo(settings.scope);scopeVal=scopeTest.height();scopeTest.remove();}
return(that/scopeVal).toFixed(8);};$.fn.toPx=function(settings){settings=jQuery.extend({scope:'body'},settings);if(this[0]==undefined)
return 0;var that=parseFloat(this[0]);var scopeVal=$(settings.scope).css('font-size');if(scopeVal){scopeVal=scopeVal.replace('px','');scopeVal=parseInt(scopeVal);}else{var scopeTest=jQuery('<div style="display: none; font-size: 1em; margin: 0; padding:0; height: auto; line-height: 1; border:0;">&nbsp;</div>').appendTo(settings.scope);scopeVal=scopeTest.height();scopeTest.remove();}
return Math.round(that*scopeVal);};function hasTall(text){var nontallchars=['a','c','e','g','m','n','o','p','q','r','s','u','v','w','x','y','z'];for(var i=0;i<text.length;i++){if(nontallchars.indexOf(text.charAt(i))==-1)
return true;}
return false;}
function isArray(){if(typeof arguments[0]=='object'){var criterion=arguments[0].constructor.toString().match(/array/i);return(criterion!=null);}return false;}

(function($){var supportsBorderImage=false;var borderImageStyle;if($.browser.safari){supportsBorderImage=true;borderImageStyle='-webkit-border-image';}else if($.browser.mozilla&&$.browser.version.substr(0,3)=="1.9"&&parseFloat($.browser.version.substr(3))>1.0){supportsBorderImage=true;borderImageStyle='-moz-border-image';}
$.fn.extend({scale9Grid:function(settings){var gridTop=settings.top||0;var gridBottom=settings.bottom||0;var gridLeft=settings.left||0;var gridRight=settings.right||0;return $(this).each(function(){var $target=$(this);if($target.data('layoutGrid')){$target.remove9Grid();}
$target.data('oldstyle',$target.attr('style'));var backgroundImage=$target.css('background-image');var match=/url\("?([^\(\)"]+)"?\)/i.exec(backgroundImage);if(!match||match.length<2){return;}
var backgroundUrl=match[1];if($.browser.msie&&$.browser.version<7&&$target.css('float')!='none'&&$target.css('position')=='static'){$target.css('position','relative');}
$target.wrapInner('<div class="s9gwrapper"></div>');var $wrapper=$target.find('.s9gwrapper');$wrapper.css({'padding-left':$target.css('padding-left'),'padding-right':$target.css('padding-right'),'padding-top':$target.css('padding-top'),'padding-bottom':$target.css('padding-bottom'),'text-align':$target.css('text-align'),'position':'relative','z-index':'2','display':'block','background-color':'transparent','background-image':'none'});$target.css({'background-color':'transparent','background-image':'none','border-color':'transparent','padding':'0','text-align':'left'});var backgroundElement=document.createElement('div');$target.prepend(backgroundElement);var $background=$(backgroundElement);$background.css({'position':'relative','width':'0px','height':'0px','z-index':'0','display':'block'});$background.addClass('s9gbackground');if(supportsBorderImage){var cssProperties={'border-width':gridTop+'px '+gridRight+'px '+gridBottom+'px '+gridLeft+'px ','position':'absolute'}
cssProperties[borderImageStyle]=backgroundImage+' '+gridTop+' '+gridRight+' '+gridBottom+' '+gridLeft+' stretch stretch';$background.css(cssProperties);}
var imageWidth;var imageHeight;var lastWidth=0;var lastHeight=0;var cells=new Array();var layoutGrid=function(){var width=$target.innerWidth();var height=$target.innerHeight();if(width<gridLeft+gridRight||height<gridTop+gridBottom||(width==lastWidth&&height==lastHeight)){return;}
if(supportsBorderImage){$background.css({'width':width-gridLeft-gridRight+'px','height':height-gridTop-gridBottom+'px'})
return;}
lastWidth=width;lastHeight=height;var cellIndex=0;var existingCells=cells.length;for(var y=0;y<height;){var cellHeight;var verticalPosition;if(y==0){verticalPosition="top";cellHeight=Math.min(imageHeight-gridBottom,height-gridBottom);}
else if(y+imageHeight-gridTop>=height){verticalPosition="bottom";cellHeight=height-y;}
else{verticalPosition="center";cellHeight=Math.min(imageHeight-gridTop-gridBottom,height-y-gridBottom);}
for(var x=0;x<width;cellIndex++){var $cell;if(cellIndex<existingCells){$cell=cells[cellIndex];}
else{cellElement=document.createElement('div');$background.append(cellElement);$cell=$(cellElement);$cell.css({'position':'absolute','background-image':backgroundImage});cells.push($cell);}
var cellWidth;var horizontalPosition;if(x==0){horizontalPosition="left";cellWidth=Math.min(imageWidth-gridRight,width-gridRight);}
else if(x+imageWidth-gridBottom>=width){horizontalPosition="right";cellWidth=width-x;}
else{horizontalPosition="center";cellWidth=Math.min(imageWidth-gridLeft-gridRight,width-x-gridRight);}
$cell.css({'left':x+'px','top':y+'px','width':cellWidth+'px','height':cellHeight+'px','background-position':verticalPosition+' '+horizontalPosition});x+=cellWidth;}
y+=cellHeight;}
for(var i=cellIndex;i<existingCells;i++){cells[i].remove();}
cells.splice(cellIndex,cells.length-cellIndex);};var image=new Image();$(image).load(function(){if(image.width<gridLeft+gridRight||image.height<gridTop+gridBottom){return;}
imageWidth=image.width;imageHeight=image.height;layoutGrid();$(window).resize(layoutGrid);}).attr('src',backgroundUrl);$target.data('layoutGrid',layoutGrid);});},remove9Grid:function(){return $(this).each(function(){var $target=$(this);if(!$target.data('layoutGrid'))
return;$(window).unbind('resize',$target.data('layoutGrid'));var oldstyle=$target.data('oldstyle');$target.attr('style',oldstyle);$target.css('background-image','');var content=$target.find('.s9gwrapper').contents();$target.prepend(content);$target.find('.s9gwrapper').remove();$target.find('.s9gbackground').remove();$target.removeData('layoutGrid');});}});})(jQuery);

(function($){$.fn.autoResize=function(options){var settings=$.extend({onResize:function(){},animate:true,animateDuration:150,animateCallback:function(){},extraSpace:20,limit:1000},options);this.filter('textarea').each(function(){var textarea=$(this).css({resize:'none','overflow-y':'hidden'}),origHeight=textarea.height(),clone=(function(){var props=['height','width','lineHeight','textDecoration','letterSpacing'],propOb={};$.each(props,function(i,prop){propOb[prop]=textarea.css(prop);});return textarea.clone().removeAttr('id').removeAttr('name').css({position:'absolute',top:0,left:-9999}).css(propOb).attr('tabIndex','-1').insertBefore(textarea);})(),lastScrollTop=null,updateSize=function(){clone.height(0).val($(this).val()).scrollTop(10000);var scrollTop=Math.max(clone.scrollTop(),origHeight)+settings.extraSpace,toChange=$(this).add(clone);if(lastScrollTop===scrollTop){return;}
lastScrollTop=scrollTop;if(scrollTop>=settings.limit){$(this).css('overflow-y','');return;}
settings.onResize.call(this);settings.animate&&textarea.css('display')==='block'?toChange.stop().animate({height:scrollTop},settings.animateDuration,settings.animateCallback):toChange.height(scrollTop);};textarea.unbind('.dynSiz').bind('keyup.dynSiz',updateSize).bind('keydown.dynSiz',updateSize).bind('change.dynSiz',updateSize);});return this;};})(jQuery);

jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}};

var JSON;if(!JSON){JSON={};}
(function(){"use strict";function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());
;if(window.jQuery)(function($){$.extend({xml2json:function(xml,extended){if(!xml)return{};function parseXML(node,simple){if(!node)return null;var txt='',obj=null,att=null;var nt=node.nodeType,nn=jsVar(node.localName||node.nodeName);var nv=node.text||node.nodeValue||'';if(node.childNodes){if(node.childNodes.length>0){$.each(node.childNodes,function(n,cn){var cnt=cn.nodeType,cnn=jsVar(cn.localName||cn.nodeName);var cnv=cn.text||cn.nodeValue||'';if(cnt==8){return;}
else if(cnt==3||cnt==4||!cnn){if(cnv.match(/^\s+$/)){return;};txt+=cnv.replace(/^\s+/,'').replace(/\s+$/,'');}
else{obj=obj||{};if(obj[cnn]){if(!obj[cnn].length)obj[cnn]=myArr(obj[cnn]);obj[cnn][obj[cnn].length]=parseXML(cn,true);obj[cnn].length=obj[cnn].length;}
else{obj[cnn]=parseXML(cn);};};});};};if(node.attributes){if(node.attributes.length>0){att={};obj=obj||{};$.each(node.attributes,function(a,at){var atn=jsVar(at.name),atv=at.value;att[atn]=atv;if(obj[atn]){if(!obj[atn].length)obj[atn]=myArr(obj[atn]);obj[atn][obj[atn].length]=atv;obj[atn].length=obj[atn].length;}
else{obj[atn]=atv;};});};};if(obj){obj=$.extend((txt!=''?new String(txt):{}),obj||{});txt=(obj.text)?(typeof(obj.text)=='object'?obj.text:[obj.text||'']).concat([txt]):txt;if(txt)obj.text=txt;txt='';};var out=obj||txt;if(extended){if(txt)out={};txt=out.text||txt||'';if(txt)out.text=txt;if(!simple)out=myArr(out);};return out;};var jsVar=function(s){return String(s||'').replace(/-/g,"_");};var isNum=function(s){return(typeof s=="number")||String((s&&typeof s=="string")?s:'').test(/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/);};var myArr=function(o){if(!o.length)o=[o];o.length=o.length;return o;};if(typeof xml=='string')xml=$.text2xml(xml);if(!xml.nodeType)return;if(xml.nodeType==3||xml.nodeType==4)return xml.nodeValue;var root=(xml.nodeType==9)?xml.documentElement:xml;var out=parseXML(root,true);xml=null;root=null;return out;},text2xml:function(str){var out;try{var xml=($.browser.msie)?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser();xml.async=false;}catch(e){throw new Error("XML Parser could not be instantiated")};try{if($.browser.msie)out=(xml.loadXML(str))?xml:false;else out=xml.parseFromString(str,"text/xml");}catch(e){throw new Error("Error parsing XML string")};return out;}});})(jQuery);

var filesadded=""
var mee_baseurl=null;function findBaseUrl(){$('head, body').children('script').each(function(){var script=this.src;var tofind="/mee.js";if(script.substr(script.length-tofind.length)==tofind){mee_baseurl=script.substr(0,script.length-tofind.length-2);return;}
var tofind="/mee.php";if(script.substr(script.length-tofind.length)==tofind){mee_baseurl=script.substr(0,script.length-tofind.length-2);return;}});if(!mee_baseurl)
mee_baseurl="mee/";}
findBaseUrl();document.write('<link rel="stylesheet" type="text/css" href="'+mee_baseurl+'css/combined.css"><\/link>');if(!Array.indexOf){Array.prototype.indexOf=function(obj){for(var i=0;i<this.length;i++){if(this[i]==obj){return i;}}
return-1;}}
var debug_text="";$().ready(function(){if(typeof no_auto_mee=='undefined'||!no_auto_mee){setTimeout("MEE.Base.Render();",1);}
$('.debug').html(debug_text);});

$.Class.extend("MEE.Main",{},{init:function(element){}});$.Class.extend("MEE.Latex",{init:function(){this.count=0;this.latex="";},AddText:function(string){this.latex+=string+" ";this.count++;},AddMod:function(string){this.latex+=string;},AddSet:function(more){if(more.count>1){this.latex+="{"+more.latex+"}";}else{this.latex+=more.latex;}
this.count+=more.count;},AddArg:function(more){this.latex+="{"+more.latex+"}";this.count++;},AddElem:function(more){this.latex+=more.latex+" ";this.count+=more.count;},get:function(){return this.latex;}});

MEE.Main.extend("MEE.Edit",{toolbar:null,toolbarelem:null,toolbarcache:[],currentedit:null},{active:[],element:null,init:function(element){if(!this.checkProtocol())
return;this.element=element.name;this.active[this.element]=false;this.debug=0;this.maxima=0;this.mode=-1;this.inline=false;this.symhist=new MEE.SymHist();this.parser=new MEE.Parser();this.lasttext="";this.prevlatex="";this.latex=element.value;if($(element).attr('latex'))
this.latex=$(element).attr('latex');if($(element).hasClass('inline')){this.inline=true;}
this.inputelement=element;this.inputname=element.id;if(this.debug){$(element).css('width','600px');}else{$(element).css("display","none");}
this.initHTML();this.curElemSet=null;this.modeWYSIWYG();this.createUndo();},checkProtocol:function(){if(document.location.protocol=='file:'&&$.browser.safari){alert("The eeditor does not work properly on the local file system due to security settings in your browser. Please use a real webserver.");return false;}
return true;},initHTML:function(){this.editdiv=$('<div>');this.editdiv.addClass('mee_edit');this.editdiv.addClass($(this.inputelement).attr('class'));$(this.inputelement).before(this.editdiv);if(this.maxima){this.maximaoutput=$('<input>');if(!this.debug){this.maximaoutput.attr('type','hidden');}else{this.maximaoutput.css('width','600px');}
var name=$(this.inputelement).attr('name');$(this.maximaoutput).attr('name',name+'_maxima');$(this.maximaoutput).insertAfter(this.inputelement);}
if(this.debug){$('<span>Latex: </span>').insertBefore(this.inputelement);if(this.maxima){$('<br />').insertBefore(this.maximaoutput);$('<span>Maxima: </span>').insertBefore(this.maximaoutput);}}
this.eqndiv=$('<div>');this.eqndiv.addClass('mee_edit_eqn');$(this.editdiv).append(this.eqndiv);$(this.editdiv).click(this.callback('editorClick'));this.ToolbarType='default';if($(this.inputelement).hasClass('units')){this.ToolbarType='units';}
if($(this.inputelement).hasClass('sci')){this.ToolbarType='sci';}
this.initToolbar(this.ToolbarType);this.initRawInput();this.initWInput();this.initHightLightBox();this.initInputSizeBox();},initToolbar:function(tbtype){if(!MEE.Edit.toolbarcache[this.inputelement.id]){MEE.Edit.toolbarcache[this.inputelement.id]=new MEE.Toolbar(this.inputelement);MEE.Edit.toolbarcache[this.inputelement.id].loadToolBar(tbtype);MEE.Edit.toolbar=MEE.Edit.toolbarcache[this.inputelement.id];MEE.Edit.toolbarelem=MEE.Edit.toolbarcache[this.inputelement.id].toolbarelem;}else{MEE.Edit.toolbar=MEE.Edit.toolbarcache[this.inputelement.id];MEE.Edit.toolbarelem=MEE.Edit.toolbarcache[this.inputelement.id].toolbarelem;}
if($(this.inputelement).hasClass('activate'))
MEE.Edit.toolbar.activate=this;},initRawInput:function(){this.rawinput=$('<textarea>');this.rawinput.addClass('mee_edit_raw');$(this.editdiv).prepend(this.rawinput);$(this.rawinput).autoResize();this.rawinput.val(this.latex);this.rawinput.trigger('change.dynSiz');this.rawinput.keyup(this.callback('rawKeyUp'));},initWInput:function(){this.inputelembox=$('<input>');this.inputelembox.addClass('mee_elem_input_box');$(this.editdiv).prepend(this.inputelembox);$(this.inputelembox).keydown(this.callback('inputKeyDown'));$(this.inputelembox).keyup(this.callback('inputKeyUp'));$(this.inputelembox).keypress(this.callback('inputKeyPress'));this.input=new MEE.ElemInput();this.inputelem=this.input.html_elem;},initHightLightBox:function(){var hl=$('.mee_edit_highlight');if(hl.length==0){var hldiv=$('<div>');hldiv.addClass('mee_edit_highlight');hldiv.css('display','none');$(document.body).append(hldiv);var hldiv=$('<div>');hldiv.addClass('mee_edit_highlight_multi');hldiv.css('display','none');$(document.body).append(hldiv);var hldiv=$('<div>');hldiv.addClass('mee_edit_highlight_elem');hldiv.css('display','none');$(document.body).append(hldiv);}},initInputSizeBox:function(){var boxsize=$('.mee_input_size');if(boxsize.length==0){var boxsize=$('<span>');boxsize.addClass('mee_input_size');$(document.body).append(boxsize);boxsize.html("");}},rebuildDisplay:function(){this.elementset=new MEE.ElemSetNormal(this.latex,null,true);this.curElemSet=this.elementset;MEE.Elem.elems=new Array();MEE.ElemSetBasic.basicelems=new Array();MEE.ElemSet.elemsets=new Array();var depth=1;if(this.inline)
depth=2;this.eqndiv.html("");this.html_elem=this.elementset.toHTML(depth);this.eqndiv.append(this.html_elem);if(this.mode==1&&this.active[this.element]){this.moveToSet(this.elementset,false,false);}
this.changed(null,'rebuildDisplay');},changed:function(key,source){if(typeof(source)=="undefined"||typeof(source)=="null")source="";if(this.mode==1)
this.getNewWYSIWYGLatex();this.setIsEditOnElems();this.showhideInputs();this.sortToolbarchecks();this.resizeRawInput();this.sizeInput(key)
this.sortBlanks();this.formatElemSet();this.moveInput();this.Highlight();this.focusInput();this.bindElemClicks();this.showContextRegions();this.dump();},setIsEditOnElems:function(){for(var i=0;i<MEE.Elem.elems.length;i++)
MEE.Elem.elems[i].isedit=true;for(var i=0;i<MEE.ElemSet.elemsets.length;i++)
MEE.ElemSet.elemsets[i].isedit=true;},dump:function(){if(this.debug<2)return;var res="";res+="<div>";res+=this.curElemSet.latex;res+="</div>";res+=this.elementset.dump();$('.dump').html(res);},sizeInput:function(key){if(this.inputelem){var text=this.inputelembox.val();var newchar=String.fromCharCode(key);if(key>48)
text+=newchar;if(key==8){var caret=this.inputelembox.caret();if(caret.start==caret.end){text=text.substr(0,caret.start-1)+text.substr(caret.start);}else{text=text.substr(0,caret.start)+text.substr(caret.end);}}else if(key==46){var caret=this.inputelembox.caret();if(caret.start==caret.end){text=text.substr(0,caret.start)+text.substr(caret.start+1);}else{text=text.substr(0,caret.start)+text.substr(caret.end);}}
var size=this.textSize(text,this.inputelem);if(size<1)
size=1;this.inputelembox.css('width',size+15+'px');this.input.size=size;var fontsize=$(this.inputelem).css('font-size');this.inputelembox.css('font-size',fontsize);}},sortBlanks:function(){if(this.mode!=1)
return;for(var i=0;i<MEE.ElemSet.elemsets.length;i++){if(MEE.ElemSet.elemsets[i]._name!="MEE.Row"){MEE.ElemSet.elemsets[i].sortBlanks();}}},moveInput:function(){if(this.mode!=1)
return;if(this.inputelem){MEE.Tools.HTML.AlignElementOver(this.inputelem,this.inputelembox,null,false);if(this.inputelembox.css('left')=="0px"){this.inputelembox.css('display','none');}else{this.inputelembox.css('display','block');}}},Highlight:function(){if(this.mode!=1||!this.active[this.element]){$('.mee_edit_highlight').css('display','none');$('.mee_edit_highlight_elem').css('display','none');return;}
this.curElemSet.Highlight();},focusInput:function(){if(this.mode==0){this.rawinput.focus();}else{this.inputelembox.focus();}},bindElemClicks:function(){$('.mee_elemset_empty_inner',this.editdiv).unbind('click');$('.mee_elem',this.editdiv).unbind('click');if(this.mode!=1)
return;$('.mee_elemset_empty_inner',this.editdiv).click(this.callback('emptyClick'));$('.mee_elem',this.editdiv).click(this.callback('elemClick'));$('.mee_elem',this.editdiv).dblclick(this.callback('elemDblClick'));},clearAlign:function(elem){$(elem).css('padding','');$(elem).css('margin','');$(elem).children().each(this.callback('clearAlign'));},formatElemSet:function(key){this.clearAlign(this.elementset.html_elem);this.elementset.sortAlign();$(this.eqndiv).css('height',this.elementset.align.height-(this.elementset.align.top+this.elementset.align.bottom)+'px');$(this.eqndiv).css('padding-top',this.elementset.align.top+6+'px');$(this.eqndiv).css('padding-bottom',this.elementset.align.bottom+6+'px');},setLatex:function(latex,source){this.latex=latex;if(source!="undo")
this.addUndo();if(source!="raw")
this.rawinput.val(latex);if(source!="baseinput")
$(this.inputelement).val(latex);if(this.maxima){var maxima=MEE.Maxima.Convert(this.elementset);$(this.maximaoutput).val(maxima);}
window.location.hash=latex;this.rebuildDisplay();},toolbarCommand:function(latex,item,wlatex,mlatex){if(this.mode==0){var newlatex=this.rawinput.val();var caret=this.rawinput.caret();var before=newlatex.substr(0,caret.start);var after=newlatex.substr(caret.end);if(latex.indexOf('$')==-1){var padafter=false;if(latex.charAt(0)=="\\"&&after.length>0){if(after.charAt(0)!="["&after.charAt(0)!="("&after.charAt(0)!="{"&after.charAt(0)!="\\"){padafter=true;;}}
var result=before;result+=latex;var offset=result.length;if(padafter)
result+=" ";result+=after;}else{var inner=caret.text;var latex1=latex.substr(0,latex.indexOf('$'));var latex2=latex.substr(latex.indexOf('$')+2);var padafter=false;if(latex2.charAt(latex2.length-1)!="}"&&after.length>0){if(after.charAt(0)!="["&after.charAt(0)!="("&after.charAt(0)!="{"&after.charAt(0)!="\\"){padafter=true;;}}
var padinner=false;if(latex1.charAt(latex1.length-1)!="{"&&inner.length>0){if(inner.charAt(0)!="["&inner.charAt(0)!="("&inner.charAt(0)!="{"&inner.charAt(0)!="\\"){padinner=true;;}}
var result=before+latex1;if(padinner)
result+=' ';result+=inner;var offset=result.length;result+=latex2;if(padafter)
result+=' ';result+=after;}
this.setLatex(result);this.rawinput.focus();this.rawinput.caret(offset,offset);}else{if(typeof this.curElemSet.selectStart=="number"){var sel=this.getSelStartEnd();var selelemset=this.curElemSet;if(mlatex)
latex=mlatex;var ip=this.curElemSet.getInputPos();var endelem=this.curElemSet.elements[sel.end];this.moveToElement(endelem);if(ip==sel.start-1){sel.start--;sel.end--;}
this.curElemSet.selectStart=null;latex=latex.replace("$1","\\XXREPLACEXX");this.inputAdd(latex+" ");var found=this.elementset.findElement('XXREPLACEXX');if(!found){for(var i=sel.start;i<=sel.end;i++){var tomove=selelemset.elements[i];tomove.html_elem.remove();}
selelemset.elements.splice(sel.start,sel.end-sel.start+1);this.changed();return;}
var targetset=found.set;var targetoffset=found.elem.offset;for(var i=sel.start;i<=sel.end;i++){var tomove=selelemset.elements[i];targetset.elements.splice(targetoffset,0,tomove);tomove.parent=targetset;tomove.html_elem.insertBefore(found.elem.html_elem);targetoffset++;}
selelemset.elements.splice(sel.start,sel.end-sel.start+1);targetset.elements.splice(targetoffset,1);found.elem.html_elem.remove();this.moveToElement(tomove);this.changed();return;}
if(wlatex)
latex=wlatex;if(latex.indexOf('$')>-1)
latex=latex.substr(0,latex.indexOf('$'));if(latex.substr(latex.length-1)=="{"){this.inputAdd(latex);}else{this.inputAdd(latex+" ");}}
if($(item).data('history')==1)
this.symhist.Add(item);this.changed();},clear:function(){if(confirm("Are you sure you want to clear the equation?")){this.setLatex("");}},setInline:function(){this.inline=true;this.rebuildDisplay();this.sortToolbarchecks();},setDisplay:function(){this.inline=false;this.rebuildDisplay();this.sortToolbarchecks();},modeWYSIWYG:function(){if(this.mode==1)
return;if(MEE.Edit.toolbar){MEE.Edit.toolbar.enableTab("context");}
this.mode=1;this.rebuildDisplay();},modeRaw:function(){if(this.mode==0)
return;MEE.Edit.toolbar.disableTab("context");this.inputAdd("");this.changed();this.rawinput.val(this.latex);this.mode=0;this.rebuildDisplay();},sortToolbarchecks:function(){if(MEE.Edit.toolbar){if(this.inline){MEE.Toolbar.ApplyImage('#mode_inline_check','toolbar/home_tick.png');MEE.Toolbar.ApplyImage('#mode_display_check','toolbar/home_tick_blank.png');}else{MEE.Toolbar.ApplyImage('#mode_display_check','toolbar/home_tick.png');MEE.Toolbar.ApplyImage('#mode_inline_check','toolbar/home_tick_blank.png');}
if(this.mode==0){MEE.Toolbar.ApplyImage('#mode_raw_check','toolbar/home_tick.png');MEE.Toolbar.ApplyImage('#mode_wysiwyg_check','toolbar/home_tick_blank.png');}else{MEE.Toolbar.ApplyImage('#mode_wysiwyg_check','toolbar/home_tick.png');MEE.Toolbar.ApplyImage('#mode_raw_check','toolbar/home_tick_blank.png');}}},editorClick:function(){if(MEE.Edit.activeEdit==this){MEE.Edit.toolbar.hidePopups();if(this.mode==1){this.curElemSet.selectStart=null;this.moveToSet(this.elementset,false,false);}
this.changed(null,'editorClick');return false;}
this.activate();return false;},activate:function(){if(this.active[this.element])
return;this.active[this.element]=true;if(MEE.Edit.activeEdit){MEE.Edit.activeEdit.deactivate();}
MEE.Edit.activeEdit=this;this.initToolbar(this.ToolbarType);$(this.editdiv).prepend(MEE.Edit.toolbarelem);MEE.Edit.toolbarelem.show();MEE.Edit.toolbar.currentEdit=this;MEE.Edit.activeEdit=this;MEE.Edit.toolbar.initEvents();this.sortUndoMeun();this.symhist.SortToolbar();this.openDefaultTab();if(this.mode==1)
this.moveToSet(this.elementset,false,false);this.changed(null,'activate');},openDefaultTab:function(){var classList=$(this.inputelement).attr('class').split(/\s+/);for(var i=0;i<classList.length;i++){var class_name=classList[i];if(class_name.indexOf(':')>-1){var type=class_name.substr(0,class_name.indexOf(':'));var tab=class_name.substr(class_name.indexOf(':')+1);if(type=="tabopen"){$('#mee_tab_link_'+tab).children('a').click();}}}},showhideInputs:function(){if(this.active[this.element]){if(this.mode==0){this.rawinput.css('display','block');this.inputelembox.css('display','none');}else{this.rawinput.css('display','none');this.inputelembox.css('display','block');}}else{this.rawinput.css('display','none');this.inputelembox.css('display','none');}},deactivate:function(){if(!this.active[this.element])
return;this.active[this.element]=false;MEE.Edit.toolbar.currentEdit=null;MEE.Edit.toolbar.closeTabs();MEE.Edit.toolbar.hide();MEE.Edit.activeEdit=null
this.rebuildDisplay();},resizeRawInput:function(){this.rawinput.css('width',$(this.editdiv).outerWidth()+'px');},rawKeyUp:function(elem,ev){if(ev.ctrlKey&&!ev.shiftKey&&ev.keyCode==90)
return this.doUndo();if(ev.ctrlKey&&ev.shiftKey&&ev.keyCode==90)
return this.doRedo();var latex=this.rawinput.val();if(latex==this.latex)
return;this.setLatex(latex,"raw");},inputKeyPress:function(elem,event){var key=event.which;var newchar=String.fromCharCode(event.which);var res=this.inputAdd(newchar);if(res)
this.changed(key,'inputKeyPress');else
this.changed(null,'inputKeyPress');return res;},inputAdd:function(newchar){var curvalue=$(this.inputelembox).val()+newchar;var outputtext={};if(Math.abs(this.lasttext.length-curvalue.length)>1){var text="";var res=true;for(var i=0;i<curvalue.length;i++){text+=curvalue.charAt(i);outputtext.text="";if(this.parseInput(text,outputtext)){text=outputtext.text;res=false;}}
if(text==" ")
text="";text=$.trim(text);this.lasttext=text;$(this.inputelembox).val(text);return res;}else{outputtext.text="";if(this.parseInput(curvalue,outputtext)){outputtext.text=$.trim(outputtext.text);$(this.inputelembox).val(outputtext.text);this.lasttext=outputtext.text;return false;}else{this.lasttext=curvalue;}}
return true;},checkPrevElems:function(text){if(text.substr(0,1)=="\\")
return"";for(var i=0;i<MEE.Data.namedops.length;i++){var nop=MEE.Data.namedops[i];var match=this.prevlatex.substr(this.prevlatex.length-nop.length);if(nop==match&&this.prevlatex.substr(this.prevlatex.length-nop.length-1,1)!="\\"){if(this.prevlatex.substr(this.prevlatex.length-nop.length-1,1)=="t"&&nop=="sin")
continue;var toremove=nop.length-1;for(var i=0;i<toremove;i++){var elem=this.curElemSet.getElemBeforeInput();if(!elem)
continue;var offset=this.curElemSet.getInputPos();var prevelem=null;var prevelem_offset=offset-2;if(prevelem_offset>-1)
prevelem=this.curElemSet.elements[prevelem_offset];this.curElemSet.elements.splice(offset-1,1);elem.html_elem.remove();}
return"\\"+nop;}}
return"";},parseInput:function(text,o){text=text.replace(/[^a-zA-z0-9 .\,\/\<\>\?\;\:\"\'\`\!\@\#\$\%\^\&\*\(\)\[\]\{\}\_\+\=\-\|\\\~\#]+/g,'');if(text=="")
return false;if(typeof this.curElemSet.selectStart=="number"){this.deleteSelection();}
if(text.length>1)
this.prevlatex=text;else
this.prevlatex+=text;var nop=this.checkPrevElems(text);if(nop){text=nop+" ";this.prevlatex="";}
var allowspaces=false;if(this.curElemSet&&this.curElemSet.parent&&this.curElemSet.parent.eldata&&this.curElemSet.parent.eldata.allowspaces)
allowspaces=true;if(text==" "&&this.curElemSet.leaveonsinglespace){o.text="";this.curElemSet.leaveonsinglespace=false;this.moveToParent();return true;}
var tokens=this.parser.tokenize(text,true,allowspaces);var lastvalid=-1;for(var i=tokens.length;i>0;i--){if('valid'in tokens[i-1]&&tokens[i-1].valid){lastvalid=i;break;}}
if(lastvalid==-1){this.lasttext=text;return false;}
for(var i=0;i<lastvalid;i++){var token=tokens[i];var eldata=this.parser.getElementData(token);if(token.type=="subscript"||token.type=="superscript"){var elem=this.curElemSet.getElemBeforeInput();if(!elem){var elem=this.createNewElem(token,tokens,i);this.insertIntoCurrentSet(elem);}
if(elem[token.type]){var script=elem[token.type];}else{var script=elem.SetScript(token,null,true);}
if(token.latex=="")
this.moveToSet(script);}else if(token.type=="arg"){if(token.incompletearg){this.curElemSet.single=false;if(token.latex!=""){}}else{}}else if(token.type=="extsingle"&&token.latex=='['){if(token.incompletearg){if(this.curElemSet.inarg){var elem=this.curElemSet.parent;}else{var elem=this.curElemSet.getElemBeforeInput();}
if(!elem){var elem=this.createNewElem(token,tokens,i);this.insertIntoCurrentSet(elem);continue;}
if(elem.eldata.sarg_as_sup){if(!elem.superscript){var arg1={latex:"",type:"superscript"};elem.SetScript(arg1,null,true);}
this.moveToSet(elem.superscript,true,false);this.curElemSet.insarg=true;}else if(elem.eldata.sarg_as_lower){this.moveToSet(elem.parent.row1.col0,true,false);this.curElemSet.insarg=true;}else{var elem=this.createNewElem(token,tokens,i);this.insertIntoCurrentSet(elem);}}else{}}else if(token.type=="extsingle"&&token.latex==']'&&this.curElemSet.insarg){this.moveToParent();}else if(token.type=="extsingle"&&token.latex=='/'){this.handleRSlash(token);}else if(eldata.all_as_arg01){this.handleAllAsArg10(token);}else if(token.type=="extsingle"&&token.latex=="}"){var inarray=false;if(this.curElemSet.parent&&this.curElemSet.parent.parent&&this.curElemSet.parent.parent.parent){if(this.curElemSet.parent.parent.parent.type=="begin")
inarray=true;}
if(this.curElemSet.parent&&!inarray){var elem=this.moveToParent();this.moveToAnyArgs(elem);}}else if(token.type=="begin"){var elem=this.createNewElem(token,tokens,i);if(tokens.length>i){elem.AddArray(tokens[i+1]);}
this.insertIntoCurrentSet(elem);var target=elem.main.row0.col0;this.moveToSet(target);this.curElemSet.inmatrix=true;}else if(token.type=="tab"){if(this.curElemSet.inmatrix){var matrix=this.getCurrentMatrix();if(!matrix)
continue;if(matrix&&matrix.eldata.frac)
continue;var pos=matrix.getPosition(this.curElemSet);if(this.curElemSet.col<matrix.cols-1){var nextcol=this.curElemSet.col+1;pos.col++;newset=matrix.getSetAt(pos);matrix.fillInBlankCols();this.moveToParent();this.moveToSet(newset);this.curElemSet.inmatrix=true;}else{this.arrayAppendCol();}}}else if(token.type=="newline"){if(this.curElemSet.inmatrix){var matrix=this.getCurrentMatrix();if(!matrix)
continue;if(matrix&&matrix.eldata.frac)
continue;var pos=matrix.getPosition(this.curElemSet);if(pos.row==-1)
return;var newset=null;if(pos.row<matrix.rows-1){pos.row++;pos.col=0;matrix.InsertRow(pos.row);newset=matrix.getSetAt(pos);}else{matrix.AppendRow();pos.row=matrix.rows-1;pos.col=0;newset=matrix.getSetAt(pos);}
if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}}}else if(token.type=="end"){var matrix=this.getCurrentMatrix();if(!matrix)
continue;if(matrix&&matrix.eldata.frac)
continue;this.moveToParent(true);}else if(token.type=="size"){this.sizenext=token.latex;}else if(token.type=="extsingle"&&token.isclosing){this.handleClosingBracket(token);}else{if(this.sizenext){token.size=this.sizenext;this.sizenext=null;}
var elem=this.createNewElem(token,tokens,i);this.insertIntoCurrentSet(elem);if(this.curElemSet.single&&!this.curElemSet.inmatrix){this.curElemSet.single=false;elem=this.moveToParent();}
this.moveToAnyArgs(elem);}}
for(var i=lastvalid;i<tokens.length;i++){if(tokens[i].type=="command")
o.text+="\\";o.text+=tokens[i].latex;}
o.text=$.trim(o.text);return true;},handleRSlash:function(token){var offset=this.curElemSet.getInputPos();var backto=-1;for(var i=offset-1;i>=0;i--){var elem=this.curElemSet.elements[i];if(elem.eldata.noautofrac){backto=i;break;}}
var ftoken={latex:"frac",type:"command"}
var elem=this.createNewElem(ftoken);this.insertIntoCurrentSet(elem);var upperset=elem.main.row0.col0;for(var k=backto+1;k<offset;k++){var tomove=this.curElemSet.elements[k];upperset.elements.push(tomove);upperset.html_elem.append(tomove.html_elem);tomove.parent=upperset;}
this.curElemSet.elements.splice(backto+1,offset-backto-1);var lowerset=elem.main.row1.col0;this.moveToSet(lowerset,false,false);lowerset.leaveonsinglespace=true;},handleClosingBracket:function(token){if(this.sizenext){token.size=this.sizenext;this.sizenext=null;}
var offset=this.curElemSet.getInputPos();var backto=-1;for(var k=offset-2;k>=0;k--){var elem=this.curElemSet.elements[k];if(elem.type=="extsingle"){backto=k;break;}}
if(backto>-1){var lb_elem=this.curElemSet.elements[backto];var lbtype=lb_elem.latex;var lbsize=lb_elem.size;if(lbsize==0)
lbsize=-1;var ntoken={};ntoken.latex=lbtype.replace("l","p");if(ntoken.latex=="(")
ntoken.latex="pbrackets";if(ntoken.latex=="{")
ntoken.latex="pbrace";if(ntoken.latex=="[")
ntoken.latex="psqbrackets";ntoken.type="extpair";var elem=this.createNewElem(ntoken);var itoken={};itoken.latex="";elem.SetMain(itoken);elem.size=lbsize;elem.sizer=token.size;if(elem.sizer==0)
elem.sizer=-1;var rbeldata=this.parser.getElementData(token);if(rbeldata.text)
elem.eldata.rb=rbeldata.text;else
elem.eldata.rb=token.latex;this.insertIntoCurrentSet(elem);for(var k=backto+1;k<offset;k++){var tomove=this.curElemSet.elements[k];elem.main.elements.push(tomove);elem.main.html_elem.append(tomove.html_elem);tomove.parent=elem.main;}
elem.eldata.args=0;lb_elem.html_elem.remove();this.curElemSet.elements.splice(backto,offset-backto);for(var k=0;k<this.curElemSet.elements.length;k++){this.curElemSet.elements[k].offset=k;}
elem.main.sortBlanks();}else{var elem=this.createNewElem(token);this.insertIntoCurrentSet(elem);}},handleAllAsArg10:function(token){var offset=this.curElemSet.getInputPos();var elem=this.createNewElem(token);this.insertIntoCurrentSet(elem);var upperset=elem.main.row0.col0;for(var k=0;k<offset;k++){var tomove=this.curElemSet.elements[k];upperset.elements.push(tomove);upperset.html_elem.append(tomove.html_elem);tomove.parent=upperset;}
this.curElemSet.elements.splice(0,offset);var lowerset=elem.main.row1.col0;this.moveToSet(lowerset,false,false);lowerset.leaveonsinglespace=true;},inputKeyUp:function(elem,ev){},doPaste:function(){this.inputAdd("");this.curElemSet.single=false;this.changed(null,'doPaste');},inputKeyDown:function(elem,event){if(event.ctrlKey&&!event.shiftKey&&event.keyCode==90)
return this.doUndo();if(event.ctrlKey&&event.shiftKey&&event.keyCode==90)
return this.doRedo();if(event.ctrlKey&&!event.shiftKey&&event.keyCode==86){setTimeout('MEE.Edit.activeEdit.doPaste()',100);}
var key=event.which;if(key==8||key==32||key==46||key==35||key==36||key==37||key==38||key==39||key==40){if(this.mode==1){var caret=this.inputelembox.caret();var value=this.inputelembox.val();var vallen=value.length;if(key==8||key==46)
this.lasttext=value;if(key==37||key==8){if(caret.start>0){this.changed(key,'inputKeyDown');return true;}}else if(key==39||key==46){if(caret.start<vallen){this.changed(key,'inputKeyDown');return true;}}
if((key==37||key==39||key==35||key==36)&&event.shiftKey)
{this.handleSelectMultiple(key);this.changed();return true;}}
if(key==32)
this.inputAdd(" ");else if(typeof this.curElemSet.selectStart!="number")
this.inputAdd("");this.processInput(event);this.lasttext="";this.changed(key,'inputKeyDown');this.dump();if(key==32)
return false;}},handleSelectMultiple:function(key){if(typeof this.curElemSet.selectStart!="number"){this.curElemSet.selectStart=this.curElemSet.getInputPos();}
if(key==37){var curelempos=this.curElemSet.getInputPos();curelempos-=2;if(curelempos<0){this.moveToSetStart(this.curElemSet);return;}
var newelem=this.curElemSet.elements[curelempos];this.moveToElement(newelem);}else if(key==39){var curelempos=this.curElemSet.getInputPos();curelempos++;if(curelempos>=this.curElemSet.elements.length)
return;var newelem=this.curElemSet.elements[curelempos];this.moveToElement(newelem);}else if(key==35){var newelem=this.curElemSet.elements[this.curElemSet.elements.length-1];this.moveToElement(newelem);}else if(key==36){this.moveToSetStart(this.curElemSet);}},getSelStartEnd:function(){var start=this.curElemSet.selectStart;var end=this.curElemSet.getInputPos();var ip=end;if(start>end){var temp=end;end=start;start=temp;}
if(start==end)
return;if(start==ip)
start++;if(end==ip)
end--;if(start>end)
return{'start':-1,'end':-1};return{'start':start,'end':end};},deleteSelection:function(){if(typeof this.curElemSet.selectStart!="number")
return false;var sel=this.getSelStartEnd();if(sel.start==-1)
return;var count=sel.end-sel.start+1;for(var i=0;i<count;i++){var elem=this.curElemSet.elements[sel.start];this.curElemSet.elements.splice(sel.start,1);elem.html_elem.remove();}
this.curElemSet.selectStart=null;return true;},processInput:function(event){var key=event.which;if(key==8){if(typeof this.curElemSet.selectStart=="number"){return this.deleteSelection();}
var elem=this.curElemSet.getElemBeforeInput();if(!elem){this.moveToParent();elem=this.curElemSet.getElemBeforeInput();if(elem&&(elem.eldata.inmatrix||elem.eldata.frac))
return;}
if(!elem){return;}
var offset=this.curElemSet.getInputPos();var prevelem=null;var prevelem_offset=offset-2;if(prevelem_offset>-1)
prevelem=this.curElemSet.elements[prevelem_offset];this.curElemSet.elements.splice(offset-1,1);elem.html_elem.remove();}else if(key==46){if(typeof this.curElemSet.selectStart=="number"){return this.deleteSelection();}
var offset=this.curElemSet.getInputPos();if(this.curElemSet.elements.length<=offset+1)
return;var elem=this.curElemSet.elements[offset+1];this.curElemSet.elements.splice(offset+1,1);elem.html_elem.remove();}else if(key==35){this.curElemSet.selectStart=null;var offset=this.curElemSet.getInputPos();if(offset+1<this.curElemSet.elements.length){this.moveToSet(this.curElemSet,false,false);}else{var par=this.curElemSet.parent;if(par&&par._name=="MEE.Row")
par=par.parent.parent;if(par)
par=par.parent;if(par)
this.moveToSet(par,false,false);}}else if(key==36){this.curElemSet.selectStart=null;var offset=this.curElemSet.getInputPos();if(offset>0){this.moveToSetStart(this.curElemSet);}else{var par=this.curElemSet.parent;if(par&&par._name=="MEE.Row")
par=par.parent.parent;if(par)
par=par.parent;if(par)
this.moveToSetStart(par);}}else if(key==37){this.curElemSet.selectStart=null;var offset=this.curElemSet.getInputPos();if(offset==0){var parelem=this.curElemSet.parent;if(!parelem)
return;var parset=parelem.parent;this.curElemSet.removeInput();if(parset.isarray){var pos=parset.getPosition(this.curElemSet);this.curElemSet=parset;if(pos.col>0){var newcol=pos.col-1;this.curElemSet=this.curElemSet['row'+pos.row]['col'+newcol];this.curElemSet.elements.push(this.input);this.curElemSet.html_elem.append(this.inputelem);return;}
parelem=parset.parent;parset=parelem.parent;}
this.curElemSet=parset;var offset=this.curElemSet.getElementOffset(parelem);this.inputelem.insertBefore(this.curElemSet.elements[offset].html_elem);this.curElemSet.elements.splice(offset,0,this.input);return;}
var prevelem=this.curElemSet.elements[offset-1];if(!prevelem)
return;this.curElemSet.removeInput();if(prevelem.main&&prevelem.main.isarray){this.curElemSet=prevelem.main;if(this.curElemSet.rows>0||this.curElemSet.cols>0){this.curElemSet=this.curElemSet.row0['col'+(this.curElemSet.cols-1)];this.curElemSet.elements.push(this.input);this.curElemSet.html_elem.append(this.inputelem);return;}}
if(prevelem.eldata.arg0_as_main&&prevelem.main.elements){prevelem.main.elements.push(this.input);prevelem.main.html_elem.append(this.inputelem);this.curElemSet=prevelem.main;return;}
this.inputelem.insertBefore(this.curElemSet.elements[offset-1].html_elem);this.curElemSet.elements.splice(offset-1,0,this.input);}else if(key==39){this.curElemSet.selectStart=null;var offset=this.curElemSet.getInputPos();if(offset==this.curElemSet.elements.length-1){var parelem=this.curElemSet.parent;if(!parelem)
return;var parset=parelem.parent;if(parset.isarray){var pos=parset.getPosition(this.curElemSet);if(pos.col<parset.cols-1){var newcol=pos.col+1;var newset=parset['row'+pos.row]['col'+newcol];if(newset){this.moveToSet(newset,false,false);}
return;}
if(!parset.isColBlank(pos.col,true)&&!parset.eldata.frac){return this.arrayAppendCol(true,parset);}
parelem=parset.parent;parset=parelem.parent;}
this.curElemSet.removeInput();this.curElemSet=parset;var offset=this.curElemSet.getElementOffset(parelem);this.inputelem.insertAfter(this.curElemSet.elements[offset].html_elem);this.curElemSet.elements.splice(offset+1,0,this.input);return;}
var nextelem=this.curElemSet.elements[offset+1];if(!nextelem)
return;if(nextelem.main&&nextelem.main.isarray){if(nextelem.main.rows>0||nextelem.main.cols>0){this.curElemSet.removeInput();this.curElemSet=nextelem.main.row0.col0;this.curElemSet.elements.unshift(this.input);this.curElemSet.html_elem.prepend(this.inputelem);return;}}
if(nextelem.eldata.arg0_as_main&&nextelem.main.elements){this.curElemSet.removeInput();nextelem.main.elements.unshift(this.input);nextelem.main.html_elem.prepend(this.inputelem);this.curElemSet=nextelem.main;}else{this.curElemSet.removeInput();this.curElemSet.elements.splice(offset+1,0,this.input);this.inputelem.insertAfter(this.curElemSet.elements[offset].html_elem);}}else if(key==38){this.curElemSet.selectStart=null;var offset=this.curElemSet.getInputPos();var curelem=this.curElemSet.elements[offset-1];if(curelem&&curelem.superscript){this.curElemSet.removeInput();this.curElemSet=curelem.superscript;this.curElemSet.elements.push(this.input);this.curElemSet.html_elem.append(this.inputelem);return;}
if(curelem&&curelem.main&&curelem.main.isarray){if(curelem.main.rows>0||curelem.main.cols>0){this.curElemSet.removeInput();this.curElemSet=curelem.main;this.curElemSet=this.curElemSet.row0['col'+(this.curElemSet.cols-1)];this.curElemSet.elements.push(this.input);this.curElemSet.html_elem.append(this.inputelem);return;}}
var parelem=this.curElemSet.parent;var savedcurElem=this.curElemSet;while(parelem){var parset=parelem.parent;if(this.curElemSet.subscript){savedcurElem.removeInput();this.curElemSet=parset;var offset=this.curElemSet.getElementOffset(parelem);this.inputelem.insertAfter(this.curElemSet.elements[offset].html_elem);this.curElemSet.elements.splice(offset+1,0,this.input);return;}
if(parset.isarray){var pos=parset.getPosition(this.curElemSet);if(pos.row>0){var newrow=pos.row-1;var newset=parset['row'+newrow]['col'+pos.col];if(newset){savedcurElem.removeInput();this.curElemSet=newset;this.curElemSet.elements.unshift(this.input);this.curElemSet.html_elem.prepend(this.inputelem);}
return;}}
this.curElemSet=parset;var parelem=this.curElemSet.parent;}
this.curElemSet=savedcurElem;}else if(key==40){this.curElemSet.selectStart=null;var offset=this.curElemSet.getInputPos();var curelem=this.curElemSet.elements[offset-1];if(curelem&&curelem.subscript){this.curElemSet.removeInput();this.curElemSet=curelem.subscript;this.curElemSet.elements.push(this.input);this.curElemSet.html_elem.append(this.inputelem);return;}
if(curelem&&curelem.main&&curelem.main.isarray){if(curelem.main.rows>0||curelem.main.cols>0){this.curElemSet.removeInput();this.curElemSet=curelem.main;this.curElemSet=this.curElemSet['row'+(this.curElemSet.rows-1)]['col'+(this.curElemSet.cols-1)];this.curElemSet.elements.push(this.input);this.curElemSet.html_elem.append(this.inputelem);return;}}
var parelem=this.curElemSet.parent;var savedcurElem=this.curElemSet;while(parelem){var parset=parelem.parent;if(this.curElemSet.superscript){savedcurElem.removeInput();this.curElemSet=parset;var offset=this.curElemSet.getElementOffset(parelem);this.inputelem.insertAfter(this.curElemSet.elements[offset].html_elem);this.curElemSet.elements.splice(offset+1,0,this.input);return;}
if(parset.isarray){var pos=parset.getPosition(this.curElemSet);if(pos.row<parset.rows-1){var newrow=pos.row+1;var newset=parset['row'+newrow]['col'+pos.col];if(newset){savedcurElem.removeInput();this.curElemSet=newset;this.curElemSet.elements.unshift(this.input);this.curElemSet.html_elem.prepend(this.inputelem);}
return;}else{var row=this.curElemSet.parent;var matrix=row.parent;if(!matrix.isRowBlank(row.row,true)&&!matrix.eldata.frac){return this.arrayAppendRow();}}}
this.curElemSet=parset;var parelem=this.curElemSet.parent;}
this.curElemSet=savedcurElem;}},elemClick:function(html_elem){this.curElemSet.selectStart=null;if(this.mode==0)
return;this.activate();var elemid=$(html_elem).attr('elem');if(!elemid)
return true;var elem=MEE.Elem.elems[elemid];if(!elem)
return true;this.inputAdd("");this.moveToElement(elem);this.changed(null,'elemClick');return false;},elemDblClick:function(html_elem,event){event.preventDefault();event.stopPropagation();event.stopImmediatePropagation();var curpos=this.curElemSet.getInputPos();var elem=this.curElemSet.elements[curpos-1];if(elem.eldata.noautofrac){this.curElemSet.selectStart=curpos-1;this.changed(null,'elemDblClick');return true;}
var endpos=curpos-1;for(var i=curpos+1;i<this.curElemSet.elements.length;i++){var elem=this.curElemSet.elements[i];if(elem.eldata.noautofrac)
break;endpos=i;}
if(endpos==-1)
return true;var endelem=this.curElemSet.elements[endpos];this.moveToElement(endelem);var startpos=curpos-1;for(var i=endpos-1;i>=0;i--){var elem=this.curElemSet.elements[i];if(elem.eldata.noautofrac)
break;startpos=i;}
if(startpos==-1)
return;this.curElemSet.selectStart=startpos;this.changed(null,'elemDblClick');return true;},emptyClick:function(html_elem){this.curElemSet.selectStart=null;if(this.mode==0)
return true;this.activate();var elemid=$(html_elem.parentNode).attr('elem');var elemset=MEE.ElemSet.elemsets[elemid];if(!elemset)
return true;this.inputAdd("");this.moveToSet(elemset,false,false);this.changed(null,'emptyClick');return false;},getNewWYSIWYGLatex:function(){var newlatex=this.elementset.toLatex().get();$(this.inputelement).val(newlatex);if(this.maxima){var maxima=MEE.Maxima.Convert(this.elementset);$(this.maximaoutput).val(maxima);}
this.latex=newlatex;if(this.undo)
this.addUndo();},moveToSet:function(newset,storeprev,single){if(typeof(storeprev)=="undefined")storeprev=true;if(typeof(single)=="undefined")single=true;var curset=this.curElemSet;var curelem=this.curElemSet.getElemBeforeInput();this.curElemSet.removeInput();newset.elements.push(this.input);this.inputelem.appendTo(newset.html_elem);this.curElemSet=newset;if(storeprev){this.curElemSet.returnto_elem=curelem;this.curElemSet.returnto_set=curset;}
this.curElemSet.single=single;},moveToSetStart:function(newset){this.curElemSet.removeInput();this.prevlatex="";newset.elements.splice(0,0,this.input);this.inputelem.prependTo(newset.html_elem);this.curElemSet=newset;},moveToElement:function(newelem){this.prevlatex="";this.curElemSet.removeInput();this.curElemSet=newelem.parent;var offset=this.curElemSet.getElementOffset(newelem);this.inputelem.insertAfter(this.curElemSet.elements[offset].html_elem);this.curElemSet.elements.splice(offset+1,0,this.input);this.curElemSet.single=false;},moveToParent:function(nohist){this.prevlatex="";this.curElemSet.removeInput();var elem=null;var _set=null;if(this.curElemSet.returnto_set&&nohist!=true){elem=this.curElemSet.returnto_elem;_set=this.curElemSet.returnto_set;}else{elem=this.curElemSet.parent;if(elem&&elem._name=="MEE.Row")
elem=elem.parent.parent;if(elem)
_set=elem.parent;else
_set=this.elementset;}
this.curElemSet=_set;if(elem){this.inputelem.insertAfter(elem.html_elem);var offset=elem.offset;this.curElemSet.elements.splice(offset+1,0,this.input);}else{this.inputelem.appendTo(_set.html_elem);_set.elements.push(this.input);}
return elem;},moveToAnyArgs:function(elem){if(!elem)
return;if(elem.eldata.args>0){var ca=elem.eldata.currentarg;if(typeof(ca)=="undefined")
return;this.moveToSet(elem.argmap[ca]);this.prevlatex="";elem.eldata.args--;elem.eldata.currentarg++;this.curElemSet.inarg=true;}},insertIntoCurrentSet:function(elem){elem.parent=this.curElemSet;var offset=this.curElemSet.insertElemBeforeInput(elem);this.curElemSet.insertHTMLFor(elem,offset);},createNewElem:function(token,tokens,i){var tokens3=new Array();tokens3.push(token);var elems=this.parser.buildelements(tokens3);if(elems.length==0)
return;var elem=elems[0];if(elem.eldata.args>0){if(elem.eldata.arg01_as_upperlower||elem.eldata.arg0_as_upper){var arg1={latex:""}
var arg2={latex:""}
elem.AddUpperLower(arg1,arg2);}else if(elem.eldata.arg0_as_main){var arg={latex:""};elem.SetMain(arg);}else{for(var a=0;a<elem.eldata.args;a++){var arg={latex:""};elem.AddArg(arg);}}
elem.eldata.currentarg=0;}
if(elem.eldata.sarg){if(elem.eldata.sarg_as_sup){var arg={latex:""};elem.SetScript(arg,"superscript");}else if(elem.eldata.sarg_as_lower){}else{var arg={latex:""};elem.SetSArg(arg);}}
return elem;},createUndo:function(){this.undo=new MEE.Undo();this.sortUndoMeun();},addUndo:function(){if(this.noundo)
return;var lastundo=this.undo.CurrentUndo();if(lastundo&&lastundo.latex==this.latex)
return;var undoobj={latex:this.latex}
if(this.rawinput)
undoobj.caret=this.rawinput.caret();this.undo.Add(undoobj);this.sortUndoMeun();},doUndo:function(){this.applyUndoRedo(this.undo.Undo());return false;},doRedo:function(){this.applyUndoRedo(this.undo.Redo());return false;},applyUndoRedo:function(undoobj){this.noundo=true;if(undoobj!=null){if(this.mode==0){this.setLatex(undoobj.latex,"undo");this.rawinput.caret(undoobj.caret);}else{this.latex=undoobj.latex;this.rebuildDisplay();}}
this.sortUndoMeun();this.noundo=false;},sortUndoMeun:function(){if(MEE.Edit.toolbar){if(this.undo.canUndo()){MEE.Toolbar.ApplyImage('#tb_undo_img','toolbar/home_undo.png');$('#tb_undo').css('color','#000000');$('#tb_undo').children().css('color','#000000');}else{MEE.Toolbar.ApplyImage('#tb_undo_img','toolbar/home_undo_g.png');$('#tb_undo').css('color','#CCCCCC');$('#tb_undo').children().css('color','#CCCCCC');}
if(this.undo.canRedo()){MEE.Toolbar.ApplyImage('#tb_redo_img','toolbar/home_redo.png');$('#tb_redo').css('color','#000000');$('#tb_redo').children().css('color','#000000');}else{MEE.Toolbar.ApplyImage('#tb_redo_img','toolbar/home_redo_g.png');$('#tb_redo').css('color','#CCCCCC');$('#tb_redo').children().css('color','#CCCCCC');}}},textSize:function(string,scope){if(string=="")
return 0;var el=$('.mee_input_size');var fontsize=$(scope).css('font-size');el.css('font-size',fontsize);el.text(string);return el.outerWidth();},showContextRegions:function(){var regions={'bracket_left':0,'bracket_right':0,'bracket_both':0,'matrix':0,'matrix_rows':0,'matrix_cols':0,'scripts':0,'fraction':0,'sqrt':0,'fonts':0};if(this.curElemSet){var inchem=false;var set=this.curElemSet;while(set.parent){if(set.latex=="ce"){inchem=true;}
set=set.parent;}
if(inchem){if(MEE.Edit.toolbar)
MEE.Edit.toolbar.SetHighlighted('tbpm_item_chemmode');}else{if(MEE.Edit.toolbar)
MEE.Edit.toolbar.SetNormal('tbpm_item_chemmode');}}
if(this.curElemSet){var elem=this.curElemSet.getElemBeforeInput();if(elem){regions.scripts=1;if(elem.latex=='sqrt')
regions.sqrt=1;if(elem.type=="extpair"||elem.eldata.changetype=="extpair"){regions.bracket_both=1;}
if(elem.type=="extsingle"){if(elem.latex=="("||elem.latex=="["||elem.latex.substr(0,1)=="l"){regions.bracket_left=1;}else{regions.bracket_right=1;}}
if(elem.latex.substr(elem.latex.length-4)=="frac"){}
if(elem.type=="begin"){regions.matrix=1;regions.matrix_cols=1;regions.matrix_rows=1;}
if(elem.eldata.simplemain){regions.fonts=1;}}
if(this.curElemSet.inmatrix){if(this.curElemSet.parent.parent.parent.type=="begin"){regions.matrix=1;regions.matrix_cols=1;regions.matrix_rows=1;}else{}}}
for(region in regions){var show=regions[region];var id='#mt_pane_'+region;if(show){$(id).css('display','block');$(id).next().css('display','block');}else{$(id).css('display','none');$(id).next().css('display','none');}}},changeMatrixType:function(newtype){var elem=this.curElemSet.getElemBeforeInput();if(!elem)
return;if(elem.type!="begin"){elem=elem.parent.parent.parent.parent;}
if(elem.type!="begin")
return;elem.latex=newtype;if(elem.html_lb){elem.html_lb.remove();elem.html_lb=null;}
if(elem.html_rb){elem.html_rb.remove();elem.html_rb=null;}
var cmdstr="\\"+newtype;var neweldata=MEE.Data.commands[cmdstr];if(!neweldata){alert("Fatal Error : Missing data for "+newtype);}
elem.eldata=jQuery.extend({},neweldata);elem.createLbHTML();elem.createRbHTML();this.changed(null,'changeMatrixType');},changeFracType:function(newtype){},changeFontType:function(newtype){var elem=this.curElemSet.getElemBeforeInput();if(!elem)
return;var classList=$(elem.html_elem).attr('class').split(/\s+/);for(var i=0;i<classList.length;i++){var class_name=classList[i];if(class_name.substr(0,9)=="mee_font_")
$(elem.html_elem).removeClass(class_name);}
var neweldata=MEE.Data.commands["\\"+newtype];if(!neweldata)
return;elem.latex=newtype;if(neweldata.elemclass){$(elem.html_elem).addClass(neweldata.elemclass);}
this.changed(null,'changeFontType');},changeBracket:function(side,newtype,newtype2){var elem=this.curElemSet.getElemBeforeInput();if(!elem)
return;var newleft="";var left=false;var newright="";var right=false;var newleft_base="";var newright_base="";if(side=="left"){left=true;newleft=this.findNewBracket(newtype,'lb');newleft_base=newtype;}else if(side=="right"){right=true;newright=this.findNewBracket(newtype,'rb');newright_base=newtype;}else if(side=="both"){left=true;newleft=this.findNewBracket(newtype,'lb');right=true;newright=this.findNewBracket(newtype2,'rb');newleft_base=newtype;newright_base=newtype2;}
if(elem.html_lb){elem.html_lb.remove();elem.html_lb=null;}
if(elem.html_rb){elem.html_rb.remove();elem.html_rb=null;}
if(left){elem.eldata.lb=newleft;elem.latex=newleft_base;if(newleft_base=="("||newleft_base=="[")
elem.latex=newleft_base;}
if(right){elem.eldata.rb=newright;elem.latex="\\"+newright_base;if(newright_base==")"||newright_base=="]")
elem.latex=newright_base;}
elem.createLbHTML();elem.createRbHTML();this.changed(null,'changeBracket');},findNewBracket:function(newtype){if(newtype=="none")
return"";var cmdstr="\\"+newtype;var neweldata=MEE.Data.commands[cmdstr];if(!neweldata)
neweldata=MEE.Data.commands[newtype];if(!neweldata)
return newtype;return neweldata.text;},changeBracketSize:function(side,newsize){var elem=this.curElemSet.getElemBeforeInput();if(!elem)
return;if(newsize=="auto")
newsize=-1;if(newsize=="default")
newsize=0;var newleft="";var left=false;var newright="";var right=false;if(side=="left"){left=true;newleft=newsize;}else if(side=="right"){right=true;newright=newsize;}else if(side=="both"){left=true;newleft=newsize;right=true;newright=newsize;}
if(elem.html_lb){elem.html_lb.remove();elem.html_lb=null;}
if(elem.html_rb){elem.html_rb.remove();elem.html_rb=null;}
if(left){elem.eldata.size=newleft;elem.size=newleft;elem.eldata.sizer=newleft;elem.sizer=newleft;}
if(right){elem.eldata.size=newright;elem.size=newright;elem.eldata.sizer=newright;elem.sizer=newright;}
elem.createLbHTML();elem.createRbHTML();this.changed(null,'changeBracketSize');},getCurrentMatrix:function(){var elem=this.curElemSet.getElemBeforeInput();var matrix=null;if(elem&&elem.main&&elem.main.isarray){matrix=elem.main;}else{var row=this.curElemSet.parent;matrix=row.parent;}
if(!matrix.isarray)
return null;return matrix;},arrayInsertRow:function(skipchanged){var matrix=this.getCurrentMatrix();if(!matrix)
return;var pos=matrix.getPosition(this.curElemSet);if(pos.row==-1)
return;matrix.InsertRow(pos.row);var newset=matrix.getSetAt(pos);if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}
if(skipchanged!=true)
this.changed();},arrayAppendRow:function(skipchanged){var matrix=this.getCurrentMatrix();if(!matrix)
return;var pos=matrix.getPosition(this.curElemSet);matrix.AppendRow();pos.row=matrix.rows-1;var newset=matrix.getSetAt(pos);if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}
if(skipchanged!=true)
this.changed();},arrayDeleteRow:function(skipchanged){var matrix=this.getCurrentMatrix();if(!matrix)
return;var pos=matrix.getPosition(this.curElemSet);if(pos.row==-1)
return;if(matrix.rows<2)
return;matrix.DeleteRow(pos.row);if(pos.row>=matrix.rows-1)
pos.row=matrix.rows-1;var newset=matrix.getSetAt(pos);if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}
if(skipchanged!=true)
this.changed();},arrayInsertCol:function(skipchanged){var matrix=this.getCurrentMatrix();if(!matrix)
return;var pos=matrix.getPosition(this.curElemSet);if(pos.col==-1)
return;matrix.InsertCol(pos.col);var newset=matrix.getSetAt(pos);if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}
if(skipchanged!=true)
this.changed();},arrayAppendCol:function(skipchanged,matrix){if(!matrix)
matrix=this.getCurrentMatrix();if(!matrix)
return;var pos=matrix.getPosition(this.curElemSet);if(pos.row==-1)
pos.row=0;matrix.AppendCol();pos.col=matrix.cols-1;var newset=matrix.getSetAt(pos);if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}
if(skipchanged!=true)
this.changed();},arrayDeleteCol:function(skipchanged){var matrix=this.getCurrentMatrix();if(!matrix)
return;var pos=matrix.getPosition(this.curElemSet);if(pos.col==-1)
return;if(matrix.cols<2)
return;matrix.DeleteCol(pos.col);if(pos.col>=matrix.col-1)
pos.col=matrix.col-1;var newset=matrix.getSetAt(pos);if(newset){this.moveToSet(newset,false,false);}else{this.moveToSet(this.elementset,false,false);}
if(skipchanged!=true)
this.changed();}});

MEE.Main.extend("MEE.Display",{id:0},{inline:false,elementset:null,init:function(element,inline,mcedoc){if(mcedoc)
return this.TinyMCEinit(element,inline,mcedoc);this.element=element;var JQelement=$(element);this.inline=inline;this.fonts={};this.baseid=JQelement.attr('id');if(typeof this.baseid=="undefined")
this.baseid="";var showcomp=0;var large="\\LARGE ";var border=0;var showlatex=0;if(JQelement.hasClass('nocomp'))showcomp=0;if(JQelement.hasClass('comp'))showcomp=1;var latex=element.innerHTML;if(latex.substr(0,2)=="\\["){latex=latex.substr(2,latex.length-4);}
if(latex.charAt(0)=="<")
return;this.elementset=new MEE.ElemSetNormal(latex,null);JQelement.attr('title',latex);var depth=1;if(inline)depth=2;var res=this.elementset.toHTML(depth);if(inline){JQelement.html("");JQelement.append(res);}else if(showcomp){JQelement.html("");var table=$('<table>');table.css('border-top','1px solid blue');var tr=$('<tr>');var td1=$('<td>');td1.attr("width","50%");var td2=$('<td>');td2.attr("width","50%");td2.css('border-left','1px solid blue');td2.css('padding-left','4px');td2.css('vertical-align','top');var span=$('<div>');if(border)
span.css('border','1px solid blue');table.append(tr);$(table).attr('width','100%');if(large)
$(table).css('font-size','200%');tr.append(td1);tr.append(td2);var img=$('<img>');var lt2=MEE.Tools.HTML.html_entity_decode(latex);lt2=MEE.Tools.HTML.replaceAll(lt2,"&lt;","<");lt2=MEE.Tools.HTML.replaceAll(lt2,"&gt;",">");img.attr('src','http://latex.codecogs.com/gif.latex?'+large+lt2);$(td2).append(img);JQelement.append(table);$(span).append(res);$(td1).append(span);if(showlatex){var eqn=$('<div>');eqn.css('font-size','14px');eqn.text(latex);$(td1).append(eqn);}
this.element=span;}else{JQelement.html("");JQelement.append(res);}},Align:function(){if(!this.elementset)
return;this.elementset.sortAlign();var JQelement=$(this.element);if($.browser.msie&&document.documentMode==7){JQelement.css({'height':this.elementset.align.height-(this.elementset.align.top+this.elementset.align.bottom)+'px','margin-top':this.elementset.align.top+'px','margin-bottom':this.elementset.align.bottom+'px'});}else{JQelement.css({'height':this.elementset.align.height-(this.elementset.align.top+this.elementset.align.bottom)+'px','padding-top':this.elementset.align.top+'px','padding-bottom':this.elementset.align.bottom+'px'});}
var baseid=this.baseid;$(this.elementset.html_elem).find('.mee_elem_answer_input').each(function(no){$(this).attr('name',baseid+no);});},ListFonts:function(node){var font=$(node).css('font-family');this.fonts[font]=0;$(node).children().each(this.callback('ListFonts'));},FontsLoaded:function(){for(font in this.fonts)
{if(!MEE.Font.isLoaded(font))
return false;}
return true;},TinyMCEinit:function(element,inline,mcedoc){this.inline=inline;var latex=element.innerHTML;if(latex.substr(0,2)=="\\["){latex=latex.substr(2,latex.length-4);}
if(latex.charAt(0)=="<")
return;this.elementset=new MEE.ElemSetNormal(latex,null);var JQelement=$(element);JQelement.attr('title',latex);var depth=1;if(inline)depth=2;var res=this.elementset.toHTML(depth);var cont=$('<div>');$(mcedoc.body).append(cont);cont.append(res);JQelement.html("");this.elementset.sortAlign();if(inline){JQelement.css('height',this.elementset.align.height-(this.elementset.align.top+this.elementset.align.bottom)+'px');if($.browser.msie&&document.documentMode==7){JQelement.css('margin-top',this.elementset.align.top+'px');JQelement.css('margin-bottom',this.elementset.align.bottom+'px');}else{JQelement.css('padding-top',this.elementset.align.top+'px');JQelement.css('padding-bottom',this.elementset.align.bottom+'px');}
JQelement.css('height',this.elementset.align.height+'px');JQelement.html(MEE.Data.blankspace);}else{if($.browser.msie&&document.documentMode==7){JQelement.css('margin-top',this.elementset.align.top+'px');JQelement.css('margin-bottom',this.elementset.align.bottom+'px');}else{JQelement.css('padding-top',this.elementset.align.top+'px');JQelement.css('padding-bottom',this.elementset.align.bottom+'px');}
JQelement.css('height',this.elementset.align.height-(this.elementset.align.top+this.elementset.align.bottom)+'px');JQelement.css('width','100%');JQelement.html(MEE.Data.blankspace);}
cont.css('position','absolute');cont.css('z-index',-100);cont.addClass('mee_tinymce_cont');var id=MEE.Display.id++;JQelement.attr('id','mee_elem_'+id);$(cont).attr('id','mee_cont_'+id);}});

$.Class.extend("MEE.Tools.HTML",{'hash_map':null,BuildBarText:function(barwidth,bartype){if(!bartype)
bartype='single';var bartext="";var added=true;var sizes=MEE.Data.bars[bartype].chars;while(added){var newchar="";var newcharsize=0;for(size in sizes){var sizechar=sizes[size];if(size<barwidth){if(size>newcharsize){newchar=sizechar;newcharsize=size;}}}
if(newcharsize>0){barwidth-=newcharsize;bartext+=newchar;}else{added=false;}}
return bartext;},AlignElementOver:function(target,elem,align,nosize){if($.isArray(target)){var left=99999999;var right=0;var top=99999999;var bottom=0;var pos=0;var w=0;var h=0;for(var i=0;i<target.length;i++){var telem=$(target[i]);pos=telem.offset();w=telem.outerWidth(true);h=telem.outerHeight(true);if(pos.left<left)
left=pos.left;if(pos.left+w>right)
right=pos.left+w;if(pos.top<top)
top=pos.top;if(pos.top+h>bottom)
bottom=pos.top+h;}
var pos={left:left,top:top};var w=right-left;var h=bottom-top;}else{var pos=target.offset();var w=target.outerWidth(true);var h=target.outerHeight(true);}
if(align){pos.top-=align.top;h+=align.top+align.bottom;}
if(!(nosize==false)){elem.css({'left':pos.left+'px','top':pos.top+'px','width':w+'px','height':h+'px','display':'block'});}else{elem.css({'left':pos.left+'px','top':pos.top+'px','display':'block'});}},html_entity_decode:function(string,quote_style){symbol='',entity='';if(this.hash_map==null){if(false===(this.hash_map=this.get_html_translation_table('HTML_ENTITIES',quote_style))){return false;}
delete(this.hash_map['&']);this.hash_map['&']='&amp;';}
for(symbol in this.hash_map){entity=this.hash_map[symbol];string=string.split(entity).join(symbol);}
return string;},get_html_translation_table:function(table,quote_style){var entities={},hash_map={},decimal=0,symbol='';var constMappingTable={},constMappingQuoteStyle={};var useTable={},useQuoteStyle={};constMappingTable[0]='HTML_SPECIALCHARS';constMappingTable[1]='HTML_ENTITIES';constMappingQuoteStyle[0]='ENT_NOQUOTES';constMappingQuoteStyle[2]='ENT_COMPAT';constMappingQuoteStyle[3]='ENT_QUOTES';useTable=!isNaN(table)?constMappingTable[table]:table?table.toUpperCase():'HTML_SPECIALCHARS';useQuoteStyle=!isNaN(quote_style)?constMappingQuoteStyle[quote_style]:quote_style?quote_style.toUpperCase():'ENT_COMPAT';if(useTable!=='HTML_SPECIALCHARS'&&useTable!=='HTML_ENTITIES'){throw new Error("Table: "+useTable+' not supported');}
entities['38']='&amp;';if(useTable==='HTML_ENTITIES'){entities['160']='&nbsp;';entities['161']='&iexcl;';entities['162']='&cent;';entities['163']='&pound;';entities['164']='&curren;';entities['165']='&yen;';entities['166']='&brvbar;';entities['167']='&sect;';entities['168']='&uml;';entities['169']='&copy;';entities['170']='&ordf;';entities['171']='&laquo;';entities['172']='&not;';entities['173']='&shy;';entities['174']='&reg;';entities['175']='&macr;';entities['176']='&deg;';entities['177']='&plusmn;';entities['178']='&sup2;';entities['179']='&sup3;';entities['180']='&acute;';entities['181']='&micro;';entities['182']='&para;';entities['183']='&middot;';entities['184']='&cedil;';entities['185']='&sup1;';entities['186']='&ordm;';entities['187']='&raquo;';entities['188']='&frac14;';entities['189']='&frac12;';entities['190']='&frac34;';entities['191']='&iquest;';entities['192']='&Agrave;';entities['193']='&Aacute;';entities['194']='&Acirc;';entities['195']='&Atilde;';entities['196']='&Auml;';entities['197']='&Aring;';entities['198']='&AElig;';entities['199']='&Ccedil;';entities['200']='&Egrave;';entities['201']='&Eacute;';entities['202']='&Ecirc;';entities['203']='&Euml;';entities['204']='&Igrave;';entities['205']='&Iacute;';entities['206']='&Icirc;';entities['207']='&Iuml;';entities['208']='&ETH;';entities['209']='&Ntilde;';entities['210']='&Ograve;';entities['211']='&Oacute;';entities['212']='&Ocirc;';entities['213']='&Otilde;';entities['214']='&Ouml;';entities['215']='&times;';entities['216']='&Oslash;';entities['217']='&Ugrave;';entities['218']='&Uacute;';entities['219']='&Ucirc;';entities['220']='&Uuml;';entities['221']='&Yacute;';entities['222']='&THORN;';entities['223']='&szlig;';entities['224']='&agrave;';entities['225']='&aacute;';entities['226']='&acirc;';entities['227']='&atilde;';entities['228']='&auml;';entities['229']='&aring;';entities['230']='&aelig;';entities['231']='&ccedil;';entities['232']='&egrave;';entities['233']='&eacute;';entities['234']='&ecirc;';entities['235']='&euml;';entities['236']='&igrave;';entities['237']='&iacute;';entities['238']='&icirc;';entities['239']='&iuml;';entities['240']='&eth;';entities['241']='&ntilde;';entities['242']='&ograve;';entities['243']='&oacute;';entities['244']='&ocirc;';entities['245']='&otilde;';entities['246']='&ouml;';entities['247']='&divide;';entities['248']='&oslash;';entities['249']='&ugrave;';entities['250']='&uacute;';entities['251']='&ucirc;';entities['252']='&uuml;';entities['253']='&yacute;';entities['254']='&thorn;';entities['255']='&yuml;';}
if(useQuoteStyle!=='ENT_NOQUOTES'){entities['34']='&quot;';}if(useQuoteStyle==='ENT_QUOTES'){entities['39']='&#39;';}
entities['60']='&lt;';entities['62']='&gt;';for(decimal in entities){symbol=String.fromCharCode(decimal);hash_map[symbol]=entities[decimal];}
return hash_map;},replaceAll:function(text,search,replace){var base;do{base=text;text=text.replace(search,replace);}while(base!=text)
return text;}},{});

$.Class.extend("MEE.Parser",{isTokenAlphaValidChars:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",isAlphaValidChars:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ<=>~-#",isNumericValidChars:"0123456789",isSingleLetterCommandValidChars:":,;.>\\/!*{}|",init:function(){this.customcommands={};this.apply_to_parent={};this.apply_to_thisset={};},parse:function(latex,parent){this.par=parent;this.allowspaces=0;if(this.par&&this.par.eldata&&this.par.eldata.allowspaces)
this.allowspaces=1;latex=this.removeNewLines(latex);latex=MEE.Tools.HTML.html_entity_decode(latex);var tokens=this.tokenize(latex);var elements=this.buildelements(tokens);return elements;},tokenize:function(text,sepsize,_allowspaces){var output=new Array();var type="";var sizemod=0;var sizemodscope=0;var aftersize=true;var allowspaces=this.allowspaces;if(_allowspaces)
allowspaces=true;var l=text.length;for(var i=0;i<l;i++){aftersize=true;if(text.charAt(i)==" "){if(allowspaces){var cmd={latex:"\;",type:"command",valid:true}
output.push(cmd);}else{continue;}}else if(text.charAt(i)=="\\"){if(text.charAt(i+1)=="\\")
{var cmd={latex:"",type:"newline",valid:true}
output.push(cmd);i++;type="";}else{var isvalidcommand=false;var validobj={valid:false}
var end=this.getEndOfCommand(text,i+1,validobj);isvalidcommand=validobj.valid;var inbrackets=text.substring(i+1,end);if(inbrackets=="begin"){end=this.getEndMatchedBracketPosition(text,i+6,"{","}");if(end>0)
var command=text.substring(i+7,end);var cmd={latex:command,type:"begin",valid:true}
if(end==0)
cmd.valid=false;output.push(cmd);if(end>0){i=end+1;var fintext="\\end{"+command+"}";end=this.getEndPosition(text,i,command);inbrackets=text.substring(i,end);var cmd={latex:inbrackets,type:"arg",valid:true}
output.push(cmd);i=end+fintext.length-1;}else{i=text.length;}
type="";}else if(inbrackets=="end"){end=this.getEndMatchedBracketPosition(text,i+4,"{","}");if(end>0)
var command=text.substring(i+5,end);var cmd={latex:command,type:"end",valid:true}
if(end==0)
cmd.valid=false;output.push(cmd);if(end>0){i+=6+command.length;}else{i=text.length;}}else if(this.isSizeCmd("\\"+inbrackets)){sizemod=this.getSize("\\"+inbrackets);if(sepsize){aftersize=false;var cmd={latex:sizemod,type:'size',valid:false}
output.push(cmd);}else{sizemodscope=2;}
i=end-1;}else if(this.isPairedCmd("\\"+inbrackets)){var res=this.getEndBracketPosition(text,i);var end=res.offset;var pair=this.getPairCmd("\\"+inbrackets);if(end==0){var cmd={latex:inbrackets,type:"extsingle",valid:isvalidcommand,size:sizemod}
output.push(cmd);i=i+inbrackets.length;}else{var content=text.substring(i+inbrackets.length+1,end);var trimres=this.TrimAnyRSize(content);content=trimres.text;var cmd={latex:pair.pair,type:"extpair",size:sizemod,sizer:trimres.size}
if(res.match)cmd.closing=this.getClosingBracketText(res.match);output.push(cmd);var cmd={latex:content,type:"arg"}
output.push(cmd);type="";i=end+res.match.length-1;}}else if(this.isNonPairedCmd("\\"+inbrackets)){var cmd={latex:inbrackets,type:"extsingle",size:sizemod,valid:isvalidcommand}
if(inbrackets==")"||inbrackets=="}"||inbrackets=="]"||inbrackets.substr(0,1)=="r")
cmd.isclosing=true;output.push(cmd);i=end-1;}else if(inbrackets==""){var cmd={latex:inbrackets,type:"command",size:sizemod,valid:false}
output.push(cmd);}else{var cmd={};if(type!=""){cmd.latex="\\"+inbrackets;cmd.type=type;cmd.valid=isvalidcommand;output.push(cmd);}else{cmd.latex=inbrackets;cmd.valid=isvalidcommand;cmd.type="command";var eldata=this.getElementData(cmd);if(eldata.all_as_arg01){var before=text.substr(0,i);var after=text.substr(i+inbrackets.length+1);output=new Array();var isvalid=true;if(after==""){cmd.valid=false;isvalid=false;}
output.push(cmd);cmd={latex:before,type:"arg",valid:isvalid}
output.push(cmd);cmd={latex:after,type:"arg",valid:isvalid}
output.push(cmd);return output;}else if(eldata.rest_as_arg0){output.push(cmd);cmd={latex:text.substr(i+inbrackets.length+1),type:"arg",valid:true}
output.push(cmd);return output;}else{output.push(cmd);}}
type="";i=end-1;}}}else if(text.charAt(i)=="{"){var end=this.getEndMatchedBracketPosition(text,i,"{","}");if(end>0){var inbrackets=text.substring(i+1,end);if(type=="")
type="arg";var cmd={latex:inbrackets,type:type,valid:true}
output.push(cmd);type="";i=end;}else{var inbrackets=text.substring(i+1);if(type=="")
type="arg";var cmd={latex:inbrackets,type:type,incompletearg:1,valid:true}
output.push(cmd);type="";i=text.length;}}else if(text.charAt(i)=="("||(text.charAt(i)=='.'&&sizemod!=0)){var res=this.getEndBracketPosition(text,i);var end=res.offset;if(end>0){var inbrackets=text.substring(i+1,end);var trimres=this.TrimAnyRSize(inbrackets);;inbrackets=trimres.text;var cmd={};if(text.charAt(i)=='.'){cmd.latex="pdotbrackets";}else{cmd.latex="pbrackets";}
cmd.type="extpair";cmd.size=sizemod;cmd.sizer=trimres.size;if(res.match)cmd.closing=this.getClosingBracketText(res.match);output.push(cmd);var cmd={latex:inbrackets,type:"arg"}
output.push(cmd);type="";i=end+res.match.length-1;}else{var cmd={latex:"(",type:"extsingle",size:sizemod,valid:true}
output.push(cmd);}}else if(text.charAt(i)=="["){var end=this.getEndMatchedBracketPosition(text,i,"[","]");if(end>0){var inbrackets=text.substring(i+1,end);var trimres=this.TrimAnyRSize(inbrackets);inbrackets=trimres.text;var cmd={latex:"psqbrackets",type:"extpair",size:sizemod,sizer:trimres.size}
output.push(cmd);var cmd={latex:inbrackets,type:"arg"}
output.push(cmd);type="";i=end;}else{var res=this.getEndBracketPosition(text,i);var end=res.offset;if(end>0){var inbrackets=text.substring(i+1,end);var trimres=this.TrimAnyRSize(inbrackets);;inbrackets=trimres.text;var cmd={latex:"psqbrackets",type:"extpair",size:sizemod,sizer:trimres.size}
if(res.match)cmd.closing=this.getClosingBracketText(res.match);output.push(cmd);var cmd={latex:inbrackets,type:"arg"}
output.push(cmd);type="";i=end+res.match.length-1;}else{var cmd={latex:"[",type:"extsingle",size:sizemod,incompletearg:1,valid:true};output.push(cmd);}}}else if(text.charAt(i)=="}"||text.charAt(i)==")"||text.charAt(i)=="]"){var cmd={latex:text.charAt(i),type:"extsingle",size:sizemod,valid:true,isclosing:true}
output.push(cmd);}else if(text.charAt(i)=="_"){type="subscript";}else if(text.charAt(i)=="}"){}else if(text.charAt(i)=="^"){type="superscript";}else if(text.charAt(i)=="/"){var cmd={latex:text.charAt(i),type:"extsingle",size:sizemod,valid:true};output.push(cmd);}else{if(text.charAt(i)=="&"){var cmd={latex:"",type:"tab",valid:true}
output.push(cmd);type="";}else{var ch=text.charAt(i);var cmd={latex:ch,type:type,valid:true};output.push(cmd);type="";}}
sizemodscope--;if(sizemodscope==0)
sizemod=0;}
if(type!=""){var cmd={latex:'',type:type,valid:true};output.push(cmd);}
if(output.length>0){for(var i=0;i<output.length;i++){var lastcmd=output[i];if(lastcmd.type=='size'&&aftersize)
lastcmd.valid=true;}}
return output;},buildelements:function(tokens){var i;var elems=new Array();this.removeprev=false;for(i=0;i<tokens.length;i++){var token=tokens[i];var eldata=this.getElementData(token);if(token.type==""||token.type=="command"||token.type=="extpair"){if(token.type=="command"&&token.latex=="end"){i++;continue;}
if(eldata.apply_to_parent){this.apply_to_parent=jQuery.extend(this.apply_to_parent,eldata.apply_to_parent);continue;}else if(eldata.apply_to_thisset){this.apply_to_thisset=jQuery.extend(this.apply_to_thisset,eldata.apply_to_thisset);continue;}
if(token.latex=="newcommand"){var nametoken=tokens[++i];i++;var counttoken=tokens[++i];var valuetoken=tokens[++i];if(!nametoken||!counttoken||!valuetoken)
continue;var cc={count:counttoken.latex,value:valuetoken.latex};this.customcommands[nametoken.latex]=cc;continue;}else if('\\'+token.latex in this.customcommands){var cc=this.customcommands['\\'+token.latex];var text=cc.value;for(var arg=0;arg<cc.count;arg++){var toreplace='#'+(arg+1);var argtoken=tokens[++i];var replacewith=argtoken.latex;text=text.replace(new RegExp(toreplace,'g'),replacewith);}
var newtoken={type:"arg",value:true,latex:text};elem=new MEE.Elem(newtoken,this.getElementData('base'));elem.SetMain(newtoken);elems.push(elem);continue;}
var elem=null;if(eldata.object){var name="Elem"+eldata.object;elem=new MEE[name](token,eldata);}else{elem=new MEE.Elem(token,eldata);}
if(eldata.parseinner){var token2=tokens[i+1];if(token2&&token2.type=="arg"){if(token2.latex.indexOf('$')>-1){var parts=token2.latex.split('$');var newtoken={type:'arg',valid:true,latex:parts[0]};elem.SetMain(newtoken);for(var k=1;k<parts.length;k++){elems.push(elem);if(k%2==1){newtoken={valid:true,latex:parts[k],type:'arg'};elem=new MEE.Elem(newtoken,this.getElementData('base'));elem.SetMain(newtoken);}else{newtoken={valid:true,latex:token.latex,type:token.type};elem=new MEE.Elem(newtoken,eldata);newtoken={valid:true,latex:parts[k],type:'arg'};var argelem=new MEE.Elem(newtoken,this.getElementData('base'));elem.SetMain(argelem);}}
i++;}}}
i=this.addToElement(tokens,i,elem);if(this.removeprev){elems.pop();}
elems.push(elem);}else if(token.type=="superscript"||token.type=="subscript"){if(elems.length==0){var blanktoken={latex:MEE.Data.blankspace,type:''}
var eldata=jQuery.extend({},this.getElementData('base'));eldata.blank=1;var elem=new MEE.Elem(blanktoken,eldata);elems.push(elem);}else{var elem=elems[elems.length-1];}
elem.SetScript(token);}else if(token.type=="arg"){var elem=new MEE.Elem(token,this.getElementData('base'));elem.SetMain(token);elems.push(elem);}else if(token.type=="begin"){var elem=new MEE.Elem(token,eldata);var eldata=this.getElementData(token);var alignment="";if(tokens.length>i+1){if(eldata.custalign){var text=$.trim(tokens[i+1].latex);if(text.charAt(0)=="["){var end=text.indexOf(']');if(end!=-1){alignment=text.substr(1,end-1);tokens[i+1].latex=text.substr(end+1);}}else if(text.charAt(0)=="{"){var end=text.indexOf('}');if(end!=-1){alignment=text.substr(1,end-1);tokens[i+1].latex=text.substr(end+1);}}else{if(token.latex.substr(token.latex.length-1)=="*"){alignment=text.substr(0,1)
tokens[i+1].latex=text.substr(1);}}}
elem.AddArray(tokens[i+1],alignment);i++;}
elems.push(elem);}else if(token.type=="extsingle"){elems.push(new MEE.Elem(token,eldata));}}
return elems;},addToElement:function(tokens,i,elem){var elemdata=this.getElementData(tokens[i]);elemdata=jQuery.extend(true,{},elemdata);var argno=0;i=i+1;if(elemdata.next_as_arg0&&i<tokens.length){elem.AddArg(tokens[i]);return i;}
for(;i<tokens.length;i++){var token=tokens[i];if(token.type=="superscript"){elem.SetScript(token);}else if(token.type=="subscript"){elem.SetScript(token);}else if(token.type=="command"){var eldatac=this.getElementData(token);if(eldatac.apply_to_previous){elem.eldata=$.extend(elem.eldata,eldatac.apply_to_previous);}else{break;}}else if(token.type=="arg"){if(elemdata.arg01_as_upperlower&&argno==0){elem.AddUpperLower(token,tokens[i+1]);elemdata.args--;i++;}else if(elemdata.arg0_as_array&&argno==0){elem.AddArray(token,tokens[i+1]);elemdata.args-=2;i++;}else if(elemdata.arg0_as_upper&&argno==0){elem.AddUpperLower(token,null);elemdata.args--;}else if(elemdata.arg0_as_main&&argno==0){elem.SetMain(token);elemdata.args--;}else if(elemdata.arg0_as_super&&argno==0){elem.SetScript(token,"superscript");elemdata.args--;}else if(elemdata.arg0_as_sub&&argno==0){elem.SetScript(token,"subscript");elemdata.args--;}else if(elemdata.arg1_as_main&&argno==1){elem.SetMain(token);elemdata.args--;}else if(elemdata.args>0){elem.AddArg(token);elemdata.args--;}else{break;}
argno++;}else if(token.type=="extpair"){if(token.latex=="psqbrackets"){if(elemdata.sarg_as_sup){elem.SetScript(tokens[i+1],"superscript");i++;elemdata.sarg=0;}else if(elemdata.sarg_as_lower){elem.AddUpperLower(null,tokens[i+1]);i++;elemdata.sarg=0;}else if(elemdata.sarg>0){elem.SetSArg(tokens[i+1]);i++;elemdata.sarg=0;}else{break;}}else{break;}}else{break;}}
return i-1;},getElementData:function(token){if(token.type==""){if(this.isTokenAlpha(token.latex)){var eldata=MEE.Data.commands.variable;eldata._name='variable';return eldata;}else if(this.isNumeric(token.latex)){var eldata=MEE.Data.commands.digit;eldata._name='digit';return eldata;}}
var latex=token.latex;if(token.type!="")
latex="\\"+latex;var el=MEE.Data.commands[latex];if(el){el._name=latex;return el;}
if(token.type=="command"){var eldata=MEE.Data.commands['invalidcommand'];eldata._name='invalidcommand';return eldata;}
el={args:0,sarg:0,_name:latex}
return el;},isAlpha:function(sText){var IsNumber=true;for(i=sText.length;i--;){if(this.isAlphaValidChars.indexOf(sText.charAt(i))==-1){IsNumber=false;break;}}
return IsNumber;},isTokenAlpha:function(sText){var IsNumber=true;var Ch;for(i=sText.length;i--;){if(this.isTokenAlphaValidChars.indexOf(sText.charAt(i))==-1){IsNumber=false;break;}}
return IsNumber;},isNumeric:function(sText){var IsNumber=true;for(i=sText.length;i--;){if(this.isNumericValidChars.indexOf(sText.charAt(i))==-1){IsNumber=false;break;}}
return IsNumber;},isSingleLetterCommand:function(sText){if(this.isSingleLetterCommandValidChars.indexOf(sText)!=-1)
return true;return false;},getEndPosition:function(text,initial,command){var tofind="\\end{"+command+"}";var newopen="\\begin{"+command+"}";var depth=1;for(var i=initial;i<text.length;i++){var match1=text.substr(i,tofind.length);var match2=text.substr(i,newopen.length);if(match1==tofind){depth--;}else if(match2==newopen){depth++;}
if(depth==0)
return i;}
return text.length;},getEndOfCommand:function(text,initial,isvalidcommand){for(var i=initial;i<text.length;i++){if(i==initial){if(this.isSingleLetterCommand(text.charAt(i))){isvalidcommand.valid=true;return i+1;}}
if(!this.isAlpha(text.charAt(i))){isvalidcommand.valid=true;return i;}
if(i!=initial){if(text.charAt(i)=="\\"){isvalidcommand.valid=true;return i;}}}
return text.length;},getEndMatchedBracketPosition:function(text,initial,open,close){var bkcount=0;for(var i=initial;i<text.length;i++){if(text.charAt(i)==open&&text.charAt(i-1)!="\\")
bkcount++;if(text.charAt(i)==close&&text.charAt(i-1)!="\\")
bkcount--;if(bkcount==0)
return i;}
return 0;},getEndBracketPosition:function(text,initial,open,close){var bkcount=0;var result={offset:0,match:""}
for(var k=0;k<MEE.Data.pairs.length;k++){if(MEE.Data.pairs[k].left==MEE.Data.pairs[k].right){MEE.Data.pairs[k].matched=1;}else{MEE.Data.pairs[k].matched=0;}
MEE.Data.pairs[k].count=0;}
for(var i=initial;i<text.length;i++){for(var k=0;k<MEE.Data.pairs.length;k++){var llen=MEE.Data.pairs[k].left.length;var matchok=true;if(MEE.Data.pairs[k].matched&&bkcount%2==1)
matchok=false;if(text.substr(i,llen)==MEE.Data.pairs[k].left&&matchok){bkcount++;if(MEE.Data.pairs[k].matched)
MEE.Data.pairs[k].count=1;}else{var llen=MEE.Data.pairs[k].right.length;if(text.substr(i,llen)==MEE.Data.pairs[k].right){if(MEE.Data.pairs[k].onlysized){var tocheck=text.substr(initial,i-initial);var dotok=false;for(var m=0;m<MEE.Data.sizemodifiers.length;m++){var rightmod=MEE.Data.sizemodifiers[m].right;if(tocheck.substr(tocheck.length-rightmod.length)==rightmod){dotok=true;break;}}
if(!dotok)
continue;}
result.match=MEE.Data.pairs[k].right;bkcount--;MEE.Data.pairs[k].count=0;}}}
if(bkcount==0){result.offset=i;return result;}}
result.match="";result.offset=0;return result;},removeNewLines:function(latex){latex=this.replaceAll(latex,/\n/,"");latex=this.replaceAll(latex,/\t/,"");return latex;},replaceAll:function(text,search,replace){var base;do{base=text;text=text.replace(search,replace);}while(base!=text)
return text;},isSizeCmd:function(text){var i=0;for(i=0;i<MEE.Data.sizemodifiers.length;i++){var left=MEE.Data.sizemodifiers[i].left;var right=MEE.Data.sizemodifiers[i].right;if(text==left)
return true;if(text==right)
return true;}
if(text in MEE.Data.sizemodifiers_single){return true;}
return false;},getSize:function(text){var i=0;for(i=0;i<MEE.Data.sizemodifiers.length;i++){var left=MEE.Data.sizemodifiers[i].left;var right=MEE.Data.sizemodifiers[i].right;if(text==left)
return MEE.Data.sizemodifiers[i].size;if(text==right)
return MEE.Data.sizemodifiers[i].size;}
if(text in MEE.Data.sizemodifiers_single){return MEE.Data.sizemodifiers_single[text];}
return 0;},TrimAnyRSize:function(text){text=$.trim(text);var result={text:text,size:0}
for(var i=0;i<MEE.Data.sizemodifiers.length;i++){var len=MEE.Data.sizemodifiers[i].right.length;if(text.substr(text.length-len,len)==MEE.Data.sizemodifiers[i].right){result.text=text.substr(0,text.length-len);result.size=this.getSize(text.substr(text.length-len,len));return result;}}
return result;},isPairedCmd:function(text,leftonly){var i=0;if(leftonly==undefined)
leftonly=true;for(i=0;i<MEE.Data.pairs.length;i++){var left=MEE.Data.pairs[i].left;var right=MEE.Data.pairs[i].right;if(text==left)
return true;if(!leftonly&&text==right)
return true;}
return false;},getPairCmd:function(text){var i=0;for(i=0;i<MEE.Data.pairs.length;i++){var left=MEE.Data.pairs[i].left;var right=MEE.Data.pairs[i].right;if(text==left)
return MEE.Data.pairs[i];if(text==right)
return MEE.Data.pairs[i];}
return null;},findPairEnd:function(text,initial,pair){var tofind=pair.right;var newopen=pair.left;var depth=1;for(var i=initial;i<text.length;i++){var match1=text.substr(i,tofind.length);var match2=text.substr(i,newopen.length);if(match1==tofind){depth--;}else if(match2==newopen){depth++;}
if(depth==0)
return i;}
return 0;},isNonPairedCmd:function(text){var i=0;for(i=0;i<MEE.Data.nonpairs.length;i++){var left=MEE.Data.nonpairs[i];if(text==left)
return true;}
return false;},getClosingBracketText:function(match){var newtoken={};newtoken.type="command";if(match.length==1){newtoken.latex=match;}else{newtoken.latex=match.substr(1);}
var closingdata=this.getElementData(newtoken);if(closingdata.text){return closingdata.text;}else{return match;}}});

$.Class.extend("MEE.Data",{init:function(){},buildBracketSizes:function(){MEE.Data.bsizes={};for(var i=0;i<MEE.Data.bracketwidths.length;i++){var data=MEE.Data.bracketwidths[i];for(var k=0;k<data.brackets.length;k++){var bracket=data.brackets[k];var bsize={};for(var s=0;s<5;s++){var size={width:data[s],height:MEE.Data.bracketheights[s]}
bsize['size'+s]=size;}
bsize.scalew=data.s;bsize.haslarge=data.haslarge;bsize.canscale=data.canscale;MEE.Data.bsizes[bracket]=bsize;}}
var t=0;},buildNamedOps:function(){MEE.Data.namedops=[];$.each(MEE.Data.commands,function(cmd,data){if(data.cantype){if(cmd.substr(0,1)=="\\"){MEE.Data.namedops.push(cmd.substr(1));}}});},buildDefs:function(){$.each(MEE.Data.commands,function(cmd,data){if(data.base){var base=MEE.Data.commands[data.base];if(!base)
return;$.each(base,function(basecmd,baseval){if(basecmd in data){var k=0;}else{data[basecmd]=baseval;}});}});var k=0;},getCharSize:function(ch,scope){if(!ch in MEE.Data.charsizes){var size={top:0,height:0}
return size;}
var size=jQuery.extend({},MEE.Data.charsizes[ch]);size.top=$(size.top).toPx({'scope':scope});size.height=$(size.height).toPx({'scope':scope});return size;},getLargeCharData:function(ch,scope,size){var array='largechars';if(size&&size!=2)
array='largechars_size'+size;if(!ch in MEE.Data[array]){var size={top:0,bottom:0,width:0,offset:0}
return size;}
var size=jQuery.extend({},MEE.Data[array][ch]);if(!size.top)size.top=0;if(!size.bottom)size.bottom=0;if(!size.width)size.width=0;if(!size.offset)size.offset=0;size.top=$(size.top).toPx({'scope':scope});size.bottom=$(size.bottom).toPx({'scope':scope});size.width=$(size.width).toPx({'scope':scope});size.offset=$(size.offset).toPx({'scope':scope});return size;},getBracket:function(bracket){var r=MEE.Data.extbrackets[bracket];if(!r)
return MEE.Data.extbrackets['('];return r;},getBaseSize:function(elem){if(!elem)
return 0;if(elem.length==0)
return 0;var fontsize=$(elem).css('font-size');if(!fontsize)
return 0;fontsize=fontsize.replace('px','');fontsize=fontsize/0.853;return Math.round(fontsize);}},{});

MEE.Data.commands={'base':{},'variable':{args:0,sarg:0,mainclass:'mee_variable'},'digit':{args:0,sarg:0,mainclass:'mee_digit'},'\\input':{object:'Answer'},'invalidcommand':{invalid:1},'\\XXREPLACEXX':{text:'',replaceme:1},'base_greek':{mainclass:'mee_greek'},'\\alpha':{base:'base_greek',text:'&#x03B1;'},'\\beta':{base:'base_greek',text:'&#x03B2;'},'\\gamma':{base:'base_greek',text:'&#x03B3;'},'\\delta':{base:'base_greek',text:'&#x03B4;'},'\\epsilon':{base:'base_greek',text:'&#x03F5;'},'\\zeta':{base:'base_greek',text:'&#x03B6;'},'\\eta':{base:'base_greek',text:'&#x03B7;'},'\\theta':{base:'base_greek',text:'&#x03B8;'},'\\iota':{base:'base_greek',text:'&#x03B9;'},'\\kappa':{base:'base_greek',text:'&#x03BA;'},'\\lambda':{base:'base_greek',text:'&#x03BB;'},'\\mu':{base:'base_greek',text:'&#x03BC;'},'\\nu':{base:'base_greek',text:'&#x03BD;'},'\\xi':{base:'base_greek',text:'&#x03BE;'},'\\omicron':{base:'base_greek',text:'&#x03BF;'},'\\pi':{base:'base_greek',text:'&#x03C0;'},'\\rho':{base:'base_greek',text:'&#x03C1;'},'\\sigma':{base:'base_greek',text:'&#x03C3;'},'\\tau':{base:'base_greek',text:'&#x03C4;'},'\\upsilon':{base:'base_greek',text:'&#x03C5;'},'\\phi':{base:'base_greek',text:'&#x03D5;'},'\\chi':{base:'base_greek',text:'&#x03C7;'},'\\psi':{base:'base_greek',text:'&#x03C8;'},'\\omega':{base:'base_greek',text:'&#x03C9;'},'\\varepsilon':{base:'base_greek',text:'&#x03B5;'},'\\vartheta':{base:'base_greek',text:'&#x03D1;'},'\\varpi':{base:'base_greek',text:'&#x03D6;'},'\\varrho':{base:'base_greek',text:'&#x03F1;'},'\\varsigma':{base:'base_greek',text:'&#x03C2;'},'\\varphi':{base:'base_greek',text:'&#x03C6;'},'\\digamma':{base:'base_greek',text:'&#x03DC;'},'\\varkappa':{base:'base_greek',text:'&#x03F0;'},'base_greek_upper':{},'\\Gamma':{base:'base_greek_upper',text:'&#x0393;'},'\\Delta':{base:'base_greek_upper',text:'&#x0394;'},'\\Theta':{base:'base_greek_upper',text:'&#x0398;'},'\\Lambda':{base:'base_greek_upper',text:'&#x039B;'},'\\Xi':{base:'base_greek_upper',text:'&#x039E;'},'\\Pi':{base:'base_greek_upper',text:'&#x03A0;'},'\\Sigma':{base:'base_greek_upper',text:'&#x03A3;'},'\\Upsilon':{base:'base_greek_upper',text:'&#x03A5;'},'\\Phi':{base:'base_greek_upper',text:'&#x03A6;'},'\\Psi':{base:'base_greek_upper',text:'&#x03A8;'},'\\Omega':{base:'base_greek_upper',text:'&#x03A9;'},'base_ordsymbol':{},'\\S':{base:'base_ordsymbol',text:'&#x00A7;'},'\\hbar':{base:'base_ordsymbol',text:'&#x210F;'},'\\imath':{base:'base_ordsymbol',text:'&#x0131;'},'\\jmath':{base:'base_ordsymbol',text:'&#x0237;'},'\\ell':{base:'base_ordsymbol',text:'&#x2113;'},'base_ordsymbol_norm':{text:''},'\\degree':{base:'base_ordsymbol_norm',text:'&#x00B0;'},'\\aleph':{base:'base_ordsymbol_norm',text:'&#x2135;'},'\\wp':{base:'base_ordsymbol_norm',text:'&#x2118;'},'\\Re':{base:'base_ordsymbol_norm',text:'&#x211C;'},'\\Im':{base:'base_ordsymbol_norm',text:'&#x2111;'},'\\partial':{base:'base_ordsymbol_norm',text:'&#x2202;'},'\\infty':{base:'base_ordsymbol_norm',text:'&#x221E;'},'\\prime':{base:'base_ordsymbol_norm',text:'&#x2032;'},'\\emptyset':{base:'base_ordsymbol_norm',text:'&#x2205;'},'\\nabla':{base:'base_ordsymbol_norm',text:'&#x2207;'},'\\top':{base:'base_ordsymbol_norm',text:'&#x22A4;'},'\\bot':{base:'base_ordsymbol_norm',text:'&#x22A5;'},'\\angle':{base:'base_ordsymbol_norm',text:'&#x2220;'},'\\triangle':{base:'base_ordsymbol_norm',text:'&#x25B3;'},'\\backslash':{base:'base_ordsymbol_norm',text:'&#x2216;'},'\\forall':{base:'base_ordsymbol_norm',text:'&#x2200;'},'\\exists':{base:'base_ordsymbol_norm',text:'&#x2203;'},'\\neg':{base:'base_ordsymbol_norm',text:'&#x00AC;'},'\\lnot':{base:'base_ordsymbol_norm',text:'&#x00AC;'},'\\flat':{base:'base_ordsymbol_norm',text:'&#x266D;'},'\\natural':{base:'base_ordsymbol_norm',text:'&#x266E;'},'\\sharp':{base:'base_ordsymbol_norm',text:'&#x266F;'},'\\clubsuit':{base:'base_ordsymbol_norm',text:'&#x2663;'},'\\diamondsuit':{base:'base_ordsymbol_norm',text:'&#x2662;'},'\\heartsuit':{base:'base_ordsymbol_norm',text:'&#x2661;'},'\\spadesuit':{base:'base_ordsymbol_norm',text:'&#x2660;'},'\\beth':{base:'base_ordsymbol_norm',text:'&#x2136;'},'\\daleth':{base:'base_ordsymbol_norm',text:'&#x2138;'},'\\gimel':{base:'base_ordsymbol_norm',text:'&#x2137;'},'\\complement':{base:'base_ordsymbol_norm',text:'&#x2201;'},'\\eth':{base:'base_ordsymbol_norm',text:'&eth;'},'\\hslash':{base:'base_ordsymbol_norm',text:'&#x0210F;',elemclass:'mee_font_bb'},'\\mho':{base:'base_ordsymbol_norm',text:'&#x2127;'},'\\circledS':{base:'base_ordsymbol_norm',text:'&#x024C8;'},'\\Bbbk':{base:'base_ordsymbol_norm',text:'k',elemclass:'mee_font_bb'},'\\Finv':{base:'base_ordsymbol_norm',text:'&#x2132;'},'\\Game':{base:'base_ordsymbol_norm',text:'&#x2141;',elemclass:'mee_font_bb'},'\\surd':{base:'base_ordsymbol_norm',text:'&#x221A;'},'base_binary':{mainclass:'mee_binary',noautofrac:1},'\\triangleleft':{base:'base_binary',text:'&#x25C3;'},'\\triangleright':{base:'base_binary',text:'&#x25B9;'},'\\bigtriangleup':{base:'base_binary',text:'&#x25B3;'},'\\bigtriangledown':{base:'base_binary',text:'&#x25BD;'},'\\wedge':{base:'base_binary',text:'&#x2227;'},'\\land':{base:'base_binary',text:'&#x2227;'},'\\vee':{base:'base_binary',text:'&#x2228;'},'\\lor':{base:'base_binary',text:'&#x2228;'},'\\cap':{base:'base_binary',text:'&#x2229;'},'\\cup':{base:'base_binary',text:'&#x222A;'},'\\ddagger':{base:'base_binary',text:'&#x2021;'},'\\dagger':{base:'base_binary',text:'&#x2020;'},'\\sqcap':{base:'base_binary',text:'&#x2293;'},'\\sqcup':{base:'base_binary',text:'&#x2294;'},'\\uplus':{base:'base_binary',text:'&#x228E;'},'\\amalg':{base:'base_binary',text:'&#x2A3F;'},'\\diamond':{base:'base_binary',text:'&#x22C4;'},'\\bullet':{base:'base_binary',text:'&#x2219;'},'\\wr':{base:'base_binary',text:'&#x2240;'},'\\div':{base:'base_binary',text:'&#x00F7;'},'\\odot':{base:'base_binary',text:'&#x2299;'},'\\oslash':{base:'base_binary',text:'&#x2298;'},'\\otimes':{base:'base_binary',text:'&#x2297;'},'\\ominus':{base:'base_binary',text:'&#x2296;'},'\\oplus':{base:'base_binary',text:'&#x2295;'},'\\mp':{base:'base_binary',text:'&#x2213;'},'\\pm':{base:'base_binary',text:'&#x00B1;'},'\\circ':{base:'base_binary',text:'&#x2218;'},'\\bigcirc':{base:'base_binary',text:'&#x25EF;'},'\\setminus':{base:'base_binary',text:'&#x2216;'},'\\cdot':{base:'base_binary',text:'&#x22C5;'},'\\ast':{base:'base_binary',text:'&#x2217;'},'\\times':{base:'base_binary',text:'&#x00D7;'},'\\star':{base:'base_binary',text:'&#x22C6;'},'\\&':{base:'base_binary',text:'&amp;'},'=':{base:'base_binary'},'+':{base:'base_binary'},'-':{base:'base_binary'},'&#x2212;':{base:'base_binary'},'*':{base:'base_binary'},'&#x2217;':{base:'base_binary'},'\\hyphen':{base:'base_binary',text:'&#x002D;'},'base_relation':{mainclass:'mee_operator'},'\\propto':{base:'base_relation',text:'&#x221D;'},'\\sqsubseteq':{base:'base_relation',text:'&#x2291;'},'\\sqsupseteq':{base:'base_relation',text:'&#x2292;'},'\\parallel':{base:'base_relation',text:'&#x2225;'},'\\mid':{base:'base_relation',text:'&#x2223;'},'\\dashv':{base:'base_relation',text:'&#x22A3;'},'\\vdash':{base:'base_relation',text:'&#x22A2;'},'\\leq':{base:'base_relation',text:'&#x2264;'},'\\le':{base:'base_relation',text:'&#x2264;'},'\\geq':{base:'base_relation',text:'&#x2265;'},'\\ge':{base:'base_relation',text:'&#x2265;'},'\\lt':{base:'base_relation',text:'&#x003C;'},'\\gt':{base:'base_relation',text:'&#x003E;'},'\\succ':{base:'base_relation',text:'&#x227B;'},'\\prec':{base:'base_relation',text:'&#x227A;'},'\\approx':{base:'base_relation',text:'&#x2248;'},'\\succeq':{base:'base_relation',text:'&#x2AB0;'},'\\preceq':{base:'base_relation',text:'&#x2AAF;'},'\\supset':{base:'base_relation',text:'&#x2273;'},'\\subset':{base:'base_relation',text:'&#x2282;'},'\\supseteq':{base:'base_relation',text:'&#x2287;'},'\\subseteq':{base:'base_relation',text:'&#x2286;'},'\\in':{base:'base_relation',text:'&#x2208;'},'\\ni':{base:'base_relation',text:'&#x220B;'},'\\notin':{base:'base_relation',text:'&#x2209;'},'\\owns':{base:'base_relation',text:'&#x220B;'},'\\gg':{base:'base_relation',text:'&#x226B;'},'\\ll':{base:'base_relation',text:'&#x226A;'},'\\sim':{base:'base_relation',text:'&#x223C;'},'\\simeq':{base:'base_relation',text:'&#x2243;'},'\\perp':{base:'base_relation',text:'&#x22A5;'},'\\equiv':{base:'base_relation',text:'&#x2261;'},'\\asymp':{base:'base_relation',text:'&#x224D;'},'\\smile':{base:'base_relation',text:'&#x2323;'},'\\frown':{base:'base_relation',text:'&#x2322;'},'\\ne':{base:'base_relation',text:'&#x2260;'},'\\neq':{base:'base_relation',text:'&#x2260;'},'\\cong':{base:'base_relation',text:'&#x2245;'},'\\doteq':{base:'base_relation',text:'&#x2250;'},'\\bowtie':{base:'base_relation',text:'&#x22C8;'},'\\models':{base:'base_relation',text:'&#x22A8;'},'\\notChar':{base:'base_relation',text:'&#x0338;'},'base_arrows':{mainclass:'mee_arrows'},'\\Leftrightarrow':{base:'base_arrows',text:'&#x21D4;'},'\\Leftarrow':{base:'base_arrows',text:'&#x21D0;'},'\\Rightarrow':{base:'base_arrows',text:'&#x21D2;'},'\\leftrightarrow':{base:'base_arrows',text:'&#x2194;'},'\\leftarrow':{base:'base_arrows',text:'&#x2190;'},'\\gets':{base:'base_arrows',text:'&#x2190;'},'\\rightarrow':{base:'base_arrows',text:'&#x2192;'},'\\to':{base:'base_arrows',text:'&#x2192;'},'\\mapsto':{base:'base_arrows',text:'&#x21A6;'},'\\leftharpoonup':{base:'base_arrows',text:'&#x21BC;'},'\\leftharpoondown':{base:'base_arrows',text:'&#x21BD;'},'\\rightharpoonup':{base:'base_arrows',text:'&#x21C0;'},'\\rightharpoondown':{base:'base_arrows',text:'&#x21C1;'},'\\nearrow':{base:'base_arrows',text:'&#x2197;'},'\\searrow':{base:'base_arrows',text:'&#x2198;'},'\\nwarrow':{base:'base_arrows',text:'&#x2196;'},'\\swarrow':{base:'base_arrows',text:'&#x2199;'},'\\rightleftharpoons':{base:'base_arrows',text:'&#x21CC;'},'\\hookrightarrow':{base:'base_arrows',text:'&#x21AA;'},'\\hookleftarrow':{base:'base_arrows',text:'&#x21A9;'},'\\longleftarrow':{base:'base_arrows',text:'&#x27F5;'},'\\Longleftarrow':{base:'base_arrows',text:'&#x27F8;'},'\\longrightarrow':{base:'base_arrows',text:'&#x27F6;'},'\\Longrightarrow':{base:'base_arrows',text:'&#x27F9;'},'\\Longleftrightarrow':{base:'base_arrows',text:'&#x27FA;'},'\\longleftrightarrow':{base:'base_arrows',text:'&#x27F7;'},'\\longmapsto':{base:'base_arrows',text:'&#x27FC;'},'\\circlearrowleft':{base:'base_arrows',text:'&#x21BA;'},'\\circlearrowright':{base:'base_arrows',text:'&#x21BB;'},'\\curvearrowleft':{base:'base_arrows',text:'&#x21B6;'},'\\curvearrowright':{base:'base_arrows',text:'&#x21B7;'},'\\downdownarrows':{base:'base_arrows',text:'&#x21CA;'},'\\downharpoonleft':{base:'base_arrows',text:'&#x21C3;'},'\\downharpoonright':{base:'base_arrows',text:'&#x21C2;'},'\\leftarrowtail':{base:'base_arrows',text:'&#x21A2;'},'\\leftleftarrows':{base:'base_arrows',text:'&#x21C7;'},'\\leftrightarrows':{base:'base_arrows',text:'&#x21C6;'},'\\leftrightharpoons':{base:'base_arrows',text:'&#x21CB;'},'\\leftrightsquigarrow':{base:'base_arrows',text:'&#x21AD;'},'\\Lleftarrow':{base:'base_arrows',text:'&#x21DA;'},'\\looparrowleft':{base:'base_arrows',text:'&#x21AB;'},'\\looparrowright':{base:'base_arrows',text:'&#x21AC;'},'\\Lsh':{base:'base_arrows',text:'&#x21B0;'},'\\multimap':{base:'base_arrows',text:'&#x22B8;'},'\\nLeftarrow':{base:'base_arrows',text:'&#x21CD;'},'\\nLeftrightarrow':{base:'base_arrows',text:'&#x21CE;'},'\\nRightarrow':{base:'base_arrows',text:'&#x21CF;'},'\\nleftarrow':{base:'base_arrows',text:'&#x219A;'},'\\nleftrightarrow':{base:'base_arrows',text:'&#x21AE;'},'\\nrightarrow':{base:'base_arrows',text:'&#x219B;'},'\\rightarrowtail':{base:'base_arrows',text:'&#x21A3;'},'\\rightleftarrows':{base:'base_arrows',text:'&#x21C4;'},'\\rightrightarrows':{base:'base_arrows',text:'&#x21C9;'},'\\rightsquigarrow':{base:'base_arrows',text:'&#x21DD;'},'\\Rrightarrow':{base:'base_arrows',text:'&#x21DB;'},'\\Rsh':{base:'base_arrows',text:'&#x21B1;'},'\\twoheadleftarrow':{base:'base_arrows',text:'&#x219E;'},'\\twoheadrightarrow':{base:'base_arrows',text:'&#x21A0;'},'\\upharpoonleft':{base:'base_arrows',text:'&#x21BF;'},'\\upharpoonright':{base:'base_arrows',text:'&#x21BE;'},'\\upuparrows':{base:'base_arrows',text:'&#x21C8;'},'base_misc':{},'\\ldots':{base:'base_misc',text:'&#x2026;'},'\\cdots':{base:'base_misc',text:'&#x22EF;'},'\\vdots':{base:'base_misc',text:'&#x22EE;'},'\\ddots':{base:'base_misc',text:'&#x22F1;'},'\\dots':{base:'base_misc',text:'&#x2026;'},'\\dotsc':{base:'base_misc',text:'&#x2026;'},'\\dotsb':{base:'base_misc',text:'&#x22EF;'},'\\dotsm':{base:'base_misc',text:'&#x22EF;'},'\\dotsi':{base:'base_misc',text:'&#x22EF;'},'\\dotso':{base:'base_misc',text:'&#x2026;'},'\\ldotp':{base:'base_misc',text:'&#x002E;'},'\\cdotp':{base:'base_misc',text:'&#x22C5;'},'\\colon':{base:'base_misc',text:'&#x003A;'},'base_names':{elemclass:'mee_command_elem',cantype:1},'\\arcsin':{base:'base_names'},'\\arccos':{base:'base_names'},'\\arctan':{base:'base_names'},'\\arg':{base:'base_names'},'\\cos':{base:'base_names'},'\\cosh':{base:'base_names'},'\\cot':{base:'base_names'},'\\coth':{base:'base_names'},'\\csc':{base:'base_names'},'\\deg':{base:'base_names'},'\\det':{base:'base_names',limits:'above',limits_h:1},'\\dim':{base:'base_names'},'\\exp':{base:'base_names'},'\\gcd':{base:'base_names',limits:'above',limits_l:1},'\\hom':{base:'base_names'},'\\inf':{base:'base_names',limits:'above',limits_h:1},'\\injlim':{base:'base_names',limits:'above',limits_h:1,limits_l:1,text:'inj&thinsp;lim'},'\\ker':{base:'base_names'},'\\lg':{base:'base_names'},'\\lim':{base:'base_names',limits:'above',limits_h:1},'\\liminf':{base:'base_names',limits:'above',limits_h:1,text:'lim&thinsp;inf'},'\\limsup':{base:'base_names',limits:'above',limits_h:1,limits_l:1,text:'lim&thinsp;sup'},'\\ln':{base:'base_names'},'\\log':{base:'base_names'},'\\max':{base:'base_names',limits:'above'},'\\min':{base:'base_names',limits:'above',limits_h:1},'\\Pr':{base:'base_names',limits:'above',limits_h:1},'\\sec':{base:'base_names'},'\\sin':{base:'base_names'},'\\sinh':{base:'base_names'},'\\sup':{base:'base_names',limits:'above',limits_l:1},'\\tan':{base:'base_names'},'\\tanh':{base:'base_names'},'base_largeop':{mainclass:'mee_largeop_main',limits_lx:1,limits_hx:1,large:1,size1_font_if_depth:1},'\\coprod':{base:'base_largeop',text:'&#x2210;',limits:'above'},'\\bigvee':{base:'base_largeop',text:'&#x22C1;',limits:'above'},'\\bigwedge':{base:'base_largeop',text:'&#x22C0;',limits:'above'},'\\biguplus':{base:'base_largeop',text:'&#x2A04;',limits:'above'},'\\bigcap':{base:'base_largeop',text:'&#x22C2;',limits:'above'},'\\bigcup':{base:'base_largeop',text:'&#x22C3;',limits:'above'},'\\int':{base:'base_largeop',text:'&#x222B;',offsetlimits:1,ssoffsets:{'1':{sub:-0.5,sup:0.1},'2':{sub:-0.1,sup:0.1}}},'\\intop':{base:'base_largeop',text:'&#x222B;',limits:'above',offsetlimits:1,ssoffsets:{'1':{sub:-0.5,sup:0.1},'2':{sub:-0.1,sup:0.1}}},'\\iint':{base:'base_largeop',text:'&#x222C;',offsetlimits:1,ssoffsets:{'1':{sub:-0.5,sup:0.1},'2':{sub:-0.1,sup:0.1}}},'\\iiint':{base:'base_largeop',text:'&#x222D;',offsetlimits:1,ssoffsets:{'1':{sub:-0.4,sup:0.2},'2':{sub:0.1,sup:0.3}}},'\\idotsint':{base:'base_largeop',text:'&idotsint;',limits:'',offsetlimits:1,mainclass:'mee_largeop_idotsint',ssoffsets:{'1':{sub:-0.4,sup:0.2},'2':{sub:0.1,sup:0.3}}},'\\prod':{base:'base_largeop',text:'&#x220F;',limits:'above'},'\\sum':{base:'base_largeop',text:'&#x2211;',limits:'above'},'\\bigotimes':{base:'base_largeop',text:'&#x2A02;',limits:'above'},'\\bigoplus':{base:'base_largeop',text:'&#x2A01;',limits:'above'},'\\bigodot':{base:'base_largeop',text:'&#x2A00;',limits:'above'},'\\oint':{base:'base_largeop',text:'&#x222E;',offsetlimits:1,ssoffsets:{'1':{sub:-0.5,sup:0.1},'2':{sub:-0.1,sup:0.1}}},'\\bigsqcup':{base:'base_largeop',text:'&#x2A06;',limits:'above'},'\\limits':{apply_to_previous:{foreclimits:'above'}},'\\nolimits':{apply_to_previous:{foreclimits:''}},'\\smallint':{text:'&#x222B;',limits:'above',limits_lx:1,limits_hx:1},'base_accents':{object:'Accent',args:1,mainclass:'mee_accent_main'},'\\acute':{base:'base_accents',text:'&#x02CA;'},'\\grave':{base:'base_accents',text:'&#x02CB;'},'\\ddot':{base:'base_accents',text:'&#x00A8;'},'\\dddot':{base:'base_accents',text:'...',mainclass:'mee_dots',handledots:1},'\\ddddot':{base:'base_accents',text:'....',mainclass:'mee_dots',handledots:1},'\\tilde':{base:'base_accents',text:'&#x02DC;'},'\\bar':{base:'base_accents',text:'&#x02C9;'},'\\breve':{base:'base_accents',text:'&#x02D8;'},'\\check':{base:'base_accents',text:'&#x02C7;'},'\\hat':{base:'base_accents',text:'&#x02C6;'},'\\vec':{base:'base_accents',text:'&#x20D7;',mainclass:'mee_vector',nopadleft:1},'\\dot':{base:'base_accents',text:'&#x02D9;'},'\\widetilde':{base:'base_accents',text:'&#x02DC;',accent_wide:1},'\\widehat':{base:'base_accents',text:'&#x02C6;',accent_wide:1},'base_spaces':{object:'Space'},'\\,':{base:'base_spaces',space:'0.17em'},'\\:':{base:'base_spaces',space:'0.17em'},'\\>':{base:'base_spaces',space:'0.22em'},'\\;':{base:'base_spaces',space:'0.27em'},'\\!':{base:'base_spaces',space:'0em'},'\\enspace':{base:'base_spaces',space:'0.5em'},'\\quad':{base:'base_spaces',space:'1em'},'\\qquad':{base:'base_spaces',space:'2em'},'\\thinspace':{base:'base_spaces',space:'0.17em'},'\\negthinspace':{base:'base_spaces',space:'0em'},'\\negthickspace':{base:'base_spaces',space:'0em'},'\\vphantom':{args:1,arg0_as_main:1,text:'',mainclass:'mee_vphantom'},'\\hphantom':{args:1,arg0_as_main:1,text:'',mainclass:'mee_phantom',noheight:1},'\\phantom':{args:1,arg0_as_main:1,text:'',mainclass:'mee_phantom'},'\\frac':{args:2,text:'',frac:1,arg01_as_upperlower:1,bar:1,evenpos:1,upperclass:'mee_frac_upper',lowerclass:'mee_frac_lower',noautofrac:1,bartype:'single'},'\\cfrac':{base:'\\frac',displaystyle:1},'\\dfrac':{base:'\\frac',displaystyle:1},'\\tfrac':{base:'\\frac',textstyle:1},'\\binom':{base:'\\frac',lb:'(',rb:')',bar:0,size:-1},'\\over':{all_as_arg01:1,frac:1,base:'\\frac'},'\\choose':{all_as_arg01:1,frac:1,base:'\\frac',lb:'(',rb:')',bar:0,size:-1},'\\ce':{args:1,arg0_as_main:1,simplemain:1,elemclass:'mee_font_rm'},'base_ce_relation':{elemclass:'mee_ce_relation',noautofrac:1},'\\<=>':{base:'base_ce_relation',text:'&nbsp;&#xE907;&nbsp;'},'\\<=>>':{base:'base_ce_relation',text:'&nbsp;&#xE900;&nbsp;'},'\\<->':{base:'base_ce_relation',text:'&nbsp;&#x27F7;&nbsp;'},'\\->':{base:'base_ce_relation',text:'&nbsp;&#x27F6;&nbsp;'},'\\<-':{base:'base_ce_relation',text:'&nbsp;&#x27F5;&nbsp;'},'\\sbond':{text:'&#x2212;',noautofrac:1},'\\dbond':{text:'='},'\\tbond':{text:'&#x2261;'},'\\isotope':{text:'&#x200b;'},'\\bond':{object:'Bond',text:'',args:1,arg0_as_main:1,noautofrac:1},'\\bmod':{text:'&nbsp;&nbsp;mod&nbsp;&nbsp;'},'\\pmod':{text:'mod&nbsp;&nbsp;',lb:'(',rb:')',args:1,next_as_arg0:1,elemclass:'mee_pmod'},'\\mod':{text:'mod&nbsp;',elemclass:'mee_pmod'},'\\pod':{text:'',lb:'(',rb:')',args:1,next_as_arg0:1,elemclass:'mee_pmod',size:-1},'\\sqrt':{args:1,sarg:1,sarg_as_sup:1,arg0_as_main:1,lb:'&#x221A;',limits:'sqrt',superscriptclass:'mee_sqrt_super',size:-1},'\\text':{args:1,elemclass:'mee_font_rm',arg0_as_main:1,simplemain:1,parseinner:1,allowspaces:1},'\\mbox':{base:'\\text',elemclass:'mee_font_rm'},'\\textrm':{base:'\\text',elemclass:'mee_font_rm'},'\\textit':{base:'\\text',elemclass:'mee_font_it'},'\\textbf':{base:'\\text',elemclass:'mee_font_bf_txt'},'\\boxed':{object:'Boxed',args:1,text:'',arg0_as_main:1},'base_font':{args:1,arg0_as_main:1,simplemain:1},'\\mathcal':{base:'base_font',elemclass:'mee_font_cal'},'\\cal':{base:'base_font',elemclass:'mee_font_cal',rest_as_arg0:1},'\\mathscr':{base:'base_font',elemclass:'mee_font_scr'},'\\scr':{base:'base_font',elemclass:'mee_font_scr',rest_as_arg0:1},'\\mathrm':{base:'base_font',elemclass:'mee_font_rm'},'\\rm':{base:'base_font',elemclass:'mee_font_rm',rest_as_arg0:1},'\\mathbf':{base:'base_font',elemclass:'mee_font_bf'},'\\bf':{base:'base_font',elemclass:'mee_font_bf',rest_as_arg0:1},'\\mathbb':{base:'base_font',elemclass:'mee_font_bb'},'\\Bbb':{base:'base_font',elemclass:'mee_font_bb'},'\\bbFont':{base:'base_font',elemclass:'mee_font_bb',rest_as_arg0:1},'\\mathit':{base:'base_font',elemclass:'mee_font_it'},'\\mit':{base:'base_font',elemclass:'mee_font_it'},'\\it':{base:'base_font',elemclass:'mee_font_it',rest_as_arg0:1},'\\mathfrak':{base:'base_font',elemclass:'mee_font_frak'},'\\frak':{base:'base_font',elemclass:'mee_font_frak',rest_as_arg0:1},'\\mathsf':{base:'base_font',elemclass:'mee_font_sf'},'\\sf':{base:'base_font',elemclass:'mee_font_sf',rest_as_arg0:1},'\\mathtt':{base:'base_font',elemclass:'mee_font_tt'},'\\tt':{base:'base_font',elemclass:'mee_font_tt',rest_as_arg0:1},'\\oldstyle':{base:'base_font',elemclass:'mee_font_oldstyle',rest_as_arg0:1},'\\boldsymbol':{base:'base_font',elemclass:'mee_font_bold'},'\\pmb':{base:'base_font',elemclass:'mee_font_bold'},'base_brackets':{args:1,arg0_as_main:1,changetype:'extpair'},'\\pbrackets':{base:'base_brackets',lb:'(',rb:')'},'\\pdotbrackets':{base:'base_brackets',lb:'',rb:''},'\\psqbrackets':{base:'base_brackets',lb:'[',rb:']'},'\\pbrace':{base:'base_brackets',lb:'{',rb:'}'},'\\pvert':{base:'base_brackets',lb:'|',rb:'|'},'\\pVert':{base:'base_brackets',lb:'&#x2225;',rb:'&#x2225;'},'\\pangle':{base:'base_brackets',lb:'&#x27E8;',rb:'&#x27E9;'},'\\pceil':{base:'base_brackets',lb:'&#x2308;',rb:'&#x2309;'},'\\pfloor':{base:'base_brackets',lb:'&#x230A;',rb:'&#x230B;'},'\\pgroup':{base:'base_brackets',lb:'&#x27EE;',rb:'&#x27EF;'},'\\pmoustache':{base:'base_brackets',lb:'&#x23B0;',rb:'&#x23B1;'},'base_brackets_single':{noautofrac:1},'(':{base:'base_brackets_single',text:'('},')':{base:'base_brackets_single',text:')'},'{':{base:'base_brackets_single',text:'{'},'}':{base:'base_brackets_single',text:'}'},'\\lbrace':{base:'base_brackets_single',text:'{'},'\\rbrace':{base:'base_brackets_single',text:'}'},'\\lvert':{base:'base_brackets_single',text:'|'},'\\rvert':{base:'base_brackets_single',text:'|'},'\\lVert':{base:'base_brackets_single',text:'&#x2225;'},'\\rVert':{base:'base_brackets_single',text:'&#x2225;'},'\\|':{base:'base_brackets_single',text:'&#x2225;'},'\\langle':{base:'base_brackets_single',text:'&#x27E8;'},'\\rangle':{base:'base_brackets_single',text:'&#x27E9;'},'\\lceil':{base:'base_brackets_single',text:'&#x2308;'},'\\rceil':{base:'base_brackets_single',text:'&#x2309;'},'\\lfloor':{base:'base_brackets_single',text:'&#x230A;'},'\\rfloor':{base:'base_brackets_single',text:'&#x230B;'},'\\lgroup':{base:'base_brackets_single',text:'&#x27EE;'},'\\rgroup':{base:'base_brackets_single',text:'&#x27EF;'},'\\lmoustache':{base:'base_brackets_single',text:'&#x23B0;'},'\\rmoustache':{base:'base_brackets_single',text:'&#x23B1;'},'base_brackets_nonpair':{noautofrac:1},'\\vert':{base:'base_brackets_nonpair',text:'|',scale:1},'\\Vert':{base:'base_brackets_nonpair',text:'&#x2225;',scale:1},'/':{base:'base_brackets_nonpair',text:'/'},'\\backslash':{base:'base_brackets_nonpair',text:'\\'},'\\arrowvert':{base:'base_brackets_nonpair',text:'|'},'\\Arrowvert':{base:'base_brackets_nonpair',text:'&#x2225;'},'\\bracevert':{base:'base_brackets_nonpair',text:'&#x23AA;'},'base_arrows_ext':{},'\\uparrow':{base:'base_arrows_ext',text:'&#x2191;'},'\\Uparrow':{base:'base_arrows_ext',text:'&#x21D1;'},'\\downarrow':{base:'base_arrows_ext',text:'&#x2193;'},'\\Downarrow':{base:'base_arrows_ext',text:'&#x21D3;'},'\\updownarrow':{base:'base_arrows_ext',text:'&#x2195;'},'\\Updownarrow':{base:'base_arrows_ext',text:'&#x21D5;'},'base_arrow':{args:1,sarg:1,text:'',frac:1,arg0_as_upper:1,sarg_as_lower:1,bar:1,evenpos:1,noautofrac:1,bartype:'single',extradepth:1},'\\xleftarrow':{base:'base_arrow',lend:'&#x2190;'},'\\xrightarrow':{base:'base_arrow',rend:'&#x2192;'},'\\xleftrightarrow':{base:'base_arrow',lend:'&#x2190;',rend:'&#x2192;'},'\\xLeftarrow':{base:'base_arrow',lend:'&#x21D0;',bartype:'doubleL'},'\\xRightarrow':{base:'base_arrow',rend:'&#x21D2;',bartype:'doubleL'},'\\xLeftrightarrow':{base:'base_arrow',lend:'&#x21D0;',rend:'&#x21D2;',bartype:'doubleL'},'\\xhookleftarrow':{base:'base_arrow',lend:'&#x2190;',rend:'&#xE150;'},'\\xhookrightarrow':{base:'base_arrow',lend:'&#xE151;',rend:'&#x2192;'},'\\xmapsto':{base:'base_arrow',lend:'&#xE152;',rend:'&#x2192;'},'\\xrightharpoondown':{base:'base_arrow',rend:'&#x21C1;'},'\\xrightharpoonup':{base:'base_arrow',rend:'&#x21C0;'},'\\xleftharpoondown':{base:'base_arrow',lend:'&#x21BD;'},'\\xleftharpoonup':{base:'base_arrow',lend:'&#x21BC;'},'\\xrightleftharpoons':{base:'base_arrow',lend:'&#xE153;',rend:'&#xE155;',bartype:'double'},'\\xleftrightharpoons':{base:'base_arrow',lend:'&#xE154;',rend:'&#xE156;',bartype:'double'},'base_matrix':{align:'c',rowclass:'mee_matrix_row',colclass:'mee_matrix_col',size:-1,padding:0.25,inmatrix:1,noautofrac:1},'\\matrix':{base:'base_matrix',nodepth:1},'\\pmatrix':{base:'base_matrix',lb:'(',rb:')'},'\\bmatrix':{base:'base_matrix',lb:'[',rb:']'},'\\Bmatrix':{base:'base_matrix',lb:'{',rb:'}'},'\\vmatrix':{base:'base_matrix',lb:'|',rb:'|'},'\\Vmatrix':{base:'base_matrix',lb:'&#x2225;',rb:'&#x2225;'},'\\matrix*':{base:'base_matrix',custalign:1},'\\substack':{args:1,arg0_as_array:1,text:'',nodepth:1,inmatrix:1},'\\hline':{apply_to_parent:{hline:1}},'base_align':{nodepth:1,padding:0.25,inmatrix:1},'\\aligned':{base:'base_align',align:'rlrlrlrlrl'},'\\align':{base:'base_align',align:'rlrlrlrlrl'},'\\align*':{base:'base_align',align:'rlrlrlrlrl'},'\\split':{base:'base_align',align:'rl'},'\\split*':{base:'base_align',align:'rl',custalign:1},'\\gather':{base:'base_align',align:'c'},'\\gather*':{base:'base_align',align:'c',custalign:1},'\\multline':{base:'base_align',align:'c'},'\\multline*':{base:'base_align',align:'c',custalign:1},'\\cases':{base:'base_align',align:'lr',lb:'{',size:-1},'\\cases*':{base:'base_align',align:'lr',lb:'{',custalign:1},'\\equation':{base:'base_align',nosplit:1},'\\equation*':{base:'base_align',nosplit:1},'\\array':{base:'base_align',custalign:1,align:'l'},'\\array*':{base:'base_align',custalign:1},'\\tabular':{base:'base_align',custalign:1},'\\eqnarray*':{base:'base_align',align:'rcl*'},'\\overset':{args:2,arg0_as_super:1,arg1_as_main:1,text:'',limits:'above'},'\\underset':{args:2,arg0_as_sub:1,arg1_as_main:1,text:'',limits:'above'},'\\stackrel':{args:2,arg0_as_super:1,arg1_as_main:1,text:'',limits:'above'},'\\displaystyle':{apply_to_thisset:{displaystyle:1}},'\\textstyle':{apply_to_thisset:{textstyle:1}},'\\mathop':{text:'',limits:'above'},'\\nonumber':{text:''},'\\sideset':{text:''},'\\hfill':{text:''},'\\underbrace':{text:''},'\\overbrace':{text:''},'\\underbracket':{text:''},'\\overbracket':{text:''},'\\displaybreak':{text:''},'\\intertext':{text:''},'\\overline':{text:''},'\\kern':{text:''}};MEE.Data.buildDefs();

MEE.Data.blankspace="<span class='mee_blankspace'>&#x200b;</span>";MEE.Data.blankspacesize=function(elem){return 0;var fs=parseInt(elem.css('font-size').replace('px',''));return Math.floor(fs/3.6);}
MEE.Data.emptywidth=0.4;MEE.Data.extbrackets={'{':{top:'&#x23A7;',mid:'&#x23AA;',bottom:'&#x23A9;',angle:'&#x23A8;'},'}':{top:'&#x23AB;',mid:'&#x23AA;',bottom:'&#x23AD;',angle:'&#x23AC;'},'(':{top:'&#x239B;',mid:'&#x239C;',bottom:'&#x239D;'},')':{top:'&#x239E;',mid:'&#x239F;',bottom:'&#x23A0;'},'[':{top:'&#x23A1;',mid:'&#x23A2;',bottom:'&#x23A3;'},']':{top:'&#x23A4;',mid:'&#x23A5;',bottom:'&#x23A6;'},'&#x2308;':{top:'&#x23A1;',mid:'&#x23A2;',bottom:'&#x23A2;'},'&#x2309;':{top:'&#x23A4;',mid:'&#x23A5;',bottom:'&#x23A5;'},'&#x230A;':{top:'&#x23A2;',mid:'&#x23A2;',bottom:'&#x23A3;'},'&#x230B;':{top:'&#x23A5;',mid:'&#x23A5;',bottom:'&#x23A6;'},'&#x27EE;':{top:'&#x23A7;',mid:'&#x23AA;',bottom:'&#x23A9;'},'&#x27EF;':{top:'&#x23AB;',mid:'&#x23AA;',bottom:'&#x23AD;'},'&#x23B0;':{top:'&#x23A7;',mid:'&#x23AA;',bottom:'&#x23AD;'},'&#x23B1;':{top:'&#x23AB;',mid:'&#x23AA;',bottom:'&#x23A9;'},'|':{top:'|',mid:'|',bottom:'|'},'&#x2225;':{top:'&#x2225;',mid:'&#x2225;',bottom:'&#x2225;'},'&#x221A;':{top:'&#xE001;',mid:'&#x23B8;',bottom:'&#x23B7;'},'&#x23D0;':{top:'|',mid:'|',bottom:'|'},'&#x2016;':{top:'&#x2225;',mid:'&#x2225;',bottom:'&#x2225;'},'&#x23AA;':{top:'&#x23AA;',mid:'&#x23AA;',bottom:'&#x23AA;'},'&#x2191;':{top:'&#x2191;',mid:'&#x23D0;',bottom:'&#x23D0;',font:'MathJax_Size1'},'&#x21D1;':{top:'&#x21D1;',mid:'&#x2016;',bottom:'&#x2016;',font:'MathJax_Size1'},'&#x2193;':{top:'&#x23D0;',mid:'&#x23D0;',bottom:'&#x2193;',font:'MathJax_Size1'},'&#x21D3;':{top:'&#x2016;',mid:'&#x2016;',bottom:'&#x21D3;',font:'MathJax_Size1'},'&#x2195;':{top:'&#x2191;',mid:'&#x23D0;',bottom:'&#x2193;',font:'MathJax_Size1'},'&#x21D5;':{top:'&#x21D1;',mid:'&#x2016;',bottom:'&#x21D3;',font:'MathJax_Size1'}};MEE.Data.charsizes={'&#x23A7;':{top:0.86,height:0.88},'&#x23AA;':{top:1.45,height:0.31},'&#x23A9;':{top:1.80,height:0.88},'&#x23A8;':{top:0.58,height:1.80},'&#x23AB;':{top:0.86,height:0.88},'&#x23AD;':{top:1.80,height:0.88},'&#x23AC;':{top:0.58,height:1.80},'&#x239B;':{top:0.60,height:1.80},'&#x239C;':{top:1.15,height:0.60},'&#x239D;':{top:0.60,height:1.80},'&#x239E;':{top:0.60,height:1.80},'&#x239F;':{top:1.15,height:0.60},'&#x23A0;':{top:0.60,height:1.80},'&#x23A1;':{top:0.59,height:1.79},'&#x23A2;':{top:1.15,height:0.59},'&#x23A3;':{top:0.62,height:1.78},'&#x23A4;':{top:0.59,height:1.79},'&#x23A5;':{top:1.15,height:0.59},'&#x23A6;':{top:0.62,height:1.78},'|':{top:1,height:0.9},'&#x2225;':{top:1.15,height:0.62},'&#x2191;':{top:0.25,height:0.6},'&#x23D0;':{top:0.25,height:0.6},'&#x2193;':{top:0.25,height:0.6},'&#x21D1;':{top:0.25,height:0.6},'&#x2016;':{top:0.25,height:0.6},'&#x21D3;':{top:0.25,height:0.6},'&#xE001;':{top:1,height:0.6},'&#x23B8;':{top:1.15,height:0.62},'&#x23B7;':{top:0.83,height:1.815}};MEE.Data.replace={'-':'&#x2212;','*':'&#x2217;',"'":'&#x02B9;','<':'&lt;','>':'&gt;','&idotsint;':'&#x222B;<span class="mee_idotsint_dots">&#x22EF;</span><span class="mee_idotsint_rint">&#x222B;</span>','&#x222D;':'<span class="mee_iiint">&#x222B;&#x222B;&#x222B;</span>'};MEE.Data.sizemodifiers=[{left:'\\left',right:'\\right',size:-1},{left:'\\bigl',right:'\\bigr',size:1},{left:'\\Bigl',right:'\\Bigr',size:2},{left:'\\biggl',right:'\\biggr',size:3},{left:'\\Biggl',right:'\\Biggr',size:4}];MEE.Data.sizemodifiers_single={'\\big':1,'\\Big':2,'\\bigg':3,'\\Bigg':4};MEE.Data.pairs=[{left:'(',right:')',pair:'pbrackets'},{left:'.',right:'.',pair:'pdotbrackets',onlysized:1},{left:'[',right:']',pair:'psqbrackets'},{left:'\\{',right:'\\}',pair:'pbrace'},{left:'\\lbrace',right:'\\rbrace',pair:'pbrace'},{left:'\\lvert',right:'\\rvert',pair:'pvert'},{left:'\\lVert',right:'\\rVert',pair:'pVert'},{left:'\\langle',right:'\\rangle',pair:'pangle'},{left:'\\lceil',right:'\\rceil',pair:'pceil'},{left:'\\lfloor',right:'\\rfloor',pair:'pfloor'},{left:'\\lgroup',right:'\\rgroup',pair:'pgroup'},{left:'\\lmoustache',right:'\\rmoustache',pair:'pmoustache'}];MEE.Data.nonpairs=['\\vert','\\Vert','/','\\|','\\backslash','\\arrowvert','\\Arrowvert','\\bracevert','\\uparrow','\\Uparrow','\\downarrow','\\Downarrow','\\updownarrow','\\Updownarrow','\\{','\\}','\\lbrace','\\rbrace','\\lvert','\\rvert','\\lVert','\\rVert','\\langle','\\rangle','\\lceil','\\rceil','\\lfloor','\\rfloor','\\lgroup','\\rgroup','\\lmoustache','\\rmoustache',];MEE.Data.largechars={'&#x2211;':{top:0.15,bottom:0.2,width:1.5,offset:-0.53},'&#x222B;':{top:0.53,bottom:0.6,width:0.9,offset:-0.53},'&#x2210;':{top:0.15,bottom:0.2,width:1.25,offset:-0.53},'&#x22C1;':{top:0.15,bottom:0.2,width:1.05,offset:-0.53},'&#x22C0;':{top:0.15,bottom:0.2,width:1.05,offset:-0.53},'&#x2A04;':{top:0.15,bottom:0.2,width:1.05,offset:-0.53},'&#x22C2;':{top:0.15,bottom:0.2,width:1.05,offset:-0.53},'&#x22C3;':{top:0.15,bottom:0.2,width:1.05,offset:-0.53},'&#x222C;':{top:0.53,bottom:0.6,width:1.5,offset:-0.53},'&#x222D;':{top:0.53,bottom:0.6,width:1.9,offset:-0.53},'&idotsint;':{top:0.53,bottom:0.6,width:2.05,offset:-0.53},'&#x220F;':{top:0.15,bottom:0.2,width:1.25,offset:-0.53},'&#x2A02;':{top:0.15,bottom:0.2,width:1.45,offset:-0.53},'&#x2A01;':{top:0.15,bottom:0.2,width:1.45,offset:-0.53},'&#x2A00;':{top:0.15,bottom:0.2,width:1.45,offset:-0.53},'&#x222E;':{top:0.53,bottom:0.6,width:0.9,offset:-0.53},'&#x2A06;':{top:0.15,bottom:0.2,width:1.05,offset:-0.53},'&#x02DC;':{width:1.01}};MEE.Data.largechars_size1={'&#x2211;':{width:1},'&#x222B;':{width:0.6},'&#x2210;':{width:0.93},'&#x22C1;':{width:0.8},'&#x22C0;':{width:0.8},'&#x2A04;':{width:0.8},'&#x22C2;':{width:0.8},'&#x22C3;':{width:0.8},'&#x222C;':{width:1},'&#x222D;':{width:1.3},'&idotsint;':{width:1.55},'&#x220F;':{width:0.93},'&#x2A02;':{width:1.07},'&#x2A01;':{width:1.07},'&#x2A00;':{width:1.07},'&#x222E;':{width:0.6},'&#x2A06;':{width:0.8},'&#x02DC;':{width:0.57}};MEE.Data.largechars_size3={'&#x02DC;':{width:1.45}};MEE.Data.largechars_size4={'&#x02DC;':{width:1.90}};MEE.Data.fontsizes={'1':'100%','2':'100%','3':'75%','4':'75%','5':'100%','6':'100%','7':'100%'};MEE.Data.bracketwidths=[{brackets:['(',')'],'0':0.39,'1':0.46,'2':0.595,'3':0.735,'4':0.79,'s':0.875,'haslarge':1,'canscale':1},{brackets:['[',']'],'0':0.28,'1':0.415,'2':0.47,'3':0.53,'4':0.585,'s':0.665,'haslarge':1,'canscale':1},{brackets:['{','}'],'0':0.5,'1':0.585,'2':0.665,'3':0.75,'4':0.805,'s':0.89,'haslarge':1,'canscale':1},{brackets:['&#x2308;','&#x2309;','&#x230A;','&#x230B;'],'0':0.445,'1':0.47,'2':0.53,'3':0.583,'4':0.64,'s':0.665,'haslarge':1,'canscale':1},{brackets:['|'],'0':0.28,'1':0.375,'2':0.375,'3':0.375,'4':0.375,'s':0.375,'haslarge':0,'canscale':1},{brackets:['&#x2225;'],'0':0.5,'1':0.555,'2':0.58,'3':0.58,'4':0.58,'s':0.58,'haslarge':0,'canscale':1},{brackets:['&#x27EE;','&#x27EF;'],'0':0.41,'1':0.89,'2':0.89,'3':0.89,'4':0.89,'s':0.89,'haslarge':0,'canscale':1},{brackets:['&#x23B0;','&#x23B1;'],'0':0.41,'1':0.89,'2':0.89,'3':0.89,'4':0.89,'s':0.89,'haslarge':0,'canscale':1},{brackets:['&#x27E8;','&#x27E9;'],'0':0.39,'1':0.47,'2':0.61,'3':0.75,'4':0.805,'s':0,'haslarge':1,'canscale':0},{brackets:['&#x221A;'],'0':0.835,'1':1,'2':1,'3':1,'4':1,'s':1.05,'haslarge':1,'canscale':1},{brackets:['/','\\'],'0':0.5,'1':0.58,'2':0.81,'3':1.045,'4':1.28,'s':0,'haslarge':1,'canscale':0},{brackets:['&#x2191;','&#x2193;','&#x2195;'],'0':0.5,'1':0.665,'2':0.665,'3':0.665,'4':0.665,'s':0.53,'haslarge':0,'canscale':1},{brackets:['&#x21D1;','&#x21D3;','&#x21D5;'],'0':0.61,'1':0.78,'2':0.78,'3':0.78,'4':0.78,'s':0.77,'haslarge':0,'canscale':1}];MEE.Data.bracketheights={'0':0.9,'1':1.2,'2':1.8,'3':2.4,'4':3};MEE.Data.arrowendwidths={'&#x2190;':0.4,'&#x2192;':0.4,'&#x21D0;':0.4,'&#x21D2;':0.4,'&#x21BD;':0.4,'&#x21BC;':0.4,'&#x21C1;':0.4,'&#x21C0;':0.4,'&#xE150;':0.4,'&#xE151;':0.4,'&#xE152;':0.4,'&#xE153;':0.4,'&#xE154;':0.4,'&#xE155;':0.4,'&#xE156;':0.4};MEE.Data.bars={'single':{'chars':{1:'&#xE100;',0.5:'&#xE101;',0.25:'&#xE102;',0.1:'&#xE103;',0.05:'&#xE104;'}},'double':{'chars':{1:'&#xE110;',0.5:'&#xE111;',0.25:'&#xE112;',0.1:'&#xE113;',0.05:'&#xE114;'}},'doubleL':{'chars':{1:'&#xE120;',0.05:'&#xE124;'}},'sqrts':{'chars':{1:'&#xE160;',0.5:'&#xE161;',0.25:'&#xE162;',0.1:'&#xE163;',0.05:'&#xE164;'}},'sqrt':{'chars':{1:'&#xE170;',0.5:'&#xE171;',0.25:'&#xE172;',0.1:'&#xE173;',0.05:'&#xE174;'}}};MEE.Data.bonds={'-':'&#x2212;','=':'=','#':'&#x2261;','~':'&#xE905;','~-':'&#xE906;','~=':'&#xE903;','~--':'&#xE903;','&#xE906;-':'&#xE903;','-~-':'&#xE904;','...':'&#xE901;','....':'&#xE902;','->':'&#x2190;','<-':'&#x2192;'}
MEE.Data.buildNamedOps();MEE.Data.buildBracketSizes();

$.Class.extend("MEE.Elem",{elems:Array()},{init:function(token,eldata){this._name='MEE.Elem';this.args=new Array();this.argmap=new Array();this.latex=token.latex;this.type=token.type;this.eldata=jQuery.extend({},eldata);this.size=token.size;this.sizer=0;if(token.closing){this.eldata.rb=token.closing;}
if(token.sizer)
this.sizer=token.sizer;if(token.type=="extsingle"){this.main=new MEE.ElemSetBasic("",{},this);this.eldata.lb=token.latex;if(eldata.text)
this.eldata.lb=eldata.text;}else{this.main=new MEE.ElemSetBasic(token.latex,eldata,this);}},SetScript:function(token,typeor,createhtml){var type=token.type;if(typeor)
type=typeor;if(type=="superscript"){this.superscript=new MEE.ElemSetNormal(token.latex,this);if(createhtml)
this.createSuperscriptHTML();return this.superscript;}else if(type=="subscript"){this.subscript=new MEE.ElemSetNormal(token.latex,this);if(createhtml)
this.createSubscriptHTML();return this.subscript;}},SetMain:function(token){this.main=new MEE.ElemSetNormal(token.latex,this);this.argmap.push(this.main);},AddArg:function(token){var arg=new MEE.ElemSetNormal(token.latex,this);this.args.push(arg);this.argmap.push(arg);},SetSArg:function(token){this.sarg=new MEE.ElemSetNormal(token.latex,this);},AddUpperLower:function(upper,lower){if(this.main._name!="MEE.ElemSetArray"){this.main=new MEE.ElemSetArray(this.eldata,null,this);}
this.main.UpperLower(upper,lower);this.argmap.push(this.main.row0.col0);this.argmap.push(this.main.row1.col0);},AddArray:function(token,alignment){this.main=new MEE.ElemSetArray(this.eldata,alignment,this);this.main.AddArray(token);},toHTML:function(depth){if(this.eldata.displaystyle)
depth=1;if(this.eldata.textstyle)
depth=2;this.depth=depth;if(this.eldata.size){this.size=this.eldata.size;this.sizer=this.eldata.size;}
this.elemid=MEE.Elem.elems.length;MEE.Elem.elems[this.elemid]=this;if(this.eldata.elemclass)
this.html_elem=$('<span class="mee_elem '+this.eldata.elemclass+'" elem="'+this.elemid+'"></span>');else
this.html_elem=$('<span class="mee_elem" elem="'+this.elemid+'"></span>');if(this.eldata.lb)
this.createLbHTML();if(this.latex=="sqrt"){this.html_sqrt=$('<span class="mee_sqrt_bar" style="position:absolute"></span>');this.html_sqrt.html(MEE.Data.blankspace);this.html_elem.append(this.html_sqrt);this.html_elem.css('position','relative');}
this.html_main=this.main.toHTML(depth);this.html_main.addClass('mee_main');if(this.eldata.mainclass)
this.html_main.addClass(this.eldata.mainclass);this.html_elem.append(this.html_main);if(this.sarg){this.html_sarg=this.sarg.toHTML(depth);this.html_sarg.addClass('mee_sarg');if(this.eldata['sargclass'])
this.html_sarg.addClass(this.eldata['sargclass']);this.html_elem.append(this.html_sarg);}
if(this.args.length>0&&!this.eldata.arg01_as_upperlower&&!this.eldata.arg0_as_main){for(var i=0;i<this.args.length;i++){var arg=this.args[i].toHTML(depth);arg.addClass('mee_arg'+i);arg.addClass('mee_arg');if(this.eldata['arg'+i+'class'])
arg.addClass(this.eldata['arg'+i+'class']);this.html_elem.append(arg);this['html_arg'+i]=arg;}}
if(this.eldata.rb)
this.createRbHTML();if(this.subscript)
this.createSubscriptHTML();if(this.superscript)
this.createSuperscriptHTML();return this.html_elem;},createLbHTML:function(){if(!this.eldata.lb)
return;this.html_lb=$('<span style="position:relative"></span>');this.html_lb.html(MEE.Data.blankspace);var font='';if(!('scale'in this.eldata&&this.eldata.scale==1)&&this.size>0&&this.size<5){font=';font-family:'+"MathJax_Size"+this.size;}
this.html_lb_inner=$('<span style="position:absolute '+font+'"></span>');this.html_lb_inner.html(this.eldata.lb);this.html_lb.append(this.html_lb_inner);this.html_elem.prepend(this.html_lb);},createRbHTML:function(){if(!this.eldata.rb)
return;if(this.eldata.rb==".")
this.eldata.rb="";this.html_rb=$('<span style="position:relative"></span>');this.html_rb.html(MEE.Data.blankspace);this.html_rb_inner=$('<span style="position:absolute"></span>');this.html_rb_inner.html(this.eldata.rb);this.html_rb.append(this.html_rb_inner);if(this.html_superscript){this.html_superscript.before(this.html_rb);}else if(this.html_subscript){this.html_subscript.before(this.html_rb);}else{this.html_elem.append(this.html_rb);}
if(!('scale'in this.eldata&&this.eldata.scale==1)&&this.sizer>0&&this.sizer<5){var font="MathJax_Size"+this.sizer;$(this.html_rb_inner).css('font-family',font);}},createSubscriptHTML:function(){var ssdepth=this.depth+1;if(ssdepth<3)ssdepth=3;this.html_subscript=this.subscript.toHTML(ssdepth);this.html_subscript.addClass('mee_subscript');this.html_subscript.css('position','absoluet');if(this.eldata.subscriptclass)
this.html_subscript.addClass(this.eldata.subscriptclass);this.subscript.subscript=1;this.html_elem.append(this.html_subscript);},createSuperscriptHTML:function(){var ssdepth=this.depth+1;if(ssdepth<4)ssdepth=4;this.html_superscript=this.superscript.toHTML(ssdepth);this.html_superscript.addClass('mee_superscript');this.html_superscript.css('position','absoluet');if(this.eldata.superscriptclass)
this.html_superscript.addClass(this.eldata.superscriptclass);this.superscript.superscript=1;this.html_elem.append(this.html_superscript);},sortAlign:function(){this.align=new MEE.Align();this.main.sortAlign();if(this.subscript)
this.subscript.sortAlign();if(this.superscript)
this.superscript.sortAlign();if(this.sarg)
this.sarg.sortAlign();if(this.args.length>0){for(var i=0;i<this.args.length;i++){this.args[i].sortAlign();}}
this.align.width=this.main.align.width;this.align.height=this.main.align.height-(this.main.align.top+this.main.align.bottom);this.align.top=this.main.align.top;this.align.bottom=this.main.align.bottom;if(this.subscript||this.superscript)
this.alignSS();if('size'in this.eldata){this.size=this.eldata.size;this.sizer=this.eldata.size;}
if(this.html_lb){var lbwidth=this.alignBracket('lb',this.size,this.eldata.lb,this.html_lb,this.html_lb_inner)
this.align.width+=lbwidth;}
if(this.html_rb){var rbwidth=this.alignBracket('rb',this.sizer,this.eldata.rb,this.html_rb,this.html_rb_inner);this.align.width+=rbwidth;}
if(this.html_sqrt){var offset=0;if(this.bsize==-1){var width=this.main.align.width;width=$(width).toEm({'scope':this.html_elem});var sqrtbartxt=MEE.Tools.HTML.BuildBarText(width,"sqrts");this.html_sqrt.html(sqrtbartxt);var top=this.html_lb.children().css('top');this.html_sqrt.css('top',top);this.html_sqrt.css('font-family','MathJax_Size4');this.html_lb.append(this.html_sqrt);}else{var width=this.main.align.width;width=$(width).toEm({'scope':this.html_elem});var sqrtbartxt=MEE.Tools.HTML.BuildBarText(width,"sqrt");this.html_sqrt.html(sqrtbartxt);var children=this.html_lb.children();var top=$(children[1]).css('top');this.html_sqrt.css('left',lbwidth+'px');this.html_sqrt.css('top',top);this.html_lb.append(this.html_sqrt);if(this.bsize>0)
this.html_sqrt.css('font-family','MathJax_Size'+this.bsize);}}
var sswidth=0;if(this.superscript){var suptop=this.replacePX(this.html_superscript.css('top'))+this.superscript.align.top;if(suptop)
this.align.top=Math.max(this.align.top,suptop);sswidth=Math.max(sswidth,this.superscript.align.width);}
if(this.subscript){var subbottom=this.replacePX(this.html_subscript.css('bottom'))+this.subscript.align.bottom;if(subbottom)
this.align.bottom=Math.max(this.align.bottom,subbottom);sswidth=Math.max(sswidth,this.subscript.align.width);}
if(!this.html_sqrt)
this.align.width+=sswidth;if(this.eldata.noheight){this.align.top=0;this.align.bottom=0;}
this.align.height+=this.align.top;this.align.height+=this.align.bottom;var padleft=$(this.html_elem).css('padding-left');if(padleft){padleft=parseInt(padleft.replace('px',''));if(padleft>0)
this.align.width+=padleft;}
if(this.args.length>0){for(var i=0;i<this.args.length;i++){this.align.width+=this.args[i].align.width;}}
var marginl=parseInt($(this.html_elem).css('margin-left'));if(marginl>0)this.align.width+=marginl;var marginr=parseInt($(this.html_elem).css('margin-right'));if(marginr>0)this.align.width+=marginr;return this.align;},alignBracket:function(side,size,bracketchar,elem,inner){if(bracketchar=="")
return;var bdata=MEE.Data.bsizes[bracketchar];if(!bdata)
bdata=MEE.Data.bsizes['('];var mainho=this.main.align.height-(this.main.align.top+this.main.align.bottom)+(Math.max(this.main.align.top,this.main.align.bottom)*2);var isscaled=false;var bwidth=0;if(size==undefined)
size=0;if(size==0){}else if(size!=-1&&!bdata.haslarge){mainhem=MEE.Data.bracketheights[size];mainho=$(mainhem).toPx({'scope':this.html_elem});bwidth=this.generateLargeBracket(bracketchar,mainho,this.html_elem,elem);isscaled=true;}else if(size==-1){mainhem=$(mainho).toEm({'scope':this.html_elem});var heights={};if(bracketchar=='&#x221A;'){heights.size4=3;heights.size3=2.4;heights.size2=1.8;heights.size1=1.2;heights.size0=0.9;}else{heights.size4=3.3;heights.size3=2.7;heights.size2=2.1;heights.size1=1.5;heights.size0=0;}
if(!bdata.haslarge||(mainhem>heights.size4&&bdata.canscale)){bwidth=this.generateLargeBracket(bracketchar,mainho,this.html_elem,elem);isscaled=true;}else if(mainhem>heights.size3){inner=this.removeLargeBaracket(side,bracketchar,inner,this.html_elem,elem);$(inner).css('font-family','MathJax_Size4');size=4;}else if(mainhem>heights.size2){inner=this.removeLargeBaracket(side,bracketchar,inner,this.html_elem,elem);$(inner).css('font-family','MathJax_Size3');size=3;}else if(mainhem>heights.size1){inner=this.removeLargeBaracket(side,bracketchar,inner,this.html_elem,elem);$(inner).css('font-family','MathJax_Size2');size=2;}
else{inner=this.removeLargeBaracket(side,bracketchar,inner,this.html_elem,elem);$(inner).css('font-family','');size=0;}}
if(bwidth==0){bwidth=bdata['size'+size].width;bwidth=$(bwidth).toPx({'scope':this.html_elem});}
if(isscaled){if(mainho>this.main.align.height){this.align.top=Math.max(this.align.top,this.align.bottom);var largeby=Math.floor((mainho-this.main.align.height)/2);if(largeby>this.align.top)
this.align.top=largeby;this.align.bottom=this.align.top;}
this.align.width+=bwidth;}else{var bheight=bdata['size'+size].height;bheight=$(bheight).toPx({'scope':this.html_elem});$(inner).css('left','0px');var bextra=0;var boffset=0;if(size==4){bextra=0.9;boffset=0.94;}else if(size==3){bextra=0.63;boffset=0.62;}else if(size==2){bextra=0.3;boffset=0.53;}else if(size==1){bextra=0.1;boffset=-0.07;}
$(inner).css('top',-boffset+'em');$(elem).css('padding-right',bwidth-MEE.Data.blankspacesize(elem)+'px');bextra=$(bextra).toPx({'scope':this.html_elem});if(bextra>0){this.align.top=Math.max(this.align.top,bextra);this.align.bottom=Math.max(this.align.bottom,bextra);}}
this.bsize=size;return bwidth;},alignSS:function(){var mainwidth=this.main.align.width;var sswidth=0;if(this.subscript)
sswidth=Math.max(sswidth,this.subscript.align.width);if(this.superscript)
sswidth=Math.max(sswidth,this.superscript.align.width);if(this.depth>1)
this.eldata.limits="";if('foreclimits'in this.eldata)
this.eldata.limits=this.eldata.foreclimits;if(this.eldata.limits=="above"){this.html_elem.css('position','relative');{if(mainwidth<sswidth){var mainpadding1=Math.floor((sswidth-mainwidth)/2);var existingleft=$(this.html_main).css('padding-left').replace('px','');if(existingleft>0)
mainpadding1+=parseInt(existingleft);var mainpadding2=Math.ceil((sswidth-mainwidth)/2);var existingright=$(this.html_main).css('padding-right').replace('px','');if(existingright>0)
mainpadding2+=parseInt(existingright);$(this.html_main).css('padding-left',mainpadding1+'px');$(this.html_main).css('padding-right',mainpadding2+'px');if(this.main._name=="MEE.ElemSetBasic"){$(this.main.html_inner).css('left',mainpadding1+'px');}
mainwidth=sswidth;}
if(this.superscript)
$(this.html_superscript).css('left',Math.floor((mainwidth-this.superscript.align.width)/2)+'px');if(this.subscript)
$(this.html_subscript).css('left',Math.floor((mainwidth-this.subscript.align.width)/2)+'px');}
if(this.subscript){var suph=this.subscript.align.height-this.subscript.align.top;;var elemh=this.main.align.height;elemh=Math.floor(elemh/2)+this.main.align.bottom-this.subscript.align.top;if($.browser.msie)
elemh+=suph/2;var pad=0.3;if(this.eldata.limits_l)
pad=0.1;if(this.eldata.limits_lx)
pad=0.07;pad=$(pad).toPx({'scope':this.html_elem});pad=-pad+elemh;$(this.html_subscript).css('bottom',-pad+'px');}
if(this.superscript){var suph=this.superscript.align.height-this.superscript.align.top;;var elemh=this.main.align.height;elemh=Math.floor(elemh/2)+this.main.align.top-this.superscript.align.top;if($.browser.msie)
elemh+=suph;var pad=0.4;if(this.eldata.limits_h)
pad=0.2;if(this.eldata.limits_hx)
pad=0.05;pad=$(pad).toPx({'scope':this.html_elem});pad=pad+elemh;$(this.html_superscript).css('top',-pad+'px');}
this.align.width=mainwidth;if(this.subscript)
this.subscript.align.width=0;if(this.superscript)
this.superscript.align.width=0;}else{if(!this.html_sqrt)
$(this.html_elem).css('padding-right',sswidth+'px');var elemh=this.main.align.height-(this.main.align.top+this.main.align.bottom);if(this.subscript&&this.superscript){var subh=this.subscript.align.height-this.subscript.align.bottom;var suph=this.superscript.align.height-this.superscript.align.top;var pad=0.1;pad=$(pad).toPx({'scope':this.html_elem});var subup=subh-Math.floor(elemh/2)+this.main.align.bottom-this.subscript.align.top;subup-=pad;var supup=suph-Math.floor(elemh/2)+this.main.align.top-this.superscript.align.top;supup-=pad;var overlap=(subh+suph)-(elemh+subup+supup);var maxoverlap=0.2;maxoverlap=$(maxoverlap).toPx({'scope':this.html_elem});if(overlap>maxoverlap){overlap-=maxoverlap;subup+=Math.floor(overlap/2);supup+=Math.ceil(overlap/2);}
$(this.html_elem).attr('overlap',overlap);$(this.html_subscript).css('bottom',-subup+'px');$(this.html_superscript).css('top',-supup+'px');}else if(this.subscript){var subh=this.subscript.align.height-this.subscript.align.bottom;var subup=subh-Math.floor(elemh/2)+this.main.align.bottom-this.subscript.align.top;var pad=0.2;pad=$(pad).toPx({'scope':this.html_elem});subup-=pad;$(this.html_subscript).css('bottom',-subup+'px');}else if(this.superscript){var suph=this.superscript.align.height-this.superscript.align.top;var supup=suph-Math.floor(elemh/2)+this.main.align.top-this.superscript.align.top;var pad=0.05;pad=$(pad).toPx({'scope':this.html_elem});supup-=pad;$(this.html_superscript).css('top',-supup+'px');}
if(this.eldata.ssoffsets){if(this.depth==1){this.eldata.suboffset=this.eldata.ssoffsets[1].sub;this.eldata.supoffset=this.eldata.ssoffsets[1].sup;}else{this.eldata.suboffset=this.eldata.ssoffsets[2].sub;this.eldata.supoffset=this.eldata.ssoffsets[2].sup;}
if(!this.eldata.supoffset)
this.eldata.supoffset=0;if(!this.eldata.suboffset)
this.eldata.suboffset=0;this.eldata.suboffset=$(this.eldata.suboffset).toPx({'scope':this.html_elem});this.eldata.supoffset=$(this.eldata.supoffset).toPx({'scope':this.html_elem});var mainw=this.main.align.width;if(this.html_superscript)
$(this.html_superscript).css('left',mainw+this.eldata.supoffset+'px');if(this.html_subscript)
$(this.html_subscript).css('left',mainw+this.eldata.suboffset+'px');if(this.subscript){this.subscript.align.width+=this.eldata.suboffset;if(this.subscript.align.width<0)
this.subscript.align.width=0;}
if(this.superscript){this.superscript.align.width+=this.eldata.supoffset;if(this.superscript.align.width<0)
this.superscript.align.width=0;}}}},removeLargeBaracket:function(side,bracket,oldinner,scopeelem,bracketelem){if(bracketelem.children.length>2){bracketelem.attr('style','');bracketelem.css('position','relative');bracketelem.html(MEE.Data.blankspace);var newbracket=$('<span style="position:absolute">'+bracket+'</span>');bracketelem.append(newbracket);this['html_'+side+'_inner']=newbracket;return newbracket;}
return oldinner;},generateLargeBracket:function(bracket,mainh,scopeelem,bracketelem){JQbracketelem=$(bracketelem);var bi=MEE.Data.getBracket(bracket);JQbracketelem.css('position','relative');JQbracketelem.html("");var bh=MEE.Data.getBaseSize(scopeelem);var pad=Math.floor((mainh-bh)/2);if($.browser.msie&&$.browser.version>=8){pad+=12;}
JQbracketelem.css('top',-pad+'px');var topcdata=MEE.Data.getCharSize(bi.top,scopeelem);var top=$('<span class="mee_bracket_part" style="top:'+-topcdata.top+'px'+'">'+bi.top+'</span>');JQbracketelem.append(top);var bottom=$('<span class="mee_bracket_part">'+bi.bottom+'</span>');var bottomcdata=MEE.Data.getCharSize(bi.bottom,scopeelem);bottom.css('top',mainh-(bottomcdata.top+bottomcdata.height)+'px');JQbracketelem.append(bottom);var midcdata=MEE.Data.getCharSize(bi.mid,scopeelem);if(bi.angle){var middletop=topcdata.height;var middlebottom=mainh-bottomcdata.height;var anglecdata=MEE.Data.getCharSize(bi.angle,scopeelem);var angle=$('<span class="mee_bracket_part" style="top:'+(Math.floor((middletop+middlebottom-anglecdata.height)/2)-anglecdata.top)+'px" ></span>');angle.html(bi.angle);JQbracketelem.append(angle);var gapsize=Math.floor((mainh-(topcdata.height+bottomcdata.height+anglecdata.height))/2);if(gapsize>0){if(gapsize<midcdata.height){var mid=$('<span class="mee_bracket_part" style="top:'+(-midcdata.top+topcdata.height-Math.floor((midcdata.height-gapsize)/2))+'px" ></span>');mid.html(bi.mid);JQbracketelem.append(mid);var mid=$('<span class="mee_bracket_part" style="top:'+(-midcdata.top+mainh-bottomcdata.height-Math.floor((midcdata.height+gapsize)/2))+'px" ></span>');mid.html(bi.mid);JQbracketelem.append(mid);}else{var last=-midcdata.top+topcdata.height+gapsize-midcdata.height;var cur=-midcdata.top+topcdata.height;while(cur<last&&midcdata.height>0){var mid=$('<span class="mee_bracket_part" style="top:'+cur+'px'+'"></span>');mid.html(bi.mid);JQbracketelem.append(mid);cur+=midcdata.height;}
var mid=$('<span class="mee_bracket_part"style="top:'+last+'px'+'"></span>');mid.html(bi.mid);JQbracketelem.append(mid);var last=-midcdata.top+mainh-bottomcdata.height-midcdata.height;var cur=-midcdata.top+mainh-bottomcdata.height-gapsize;while(cur<last&&midcdata.height>0){var mid=$('<span class="mee_bracket_part" style="top:'+cur+'px'+'"></span>');mid.html(bi.mid);JQbracketelem.append(mid);cur+=midcdata.height;}
var mid=$('<span class="mee_bracket_part"style="top:'+last+'px'+'"></span>');mid.html(bi.mid);JQbracketelem.append(mid);}}}else{var gapsize=mainh-(topcdata.height+bottomcdata.height);if(gapsize>0){if(gapsize<midcdata.height){var mid=$('<span class="mee_bracket_part"style="top:'+(-midcdata.top+topcdata.height-Math.floor((midcdata.height-gapsize)/2))+'px'+'"></span>');mid.html(bi.mid);JQbracketelem.append(mid);}else{var last=-midcdata.top+mainh-bottomcdata.height-midcdata.height;var cur=-midcdata.top+topcdata.height;while(cur<last&&midcdata.height>0){var mid=$('<span class="mee_bracket_part"style="top:'+cur+'px'+'"></span>');;mid.html(bi.mid);JQbracketelem.append(mid);cur+=midcdata.height;}
var mid=$('<span class="mee_bracket_part" style="top:'+last+'px"></span>');mid.html(bi.mid);JQbracketelem.append(mid);}}}
if(bi.font)
JQbracketelem.children().css('font-family',bi.font);var spacer=$('<span></span>');spacer.html(MEE.Data.blankspace);JQbracketelem.append(spacer);var width=$(top).outerWidth();if(width==0)
width='12';$(spacer).css('padding-right',width+'px');return width;},getSizeModPair:function(side,size){for(var i=0;i<MEE.Data.sizemodifiers.length;i++){var sizemod=MEE.Data.sizemodifiers[i];if(sizemod.size==size)
return sizemod[side];}
return"";},getSizeMod:function(size){for(name in MEE.Data.sizemodifiers_single){var sizemod=MEE.Data.sizemodifiers_single[name];if(sizemod==size)
return name;}
return"";},lookupBracket:function(text,side){if(text=="&#x2225;"){if(side=="left")return"\\lVert";if(side=="right")return"\\rVert";}
for(var command in MEE.Data.commands){if(MEE.Data.commands[command].text==text)
return command;}
return text;},toLatex:function(){var latex=new MEE.Latex();if(this._name=="MEE.ElemInput")
return latex;if(this.latex!=''){for(var i=0;i<MEE.Data.pairs.length;i++){if(this.latex==MEE.Data.pairs[i].pair)
this.type="extpair";}}
if(this.size&&this.type.substr(0,3)=="ext"){if(this.type!="extsingle"){var size=this.getSizeModPair('left',this.size);}else{var size=this.getSizeMod(this.size);}
latex.AddText(size);}
if(this.type=="extpair"&&this.eldata.lb){latex.AddText(this.lookupBracket(this.eldata.lb,'left')+" ");}
if(this.latex=="substack"){latex.AddText("\\substack{");latex.AddElem(this.main.toLatex());latex.AddText("}");}else if(this.eldata.all_as_arg01){if(this.argmap[0])
latex.AddElem(this.argmap[0].toLatex());latex.AddText(" \\"+this.latex+" ");if(this.argmap[1])
latex.AddElem(this.argmap[1].toLatex());}else if(this.eldata.rest_as_arg0){latex.AddText("\\"+this.latex+" ");if(this.argmap[0])
latex.AddElem(this.argmap[0].toLatex());}else if(this.eldata.arg0_as_super){latex.AddText("\\"+this.latex);if(this.superscript){latex.AddMod("{");latex.AddElem(this.superscript.toLatex());latex.AddMod("}");}
if(this.main){latex.AddMod("{");latex.AddElem(this.main.toLatex());latex.AddMod("}");}}else if(this.eldata.arg0_as_sub){latex.AddText("\\"+this.latex);if(this.subscript){latex.AddMod("{");latex.AddElem(this.subscript.toLatex());latex.AddMod("}");}
if(this.main){latex.AddMod("{");latex.AddElem(this.main.toLatex());latex.AddMod("}");}}else if(this.type=="arg"){latex.AddMod("{");latex.AddElem(this.argmap[0].toLatex());latex.AddMod("}");}else{if(this.type=="begin"){latex.AddText("\\begin{"+this.latex+"}");latex.AddElem(this.main.toLatex());latex.AddText("\\end{"+this.latex+"}");}else if(this.type=="command"){if(this.latex!="")
latex.AddText("\\"+this.latex);if(this.eldata.foreclimits=="above")
latex.AddText("\\limits");if('foreclimits'in this.eldata&&this.eldata.foreclimits=="")
latex.AddText("\\nolimits");}else if(this.type==""&&!this.eldata.blank){latex.AddText(this.latex);}else if(this.type=="extsingle"){latex.AddText("\\"+this.latex);}
if(this.eldata.sarg){var l=null;if(this.eldata.sarg_as_sup){if(this.superscript)
l=this.superscript.toLatex();}else{if(this.sarg)
l=this.sarg.toLatex();}
if(l&&l.latex!=""){latex.AddMod("[");latex.AddElem(l);latex.AddMod("]");}}
if(this.argmap&&this.argmap.length>0){for(var i=0;i<this.argmap.length;i++){if(this.argmap[i]){if(this.type=="extpair"){latex.AddElem(this.argmap[i].toLatex());}else{var latex2=this.argmap[i].toLatex();if(this.eldata.allowspaces){var text=latex2.latex;var parser=new MEE.Parser();text=parser.replaceAll(text,"\\;","&nbsp;");text=parser.replaceAll(text," ","");text=parser.replaceAll(text,"&nbsp;"," ");latex2.latex=text;}
latex.AddArg(latex2);}}}}}
if(this.sizer){if(this.type=="extpair"){var size=this.getSizeModPair('right',this.sizer);latex.AddText(size);}}
if(this.type=="extpair"&&this.eldata.rb){var rcmd=this.lookupBracket(this.eldata.rb,'right');if(rcmd.substr(0,2)=="\\l")
rcmd="\\r"+rcmd.substr(2);latex.AddText(rcmd);}
if(this.subscript&&!this.eldata.arg0_as_sub){var l=this.subscript.toLatex();if(l.latex!=""){latex.AddMod("_");latex.AddSet(l);}}
if(this.superscript&&!this.eldata.sarg_as_sup&&!this.eldata.arg0_as_super){var l=this.superscript.toLatex();if(l.latex!=""){latex.AddMod("^");latex.AddSet(l);}}
return latex;},replacePX:function(val){val=parseInt(val);if(!val||val=='NaN'){return 0;}else{return val;}},dump:function(){var dump="<div class='dump_elem'>";if(!this.parent)
dump+="<div class='dump_no_parent'>NO PARENT</div>";if(this.main&&this.main.isbasic){dump+="<div class='dump_elem_head'>Elem Basic: "+this.latex;if(this.latex!=this.main.latex)
dump+="{"+this.main.latex+"}";dump+="</div>";}else{dump+="<div class='dump_elem_head'>Elem: "+this.latex+"</div>";}
if(this.subscript)
dump+="<div class='dump_elem_part'>Subscript: "+this.subscript.dump()+"</div>";if(this.superscript)
dump+="<div class='dump_elem_part'>SuperScript: "+this.superscript.dump()+"</div>";if(this.main&&!this.main.isbasic)
dump+="<div class='dump_elem_part'>Main: "+this.main.dump()+"</div>";if(this.args)
for(var i=0;i<this.args.length;i++)
dump+="<div class='dump_elem_part'>Arg "+i+": "+this.args[i].dump()+"</div>";if(this.sarg)
dump+="<div class='dump_elem_part'>SArg : "+this.sarg.dump()+"</div>";dump+="</div>";return dump;}});

MEE.Elem.extend("MEE.ElemAccent",{areLoadLargeFonts:false,LoadLargeFonts:function(elem){if(this.areLoadLargeFonts)
return;this.areLoadLargeFonts=true;$(elem).append("<span class='mee_large_font_loader' style='font-family: MathJax_Size1'>&#x02DC;</span>");$(elem).append("<span class='mee_large_font_loader' style='font-family: MathJax_Size2'>&#x02DC;</span>");$(elem).append("<span class='mee_large_font_loader' style='font-family: MathJax_Size3'>&#x02DC;</span>");$(elem).append("<span class='mee_large_font_loader' style='font-family: MathJax_Size4'>&#x02DC;</span>");},RemoveLargeFonts:function(){if(this.areRemoveLargeFonts)
return true;this.areRemoveLargeFonts=true;$('.mee_large_font_loader').remove();}},{toHTML:function(depth){if(this.args.length<1){var token={latex:''}
this.AddArg(token);}
var res=this._super(depth);this.html_elem.css('position','relative');MEE.ElemAccent.LoadLargeFonts(this.html_elem);return res;},sortAlign:function(){this.align=new MEE.Align();MEE.ElemAccent.RemoveLargeFonts();this.args[0].sortAlign();var tall='-0.35em';var top='-1.1';var topoffset=0;var topmax=0.1;if(this.eldata.accent_wide){var textlen=this.args[0].align.width;textlen=$(textlen).toEm({'scope':this.args[0].html_elem});if(textlen<0.6){}else if(textlen<1){$(this.html_main).css('font-family','MathJax_Size1');$(this.html_main).css('top','0.1em');tall='-0.1em';topoffset=0;}else if(textlen<1.46){$(this.html_main).css('font-family','MathJax_Size2');$(this.html_main).css('top','-0.45em');tall='-0.65em';topoffset=0.05;}else if(textlen<1.9){$(this.html_main).css('font-family','MathJax_Size3');$(this.html_main).css('top','-0.55em');tall='-0.75em';topoffset=0.05;}else{$(this.html_main).css('font-family','MathJax_Size4');$(this.html_main).css('top','-0.85em');tall='-1.05em';topoffset=0.05;}}
this.main.sortAlign();this.align.height=this.main.align.height;this.align.width=this.main.align.width;if(this.subscript)
this.subscript.sortAlign();if(this.superscript)
this.superscript.sortAlign();var accentwidth=this.main.align.width;var textwidth=this.args[0].align.width;if(this.eldata.handledots){$(this.html_main).css('position','absolute');$(this.html_main).css('top','-0.57em');var offset=Math.floor((accentwidth-textwidth)/2);if(offset>0){$(this.html_arg0).css('padding-left',offset+'px');$(this.html_elem).css('padding-right',offset+'px');}else{offset=Math.abs(offset);$(this.html_main).css('padding-left',offset+'px');}
if(hasTall(this.args[0].latex)){$(this.html_main).css('top',"-0.79em");}}else if(this.eldata.nopadleft){var accentwidth=0.45;accentwidth=$(accentwidth).toPx({'scope':this.html_elem});var accentoffset=0.5;accentoffset=$(accentoffset).toPx({'scope':this.html_elem});var offset=Math.floor((textwidth-accentwidth)/2);$(this.html_main).css('position','relative');$(this.html_main).css('left',offset+accentoffset+'px');}else if(textwidth>accentwidth){var offset=Math.floor((textwidth-accentwidth)/2);$(this.html_main).css('padding-left',offset+'px');}else if(accentwidth>textwidth){var offset=Math.floor((accentwidth-textwidth)/2);$(this.html_main).css('left',-offset+'px');}
var text=this.args[0].html_elem.text();while(text.indexOf('!')!=-1)
text=text.replace("!","");if(this.args[0].align.top>0){top=$(this.html_main).css('top').replace("em","").replace("px","");top-=0.4;top=$(top).toPx({'scope':this.args[0].html_elem});top-=this.args[0].align.top;$(this.html_main).css('top',top+'px');}else if(hasTall(text)&&!this.eldata.handledots){if($.browser.msie){tall='-1.22em';}
$(this.html_main).css('top',tall);topoffset+=0.22;}
topoffset+=0.22;top=$(this.html_main).css('top');if(top.indexOf("e")!=-1){top=top.replace("em","");top=$(top).toPx({'scope':this.args[0].html_elem});}else{top=top.replace("px","");}
topoffset=$(topoffset).toPx({'scope':this.args[0].html_elem});this.html_main.attr("topoffset",topoffset);this.html_main.attr("topmax",topmax);if(topoffset>topmax){this.align.top=topoffset-topmax;}
if(this.subscript||this.superscript)
this.alignSS();this.align.width=Math.max(textwidth,accentwidth);return this.align;}});

MEE.Elem.extend("MEE.ElemBoxed",{toHTML:function(depth){var res=this._super(depth);this.html_box=$('<span>');this.html_box.html(MEE.Data.blankspace);this.html_box.addClass('mee_boxed');this.html_elem.append(this.html_box);return res;},sortAlign:function(){var res=this._super();var pad=0.1;pad=$(pad).toPx({'scope':this.html_box});this.html_box.css('left',pad+'px');this.html_box.css('top',-this.main.align.top-pad+'px');this.html_box.css('padding-right',(this.main.align.width-MEE.Data.blankspacesize(this.html_box)-3)+pad+pad+'px');this.html_box.css('padding-top',this.main.align.top+pad+'px');this.html_box.css('padding-bottom',this.main.align.bottom+pad+'px');this.html_main.css('padding-left',2*pad+'px');this.html_main.css('padding-right',2*pad+'px');this.align.width+=pad*4;if(this.align.top<pad*2)
this.align.top=pad*2;if(this.align.bottom<pad*2)
this.align.bottom=pad*2;return res;}});

MEE.Elem.extend("MEE.ElemSpace",{sortAlign:function(){this.align=new MEE.Align();$(this.html_main).html("");$(this.html_main).css('padding-right',this.eldata.space);this.align.width=$(this.html_main).outerWidth(true);this.align.height=$(this.html_main).outerHeight(true);return this.align;}});

MEE.Elem.extend("MEE.ElemInput",{init:function(){this._name='MEE.ElemInput';this.html_elem=$('<span>');this.html_elem.addClass('mee_elem_input');this.html_elem.html('&#x200b;');this.html_elem.append(this.html_inner);},toHTML:function(){return this.html_elem;},sortAlign:function(){this.align=new MEE.Align();this.align.width=$(this.html_elem).outerWidth(true);this.align.height=$(this.html_elem).outerHeight(true);if(this.size){this.align.width=this.size;this.html_elem.css('padding-right',this.size+'px');}
return this.align;},dump:function(){var dump="<div class='dump_elem'>";dump+="<div class='dump_elem_head'>INPUT</div>";return dump;}});

MEE.Elem.extend("MEE.ElemAnswer",{init:function(){this._name='MEE.ElemAnswer';this.eldata={};},toHTML:function(){this.html_elem=$('<span>');this.html_elem.addClass('mee_elem_answer');this.html_inner=$('<input>');this.html_inner.addClass('mee_elem_answer_input');this.html_inner.attr('size','8');this.html_elem.append(this.html_inner);return this.html_elem;},sortAlign:function(){var fontsize=this.html_elem.css('font-size').replace('px','');fontsize=Math.floor(fontsize*0.7);this.html_inner.css('font-size',fontsize+'px');this.html_elem.css('padding-left','0.05em');this.html_inner.css('position','relative');this.html_inner.css('top','-3px');this.align=new MEE.Align();this.align.width=$(this.html_elem).outerWidth(true);this.align.height=$(this.html_elem).outerHeight(true);this.align.top=10;this.align.bottom=10;this.align.height+=20;return this.align;},dump:function(){var dump="<div class='dump_elem'>";dump+="<div class='dump_elem_head'>ANSWER</div>";return dump;}});

MEE.Elem.extend("MEE.ElemBond",{toHTML:function(depth){var res=this._super(depth);var bond=this.html_main.html();var bondtext="";if(this.main){var latex=this.main.latex;while(latex.indexOf(' ')!=-1)
latex=latex.replace(' ','');bondtext=MEE.Data.bonds[latex];if(!bondtext){bondtext=this.main.latex;}}
this.html_main.html(bondtext);return res;},sortAlign:function(){var res=this._super();return res;},SortBondInner:function(){var latex=this.html_main.text();while(latex.indexOf(' ')!=-1)
latex=latex.replace(' ','');while(latex.indexOf("\u2212")!=-1)
latex=latex.replace("\u2212",'-');if(latex.charCodeAt(latex.length-1)==8203){latex=latex.substr(0,latex.length-1);}
var bondtext=MEE.Data.bonds[latex];if(bondtext){this.html_main.html(bondtext);}}});

$.Class.extend("MEE.ElemSet",{elemsets:Array()},{single:false,isarray:0,toHTML:function(){},sortAlign:function(){this.align=new MEE.Align();this.align.height=MEE.Data.getBaseSize(this.html_elem);this.haselements=false;this.hasinput=false;if(this.elements){var l=this.elements.length;for(var i=0;i<l;i++){if(this.elements[i]._name!="MEE.ElemInput"){this.haselements=true;}else{this.hasinput=true;}
this.elements[i].sortAlign();this.align.Merge(this.elements[i].align);}}
if(this.isedit&&(this.html_elem.hasClass('mee_elemset_empty')||!this.haselements)){var minwidth=MEE.Data.emptywidth;minwidth=$(minwidth).toPx({'scope':this.html_elem});if(this.align.width<minwidth){this.html_elem.append(this.html_elem.find('.mee_elemset_empty_inner'));this.html_elem.find('.mee_elemset_empty_inner').css('padding-right',(minwidth-this.align.width)-MEE.Data.blankspacesize(this.html_elem)-2+'px');this.align.width=minwidth;}}
return this.align;},insertElemBeforeInput:function(elem){for(var i=0;i<this.elements.length;i++){var curelem=this.elements[i];if(curelem._name=="MEE.ElemInput"){elem.offset=i;this.elements.splice(i,0,elem);return i;}}
alert("Cannot find input element");this.elements.push(elem);elem.offset=this.elements.length-1;return this.elements.length-1;},getInputPos:function(){for(var i=0;i<this.elements.length;i++){var curelem=this.elements[i];if(curelem._name=="MEE.ElemInput"){return i;}}
return-1;},insertHTMLFor:function(elem,index){var html=elem.toHTML(this.depth);var input=this.elements[index+1];html.insertBefore(input.html_elem);},getElemBeforeInput:function(){for(var i=0;i<this.elements.length;i++){var curelem=this.elements[i];if(curelem._name=="MEE.ElemInput"){if(i>this.elements.length){return null;}
if(i==0)
return null;this.elements[i-1].offset=i-1;return this.elements[i-1];}}},removeInput:function(){if(this.parent&&this.parent.eldata&&this.parent.eldata.object=='Bond'){this.parent.SortBondInner();}
for(var i=0;i<this.elements.length;i++){var curelem=this.elements[i];if(curelem._name=="MEE.ElemInput"){this.elements.splice(i,1);break;}}
$('.mee_elem_input_box').val("");this.sortBlanks();this.html_elem.css('background-color','');},sortBlanks:function(){if(!this.isedit)
return;var haselements=false;var hasinput=false;for(var i=0;i<this.elements.length;i++){if(this.elements[i]._name!="MEE.ElemInput"){haselements=true;break;}else{hasinput=true;}}
if(!haselements){if(!this.html_elem.hasClass('mee_elemset_empty')){var blank=$('<span class="mee_elemset_empty_inner"></span>');blank.html(MEE.Data.blankspace);this.html_elem.append(blank);this.html_elem.addClass('mee_elemset_empty');}}else{this.html_elem.children('.mee_elemset_empty_inner').remove();this.html_elem.removeClass('mee_elemset_empty');}},Highlight:function(){if(!this.isedit)
return;if(typeof this.selectStart=="number"){var hldiv=$('.mee_edit_highlight_elem');hldiv.css('display','none');var hldiv=$('.mee_edit_highlight_multi');hldiv.css('display','block');var startelem=this.elements[this.selectStart].html_elem;var inputpos=this.getInputPos();var endelem=this.elements[inputpos].html_elem;MEE.Tools.HTML.AlignElementOver([startelem,endelem],hldiv,this.align);return;}
var hldiv=$('.mee_edit_highlight_multi');hldiv.css('display','none');var elem=this.getElemBeforeInput();if(this.single&&!this.inmatrix){var hldiv=$('.mee_edit_highlight');MEE.Tools.HTML.AlignElementOver(this.html_elem,hldiv,this.align);hldiv.css('background-image','url('+mee_baseurl+'images/edit/highlight_red.png)');hldiv.css('display','block');}else{var hldiv=$('.mee_edit_highlight');hldiv.css('display','none');}
if(elem){elem_html=elem.html_elem;var hldiv=$('.mee_edit_highlight_elem');MEE.Tools.HTML.AlignElementOver(elem_html,hldiv,elem.align);hldiv.css('display','block');}else{var hldiv=$('.mee_edit_highlight_elem');hldiv.css('display','none');}},getElementOffset:function(elem){for(var i=0;i<this.elements.length;i++){if(elem==this.elements[i])
return i;}
return-1;},findElement:function(latex){if(this.elements&&this.elements.length>0){for(var i=0;i<this.elements.length;i++){var elem=this.elements[i];if(elem.latex==latex){return{'set':this,'elem':elem};}
if(elem.main){var res=elem.main.findElement(latex);if(res)return res;}
if(elem.sarg){var res=elem.sarg.findElement(latex);if(res)return res;}
if(elem.superscript){var res=elem.superscript.findElement(latex);if(res)return res;}
if(elem.subscript){var res=elem.subscript.findElement(latex);if(res)return res;}
if(elem.args&&elem.args.length>0){for(var k=0;k<elem.args.length;k++){var res=elem.args[k].findElement(latex);if(res)return res;}}}}
return null;},toLatex:function(){var latex=new MEE.Latex();if(this.eldata.displaystyle)
latex.AddText("\\displaystyle");if(this.eldata.textstyle)
latex.AddText("\\textstyle");for(var i=0;i<this.elements.length;i++){latex.AddElem(this.elements[i].toLatex());}
return latex;}});

MEE.ElemSet.extend("MEE.ElemSetNormal",{html_elem:null,latex:null,eldata:null,init:function(latex,par,isedit){this._name='MEE.ElemSetNormal';this.latex=latex;this.parent=par;this.isedit=isedit;if(par&&par.isedit)
this.isedit=true;var parser=new MEE.Parser();this.elements=parser.parse(latex,par);for(var i=0;i<this.elements.length;i++){this.elements[i].parent=this;}
if(par&&parser.apply_to_parent){for(var ttname in parser.apply_to_parent){var value=parser.apply_to_parent[ttname];par.eldata[ttname]=value;}}
this.eldata=parser.apply_to_thisset;},toHTML:function(depth){this.elemid=MEE.ElemSet.elemsets.length;MEE.ElemSet.elemsets[this.elemid]=this;if(this.eldata.displaystyle)
depth=1;if(this.eldata.textstyle)
depth=2;this.depth=depth;this.html_elem=$('<span class="mee_elemset" depth="'+depth+'" elem="'+this.elemid+'"></span>');var dodepth=true;if(this.parent&&this.parent.depth==this.depth)
dodepth=false;if(dodepth){var size=MEE.Data.fontsizes[this.depth];$(this.html_elem).css('font-size',size);}
for(var i=0;i<this.elements.length;i++){this.html_elem.append(this.elements[i].toHTML(depth));}
this.sortBlanks();return this.html_elem;},dump:function(){var dump="<div class='dump_set'>";if(!this.parent)
dump+="<div class='dump_no_parent'>NO PARENT</div>";dump+="<div class='dump_set_elemes'>";for(var i=0;i<this.elements.length;i++){dump+=this.elements[i].dump();}
dump+="</div></div>";return dump;}});

MEE.ElemSet.extend("MEE.ElemSetBasic",{basicelems:Array()},{html_elem:null,latex:null,eldata:null,isbasic:1,init:function(latex,eldata,par){this._name='MEE.ElemSetBasic';this.latex=latex;this.eldata=jQuery.extend({},eldata);this.isbasic=1;if(par.isedit)
this.isedit=true;this.parent=par;},toHTML:function(depth){this.elemid=MEE.ElemSetBasic.basicelems.length;MEE.ElemSetBasic.basicelems[this.elemid]=this;this.depth=depth;this.html_elem=$('<span class="mee_elemsetbasic" elem="'+this.elemid+'" depth="'+depth+'"></span>');this.text="";if('text'in this.eldata){this.text=this.eldata.text;}else{this.text=this.latex;}
this.basetext=this.text;this.html_elem.attr('basetext',this.basetext);if(MEE.Data.replace[this.text])this.text=MEE.Data.replace[this.text];if(MEE.Data.largechars[this.basetext]&&this.eldata.large){var chardata=MEE.Data.getLargeCharData(this.basetext,this.html_elem);this.html_inner=$('<span class="mee_basic_large_inner" style="position:absolute; left:0px; padding-right200px"></span>');this.html_inner.html(this.text);this.html_elem.append(this.html_inner);this.html_elem.css('position','relative');var space=$(MEE.Data.blankspace);this.html_elem.append(space);this.html_elem.addClass('mee_basic_large_outer');}else{this.html_elem.html(this.text);}
if(this.eldata.mainclass)
this.html_elem.addClass(this.eldata.mainclass);return this.html_elem;},sortAlign:function(){this.align=new MEE.Align();if(MEE.Data.largechars[this.basetext]&&this.eldata.large){var size=2;if(this.eldata.size1_font_if_depth&&this.depth>1){this.html_inner.css('font-family','MathJax_Size1');this.html_inner.addClass('mee_large_shrunk');size=1;}
var chardata=MEE.Data.getLargeCharData(this.basetext,this.html_elem,size);this.html_inner.css('top',chardata.offset+'px');this.html_elem.css('padding-right',chardata.width-MEE.Data.blankspacesize(this.html_elem)+'px');this.align.width=chardata.width+1;this.align.top=chardata.top;this.align.bottom=chardata.bottom;this.align.height=MEE.Data.getBaseSize(this.html_elem)+this.align.top+this.align.bottom;}else if(MEE.Data.largechars[this.basetext]){var size=parseInt(this.html_elem.css('font-family').replace('MathJax_Size',''));if(!(size>0)){this.align.width=$(this.html_elem).outerWidth(true);this.align.height=MEE.Data.getBaseSize(this.html_elem);}else{var chardata=MEE.Data.getLargeCharData(this.basetext,this.html_elem,size);this.align.width=chardata.width+1;this.align.top=chardata.top;this.align.bottom=chardata.bottom;this.align.height=MEE.Data.getBaseSize(this.html_elem)+this.align.top+this.align.bottom;}}else{this.align.width=$(this.html_elem).outerWidth(true);this.align.height=MEE.Data.getBaseSize(this.html_elem);}
return this.align;},toLatex:function(){var latex=new MEE.Latex();latex.AddText(this.text);return latex;},dump:function(){var dump="Basic: "+this.latex;if(!this.parent)
dump+="<div class='dump_no_parent'>NO PARENT</div>";return dump;}});

$.Class.extend("MEE.Row",{cols:0,init:function(eldata,row,par){this._name='MEE.Row';this.row=row;this.parent=par;if(par.isedit)
this.isedit=true;this.eldata=jQuery.extend({},eldata);},addElem:function(token){if(!token)return;this['col'+this.cols]=new MEE.ElemSetNormal(token.latex,this);this['col'+this.cols].inmatrix=this.eldata.inmatrix;this.cols++;},addRowText:function(latex){if(this.eldata.nosplit){this['col0']=new MEE.ElemSetNormal(latex,this);this['col0'].inmatrix=this.eldata.inmatrix;this['col0'].col=0;this.cols=1;return;}
var cols=latex.split("&");for(var i=0;i<cols.length;i++){this['col'+i]=new MEE.ElemSetNormal(cols[i],this);this['col'+i].inmatrix=this.eldata.inmatrix;this['col'+i].col=i;}
this.cols=cols.length;},toHTML:function(depth,subdepth){this.elemid=MEE.ElemSet.elemsets.length;MEE.ElemSet.elemsets[this.elemid]=this;this.html_elem=$('<span class="mee_row" elem="'+this.elemid+'"></span>');this.depth=depth;this.subdepth=subdepth;for(var i=0;i<this.cols;i++){this.createColHTML(i,subdepth);}
if(this.eldata.hline){if(this.row+1==this.parent.rows&&this.eldata.hline&&this.cols==1&&$.trim(this.col0.latex)=="\\hline"){this.parent.eldata.border=1;}else{this.html_line=$('<span class="mee_hline"></span>');this.html_line.html(MEE.Data.blankspace);this.html_elem.append(this.html_line);}}
return this.html_elem;},createColHTML:function(colno,subdepth){if(this.html_elem){this['html_col'+colno]=this['col'+colno].toHTML(subdepth);this['html_col'+colno].addClass('mee_col');this.html_elem.append(this['html_col'+colno]);if(this.eldata.colclass)
this['html_col'+colno].addClass(this.eldata.colclass);}},sortAlign:function(){this.align=new MEE.Align();for(var i=this.cols;i--;){var colalign=this['col'+i].sortAlign();this.align.Merge(colalign);}
return this.align;},addCols:function(cols){for(var c=this.cols;c<cols;c++){this['col'+c]=new MEE.ElemSetNormal("",this);this['col'+c].inmatrix=this.eldata.inmatrix;this['col'+c].col=c;this['col'+c].depth=this.subdepth;this.createColHTML(c,this.subdepth);}
this.cols=cols;},dump:function(){var dump="";if(!this.parent)
dump+="<div class='dump_no_parent'>NO PARENT</div>";for(var i=0;i<this.cols;i++){dump+="<td>";dump+=this['col'+i].dump();dump+="</td>";}
return dump;}});MEE.ElemSet.extend("MEE.ElemSetArray",{rows:0,cols:0,alignment:'',init:function(eldata,alignment,par){this._name='MEE.ElemSetArray';this.parent=par;this.eldata=jQuery.extend({},eldata);if(alignment)
this.alignment=alignment;if(par.isedit)
this.isedit=true;this.isarray=1;},UpperLower:function(upper,lower){if(!this.row0){this.row0=new MEE.Row(this.eldata,0,this);this.row1=new MEE.Row(this.eldata,1,this);this.row0.row=0;this.row1.row=1;this.rows=2;this.cols=1;}
if(upper)
this.row0.addElem(upper);if(lower)
this.row1.addElem(lower);},AddArray:function(token){if(this.eldata.nosplit){this['row0']=new MEE.Row(this.eldata,0,this);this['row0'].addRowText(token.latex);this['row0'].row=0;this.cols=Math.max(this.cols,this['row0'].cols);this.rows=1;return;}
var rows=token.latex.split("\\\\");for(var i=0;i<rows.length;i++){this['row'+i]=new MEE.Row(this.eldata,i,this);this['row'+i].addRowText(rows[i]);this['row'+i].row=i;this.cols=Math.max(this.cols,this['row'+i].cols);}
this.rows=rows.length;this.fillInBlankCols();},createRowHTML:function(i,subdepth){this['html_row'+i]=this['row'+i].toHTML(this.depth,subdepth);this.html_elem.append(this['html_row'+i]);this['html_row'+i].css({left:'0px',position:'absolute'});if(i==0&&this.eldata.upperclass)
this['html_row'+i].addClass(this.eldata.upperclass);if(i==1&&this.eldata.lowerclass)
this['html_row'+i].addClass(this.eldata.lowerclass);if(this.eldata.rowclass)
this['html_row'+i].addClass(this.eldata.rowclass);},fillInBlankCols:function(){for(var r=0;r<this.rows;r++){if(this['row'+r].cols<this.cols){this['row'+r].addCols(this.cols);}}},toHTML:function(depth){this.validateColWidths();this.html_elem=$('<span class="mee_elemsetarray" style="position: relative"></span>');if(this.eldata.lend){this.html_lend=$('<span class="mee_barend"></span>');this.html_lend.html(this.eldata.lend);this.html_elem.append(this.html_lend);}
if(this.eldata.rend){this.html_rend=$('<span class="mee_barend"></span>');this.html_rend.html(this.eldata.rend);this.html_elem.append(this.html_rend);}
this.html_padding=$('<span style="position: relative"></span>');this.html_padding.html(MEE.Data.blankspace);this.html_elem.append(this.html_padding);if($.browser.msie&&document.documentMode>7){this.depth=depth+1;if(this.eldata.nodepth){this.depth=depth;}
this.html_elem.attr('depth',this.depth);var subdepth=this.depth;}else{this.depth=depth;this.html_elem.attr('depth',depth);var subdepth=depth+1;if(this.eldata.nodepth){subdepth=depth;}else if(this.eldata.extradepth){subdepth=depth+2;}}
var dodepth=true;if(this.parent&&this.parent.depth==this.depth)
dodepth=false;if(dodepth){var size=MEE.Data.fontsizes[this.depth];$(this.html_elem).css('font-size',size);}
if(this.eldata.bar){this.html_bar=$('<span class="mee_bar"></span>');this.html_elem.append(this.html_bar);}
for(var i=0;i<this.rows;i++){this.createRowHTML(i,subdepth);}
if(this.eldata.border){this.html_line=$('<span class="mee_array_border"></span>');this.html_line.html(MEE.Data.blankspace);this.html_elem.append(this.html_line);}
for(col in this.vlines){if(col<this.cols){this['html_vline'+col]=$('<span class="mee_vline"></span>');this['html_vline'+col].html(MEE.Data.blankspace);this.html_elem.append(this['html_vline'+col]);}}
return this.html_elem;},sortAlign:function(){this.align=new MEE.Align();var lendwidth=0;if(this.eldata.lend){lendwidth=MEE.Data.arrowendwidths[this.eldata.lend];lendwidth=$(lendwidth).toPx({'scope':this.html_elem});}
var rendwidth=0;if(this.html_rend){rendwidth=MEE.Data.arrowendwidths[this.eldata.rend];rendwidth=$(rendwidth).toPx({'scope':this.html_elem});}
if(this.eldata.evenpos){var row0align=this['row0'].sortAlign();var row1align=this['row1'].sortAlign();var mainheight=MEE.Data.getBaseSize(this.html_padding);this.align.height=mainheight;try{var tpad=0.1;tpad=$(tpad).toPx({'scope':this.html_elem});var bpad=0.1;bpad=$(bpad).toPx({'scope':this.html_elem});}catch(err){}
var top=row0align.height-Math.floor(mainheight/2)+tpad-row0align.top;var bottom=Math.floor(mainheight/2)+row1align.top+bpad;if(this['html_row1'])
this['html_row0'].css('top',-top+'px');if(this['html_row1'])
this['html_row1'].css('top',bottom+'px');this.align.top=top+row0align.top;this.align.bottom=row1align.height-Math.floor(mainheight/2)+bpad-1;}else{var totalheight=0;for(var i=0;i<this.rows;i++){this['row'+i].sortAlign();}
this.RemoveBlanks();for(var i=0;i<this.rows;i++){totalheight+=this['row'+i].align.height;}
var mainheight=MEE.Data.getBaseSize(this.html_padding);this.align.height=mainheight;var above=-Math.floor((totalheight-mainheight)/2);this.align.top=Math.abs(above);for(var i=0;i<this.rows;i++){this['html_row'+i].css('top',above+this['row'+i].align.top+'px');above+=this['row'+i].align.height;}
this.align.bottom=above-mainheight;}
var totalwidth=0;var coloffsets={};for(var col=0;col<this.cols;col++){var maxwidth=0;for(var row=0;row<this.rows;row++){var rowc=this['row'+row];if(!rowc)
continue;var colc=rowc['col'+col];if(!colc)
continue;var elwidth=colc.align.width;maxwidth=Math.max(maxwidth,elwidth);}
if('padding'in this.eldata){var pad=this.eldata.padding;pad=$(pad).toPx({'scope':this.html_elem});maxwidth+=pad;}
totalwidth+=maxwidth;coloffsets[col]=totalwidth;for(row=0;row<this.rows;row++){var rowc=this['row'+row];if(!rowc)
continue;var colc=rowc['col'+col];if(!colc)
continue;var elwidth=colc.align.width;if(elwidth<maxwidth){if(this.colalign[col]=="l"){$(colc.html_elem).css('padding-right',maxwidth-elwidth+'px');}else if(this.colalign[col]=="r"){$(colc.html_elem).css('padding-left',maxwidth-elwidth+'px');}else{var padl=Math.floor((maxwidth-elwidth)/2);var padr=Math.ceil((maxwidth-elwidth)/2);$(colc.html_elem).css({'padding-left':padl+lendwidth+'px','padding-right':padr+'px'});}}else{$(colc.html_elem).css({'padding-right':'1px','padding-left':lendwidth+'px'});}}}
totalwidth+=lendwidth+rendwidth;var padright=totalwidth;$(this.html_elem).css('padding-right',padright-MEE.Data.blankspacesize(this.html_elem)+'px');for(var row=0;row<this.rows;row++){if(this['row'+row]&&this['row'+row].html_line){$(this['row'+row].html_line).css({'padding-right':padright+'px','top':-this['row'+row].align.top+'px'});}}
if(this.html_bar){var barpadding=0.07;barpadding=$(barpadding).toPx({'scope':this.html_elem});var barwidth=totalwidth-(2*barpadding)-lendwidth-rendwidth;barwidth=$(barwidth).toEm({'scope':this.html_elem});var bartext=MEE.Tools.HTML.BuildBarText(barwidth,this.eldata.bartype);this.html_bar.html(bartext);this.html_bar.css('margin-left',barpadding+lendwidth+'px');}
if(this.html_rend){var offset=totalwidth-this.html_rend.outerWidth();this.html_rend.css('padding-left',offset+'px');}
this.align.height+=this.align.top+this.align.bottom;this.align.width=totalwidth;var bl=0.05;bl=$(bl).toPx({'scope':this.html_elem});if(this.eldata.border){var borderheight=MEE.Data.getBaseSize(this.html_line);this.html_line.css({'left':'0px','top':-this.align.top+'px','padding-right':padright-bl+'px','padding-bottom':this.align.height-borderheight-bl+'px'});}
for(col in this.vlines){if(col<this.cols){var offset=coloffsets[col-1];var borderheight=MEE.Data.getBaseSize($(this['html_vline'+col]));this['html_vline'+col].css({'left':offset+'px','top':-this.align.top+'px','padding-bottom':this.align.height-borderheight+'px'});}}
return this.align;},validateColWidths:function(){this.colalign=new Array();var align=this.eldata.align;if(this.alignment)
align=this.alignment;this.vlines={};if(align){align=align.replace(new RegExp(' ','g'),'');var colno=0;for(var i=0;i<align.length;i++){var alignchar=align.charAt(i);if(alignchar=="*"){var prevchar=align.charAt(i-1);for(k=i;k<this.cols;k++){this.colalign[k]=prevchar;}
if(i+1<align.length)
this.colalign[this.cols-1]=align.charAt(align.length-1);break;}else{if(alignchar=='|'){this.vlines[colno]=1;}else{this.colalign[colno++]=alignchar;}}}}
for(var i=0;i<this.cols;i++){if(!this.colalign[i]){if(align&&align.length>0)
this.colalign[i]=align.charAt(align.length-1);else
this.colalign[i]='c';}}},getPosition:function(elementset){for(var r=0;r<this.rows;r++){for(var c=0;c<this.cols;c++){if(this['row'+r]['col'+c]==elementset){return{row:r,col:c};}}}
return{row:-1,col:-1};},toLatex:function(){var latex=new MEE.Latex();if(this.eldata.custalign)
latex.AddText("{"+this.alignment+"}");for(var r=0;r<this.rows;r++){var row=this['row'+r];if(row){if(row.eldata.hline)
latex.AddText("\\hline ");for(var c=0;c<row.cols;c++){var col=row['col'+c];if(col){var coll=col.toLatex();if(coll.latex!=""){latex.AddElem(coll);}}
if(c<row.cols-1)
latex.AddMod(" & ");}}
if(r<this.rows-1)
latex.AddMod(" \\\\ ");}
return latex;},isColBlank:function(i,ignoreinput){var colisblank=true;for(var r=0;r<this.rows;r++){var col=this['row'+r]['col'+i];if(ignoreinput){if(col&&col.haselements)
colisblank=false;}else{if(col&&(col.haselements||col.hasinput))
colisblank=false;}}
return colisblank;},isRowBlank:function(i,ignoreinput){var rowisblank=true;for(var c=0;c<this.cols;c++){var col=this['row'+i]['col'+c];if(ignoreinput){if(col&&col.haselements)
rowisblank=false;}else{if(col&&(col.haselements||col.hasinput))
rowisblank=false;}}
return rowisblank;},RemoveBlanks:function(){if(this.eldata.frac)
return;for(var i=this.cols-1;i>0;i--){var colisblank=this.isColBlank(i);if(colisblank){for(var r=0;r<this.rows;r++){var row=this['row'+r];if(row&&row['col'+i]&&row['col'+i].html_elem){row['col'+i].html_elem.remove();row['col'+i]=null;row.cols--;}}
this.cols--;}else{break;}}
for(var i=this.rows-1;i>0;i--){var rowisblank=this.isRowBlank(i);if(rowisblank){var row=this['row'+i];if(row){row.html_elem.remove();row=null;}
this.rows--;}else{break;}}},DeleteRow:function(row){if(this.eldata.frac)
return;this['row'+row].html_elem.remove();this['row'+row]=null;this['html_row'+row]=null;for(var i=row+1;i<this.rows;i++){this['row'+(i-1)]=this['row'+i];this['row'+(i-1)].row=i-1;this['row'+i]=null;this['html_row'+(i-1)]=this['html_row'+i];this['html_row'+i]=null;}
this.rows--;},AppendRow:function(){if(this.eldata.frac)
return;var row=new MEE.Row(this.eldata,this.rows,this);row.row=this.rows;row.cols=0;row.depth=this.depth;row.subdepth=this.depth+1;this['row'+this.rows]=row;this.createRowHTML(this.rows,this.depth+1);this.rows++;this.fillInBlankCols();},InsertRow:function(row){if(this.eldata.frac)
return;for(var i=this.rows-1;i>=row;i--){this['row'+(i+1)]=this['row'+i];this['row'+(i+1)].row=i+1;this['row'+i]=null;this['html_row'+(i+1)]=this['html_row'+i];this['html_row'+i]=null;}
var rowe=new MEE.Row(this.eldata,this.rows,this);this['row'+row]=rowe;this['row'+row].row=row;this['row'+row].cols=0;this['row'+row].depth=this.depth;this['row'+row].subdepth=this.depth+1;this.createRowHTML(row,this.depth+1);this.rows++;this.fillInBlankCols();},DeleteCol:function(col){if(this.eldata.frac)
return;for(var r=0;r<this.rows;r++){var row=this['row'+r];row['col'+col].html_elem.remove();row['col'+col]=null;row['html_col'+col]=null;row.cols--;}
for(var i=col+1;i<this.cols;i++){for(var r=0;r<this.rows;r++){var row=this['row'+r];row['col'+(i-1)]=row['col'+i];row['col'+(i-1)].col=i-1;row['col'+i]=null;row['html_col'+(i-1)]=row['html_col'+i];row['html_col'+i]=null;}}
this.cols--;},AppendCol:function(){if(this.eldata.frac)
return;this.cols++;this.fillInBlankCols();},InsertCol:function(col){if(this.eldata.frac)
return;for(var i=this.cols-1;i>=col;i--){for(var r=0;r<this.rows;r++){var row=this['row'+r];row['col'+(i+1)]=row['col'+i];row['col'+(i+1)].row=i+1;row['col'+i]=null;row['html_col'+(i+1)]=row['html_col'+i];row['html_col'+i]=null;}}
for(var r=0;r<this.rows;r++){var row=this['row'+r];row['col'+col]=new MEE.ElemSetNormal("",row);row['col'+col].inmatrix=row.eldata.inmatrix;row['col'+col].col=col;row['html_col'+col]=row['col'+col].toHTML(row.subdepth);row['html_col'+col].addClass('mee_col');if(row.eldata.colclass)
row['html_col'+col].addClass(row.eldata.colclass);var nextcol=row['html_col'+(col+1)];nextcol.before(row['html_col'+col]);row.cols++;}
this.cols++;this.fillInBlankCols();},findElement:function(latex){for(var r=0;r<this.rows;r++){var row=this['row'+r];if(!row)
continue;for(var c=0;c<row.cols;c++){var col=row['col'+c];if(!col)
continue;var res=col.findElement(latex);if(res)return res;}}
return null;},getSetAt:function(pos){if(this['row'+pos.row]&&this['row'+pos.row]['col'+pos.col])
return this['row'+pos.row]['col'+pos.col];return null;},dump:function(){var dump="<div class='dump_set'>";if(!this.parent)
dump+="<div class='dump_no_parent'>NO PARENT</div>";dump+="<table style='font-size:100%;'>";for(var i=0;i<this.rows;i++){dump+="<tr>";dump+=this['row'+i].dump();dump+="</tr>";}
dump+="</table>";dump+="</div>";return dump;}});

$.Class.extend("MEE.Toolbar",{defs:{},activetab:null,popupmenuid:1,curpopupmenu:null,nomouseover:false,leavecount:0,toolbarelem:false,toolbaralwayson:false,images:{'22x22':1,'102x22':1,'220x58':1,'220x32':1,'220x35':1,'60x69':1,'75x22':1,'110x22':1,'53x24':1,'50x24':1,'100x24':1,'100x36':1,'32x32':1,'96x96':1,'160x36':1,'120x36':1,'64x64':1,'100x22':1,'96x24':1,'130x24':1,'64x24':1},appendElement:function(base,element,classlist,content){var newelem=$('<'+element+'>');if(classlist){$(newelem).addClass(classlist);}
if(content){$(newelem).html(content);}
$(base).append(newelem);return newelem;},AddImage:function(parelem,image){var div=$('<span>');parelem.append(div);var imgdata=MEE.Toolbar.ApplyImage(div,image);if(!imgdata)
return div;$(div).css('width',imgdata.width+'px');$(div).css('height',imgdata.height+'px');$(div).css('display','block');return div;},ApplyImage:function(element,image,size,repeat){if(image in MEE.Data.images){var imgdata=MEE.Data.images[image];$(element).css('background-image','url('+mee_baseurl+'images/combined.png)');$(element).css('background-position',(-imgdata.left)+'px '+(-imgdata.top)+'px');if(size)
$(element).css('background-size',(imgdata.width)+'px '+(imgdata.height)+'px');if(repeat)
$(element).css('background-repeat',repeat);else
$(element).css('background-repeat','no-repeat');return imgdata;}else{$(element).css('background-image','url('+mee_baseurl+'images/'+image+')');$(element).css('background-position','');$(element).css('background-repeat','');}}},{tbbase:null,inputelem:null,eventsinit:false,init:function(element){this.inputelem=element;this.currentEdit=null;this.orbmenu=true;this.showtabs=true;this.type='default';if($(element).hasClass('sci')){this.type='sci';}
if($(element).hasClass('units')){this.type='units';}},loadToolBar:function(tbtype){var xmlurl='toolbar/toolbar.xml';var callbackfn="buildToolBar";if(tbtype!='default'){xmlurl='toolbar/toolbar_'+tbtype+'.xml';callbackfn="buildToolBarSingleFunction";this.toolbaralwayson=true;}
$.ajax({type:"GET",url:mee_baseurl+xmlurl,dataType:"xml",success:this.callback(callbackfn)});},buildToolBarSingleFunction:function(temp,xml){var toolbar=$.xml2json(xml);var main=$('<div>');this.html_elem=main;main.addClass('mee_toolbar_single');this.toolbarelem=main;for(var k=0;k<toolbar.items.length;k++){var paneitem=toolbar.items[k];if(!paneitem.sections){if(!paneitem.latex)
continue
temp=MEE.Toolbar.appendElement(main,"div","tb_symbol");temp.data('latex',paneitem.latex);if(paneitem.command)
temp.data('command',paneitem.command);MEE.Toolbar.appendElement(temp,"a","",paneitem.display);}else{var menuclass="tb_menu_small";var menuimg="toolbar/arrow_down.png";var menuitemconta=MEE.Toolbar.appendElement(main,"div",menuclass);menuitemconta.attr('id',"popupmenubutton"+MEE.Toolbar.popupmenuid);menuitemconta.attr('popuptype','menus');menuitemconta.attr('popupmenu',MEE.Toolbar.popupmenuid);menuitemconta.addClass('tb_menu_button');var menuitemcont=MEE.Toolbar.appendElement(menuitemconta,"a");menuitemcont.attr('popupmenu',MEE.Toolbar.popupmenuid);temp=MEE.Toolbar.appendElement(menuitemcont,"div","icon");if(paneitem.image){var img=MEE.Toolbar.AddImage(temp,'tbicons/'+paneitem.image);img.css('margin-left','14px');img.css('margin-right','14px');}
temp.attr("alt",paneitem.display);temp=MEE.Toolbar.appendElement(menuitemcont,"div","text",paneitem.display);temp=MEE.Toolbar.appendElement(menuitemcont,"div","arrow");var img=MEE.Toolbar.AddImage(temp,menuimg);img.css('margin-left','12px');img.css('margin-right','12px');var menupopup=MEE.Toolbar.appendElement(main,"div","tb_popupmenu");menupopup.addClass("tb_popupmenu_vert");menupopup.css("display","none");menupopup.attr('id',"popupmenu"+MEE.Toolbar.popupmenuid);var menuinner=MEE.Toolbar.appendElement(menupopup,"div","tb_popupmenu_inner");var menufooter=MEE.Toolbar.appendElement(menupopup,"div","tb_popupmenu_footer");if(paneitem.popupwidth)
menuinner.css('width',paneitem.popupwidth+'px');for(var p=0;p<paneitem.sections.length;p++){var section=paneitem.sections[p];if(!section)continue;MEE.Toolbar.appendElement(menuinner,"div","tbpm_header",section.heading);MEE.Toolbar.appendElement(menuinner,"div","clear");if(section.items){for(var q=0;q<section.items.length;q++){var item=section.items[q];if(!item)continue;var _class="tbpm_item";if(section._class)
_class=section._class;var item_elem=MEE.Toolbar.appendElement(menuinner,"div",_class);if(item._class){item_elem.addClass(item._class);item_elem.data('class',item._class);}
if(section.listwidth)
item_elem.css('width',section.listwidth+'px');item_elem.data('latex',item.latex);if(item.wlatex)
item_elem.data('wlatex',item.wlatex);if(item.mlatex)
item_elem.data('mlatex',item.mlatex);item_elem.data('text',item.display);if(item.command)
item_elem.data('command',item.command);item_elem=MEE.Toolbar.appendElement(item_elem,"a");var div2=MEE.Toolbar.appendElement(item_elem,"div","icon");if(item.image){MEE.Toolbar.AddImage(div2,'tbicons/'+item.image);}
MEE.Toolbar.appendElement(item_elem,"div","label",item.display);}}}
MEE.Toolbar.popupmenuid++;}}},buildToolBar:function(temp,xml){var toolbar=$.xml2json(xml);var main=$('<div>');this.html_elem=main;main.addClass('mee_toolbar');var main_list=MEE.Toolbar.appendElement(main,"div","mt_main");var tabs_list=MEE.Toolbar.appendElement(main,"div","mt_tabs");this.toolbarelem=main;if(this.orbmenu==true){var home=MEE.Toolbar.appendElement(main_list,"div","mt_home");var home_link=MEE.Toolbar.appendElement(home,"a","","");home_link.attr('href','#home');var homemenu=MEE.Toolbar.appendElement(main,"div","mt_home_popup");var homeinner=MEE.Toolbar.appendElement(homemenu,"div","mt_home_inner");for(var k=0;k<toolbar.home.items.length;k++){var data=toolbar.home.items[k];if(data.spacer){var homeitem=MEE.Toolbar.appendElement(homeinner,"div","mt_home_popup_spacer");}else{var homeitem=MEE.Toolbar.appendElement(homeinner,"div",data._class);var image=MEE.Toolbar.AddImage(homeitem,'toolbar/'+data.image);var text=MEE.Toolbar.appendElement(homeitem,"span","mt_home_popup_item_label");if(data.checked==1||data.checked==-1){var check=null;if(data.checked==1){check=MEE.Toolbar.AddImage(homeitem,'toolbar/home_tick.png');}else{check=MEE.Toolbar.AddImage(homeitem,'toolbar/home_tick_blank.png');}
check.addClass('mt_home_popup_check');if(data.id){check.attr('id',data.id+'_check');}}
text.html(data.name);if(data.command){homeitem.data('command',data.command);homeitem.click(this.callback('itemClick'));}
if(data.id){homeitem.attr('id','tb_home_'+data.id);image.attr('id','tb_home_'+data.id+'_img');}}}}
for(var r=0;r<toolbar.tabs.length;r++){var tab=toolbar.tabs[r];if(!tab)continue;var tab_elem=MEE.Toolbar.appendElement(main_list,"div","mt_tab");if(tab.visibility){tab_elem.data('visibility',tab.visibility);}
tab_elem.data('id','mee_tab_'+tab.id);tab_elem.attr('id','mee_tab_link_'+tab.id);var link=MEE.Toolbar.appendElement(tab_elem,"a","",tab.name);link.attr('href','#'+'mee_tab_'+tab.id);var panes=MEE.Toolbar.appendElement(tabs_list,"div","mt_tabblock");panes.attr('id','mee_tab_'+tab.id);if(!tab.panes)continue;for(var s=0;s<tab.panes.length;s++){var pane=tab.panes[s];if(!pane)continue;var pane_cont=MEE.Toolbar.appendElement(panes,"div","mt_tabpanecont");pane_cont.attr('id','mt_pane_'+pane.id);var pane_elem=MEE.Toolbar.appendElement(pane_cont,"div","mt_tabpane");pane_elem.attr('id','mt_pane_elem_'+pane.id);var pane_label=MEE.Toolbar.appendElement(pane_cont,"div","mt_tabpanelabel",pane.name);var divider=MEE.Toolbar.AddImage(panes,'toolbar/divider.png');divider.addClass('mt_tabdivider');if(!pane.items)continue;var itemcount=pane.items.length;if(pane.type=="icons"){for(var u=0;u<pane.items.length;u++){var paneitem=pane.items[u];if(!paneitem||!paneitem.display){itemcount--;continue;}
temp=MEE.Toolbar.appendElement(pane_elem,"div","tb_symbol");temp.data('latex',paneitem.latex);if(paneitem.command)
temp.data('command',paneitem.command);MEE.Toolbar.appendElement(temp,"a","",paneitem.display);}}else if(pane.type=="bigicons"){for(var u=0;u<pane.items.length;u++){var paneitem=pane.items[u];if(!paneitem||!paneitem.display){itemcount--;continue;}
temp=MEE.Toolbar.appendElement(pane_elem,"div","tb_bigicons");temp.data('latex',paneitem.latex);if(paneitem.command)
temp.data('command',paneitem.command);if(paneitem.id)
temp.attr('id','tbpm_item_'+paneitem.id);if(paneitem.wlatex)
temp.data('wlatex',paneitem.wlatex);if(paneitem.mlatex)
temp.data('mlatex',paneitem.mlatex);var div=MEE.Toolbar.appendElement(temp,"div","icon");var img=MEE.Toolbar.AddImage(div,'tbicons/'+paneitem.image);img.css('float','left');MEE.Toolbar.appendElement(temp,"div","label",paneitem.display);}}else if(pane.type=="list"){for(var u=0;u<pane.items.length;u++){var paneitem=pane.items[u];if(!paneitem)continue;temp=MEE.Toolbar.appendElement(pane_elem,"div","tb_"+pane.type);temp.data('latex',paneitem.latex);if(paneitem.command)
temp.data('command',paneitem.command);if(paneitem.id)
temp.attr('id','tbpm_item_'+paneitem.id);if(paneitem.wlatex)
temp.data('wlatex',paneitem.wlatex);if(paneitem.mlatex)
temp.data('mlatex',paneitem.mlatex);if(!paneitem.image)
paneitem.image='blank_1x16.png';var div=MEE.Toolbar.appendElement(temp,"span","icon");var img=MEE.Toolbar.AddImage(div,'tbicons/'+paneitem.image);img.css('float','left');var label=MEE.Toolbar.appendElement(temp,"span","label",paneitem.display);if(paneitem._class)
label.addClass(paneitem._class);if(pane.itemwidth)
temp.css('width',pane.itemwidth+'px');}
if(!pane.itemwidth)
pane.itemwidth=103;itemcount=Math.ceil(pane.items.length/3);pane.width=itemcount*pane.itemwidth;}else if(pane.type=="menus"||pane.type=="hmenus"){var menuclass="tb_menu";var menuimg="toolbar/arrow_down.png";if(pane.type=="hmenus"){menuclass="tb_menu_horiz";menuimg="toolbar/arrow_down-16.png";}
for(var t=0;t<pane.items.length;t++){var paneitem=pane.items[t];if(!paneitem||!paneitem.display){itemcount--;continue;}
var menuitemconta=MEE.Toolbar.appendElement(pane_elem,"div",menuclass);menuitemconta.attr('id',"popupmenubutton"+MEE.Toolbar.popupmenuid);menuitemconta.attr('popuptype',pane.type);menuitemconta.attr('popupmenu',MEE.Toolbar.popupmenuid);menuitemconta.addClass('tb_menu_button');var menuitemcont=MEE.Toolbar.appendElement(menuitemconta,"a");menuitemcont.attr('popupmenu',MEE.Toolbar.popupmenuid);temp=MEE.Toolbar.appendElement(menuitemcont,"div","icon");if(paneitem.image){var img=MEE.Toolbar.AddImage(temp,'tbicons/'+paneitem.image);if(pane.type=="menus"){img.css('margin-left','14px');img.css('margin-right','14px');}}
temp.attr("alt",paneitem.display);temp=MEE.Toolbar.appendElement(menuitemcont,"div","text",paneitem.display);temp=MEE.Toolbar.appendElement(menuitemcont,"div","arrow");var img=MEE.Toolbar.AddImage(temp,menuimg);if(pane.type=="menus"){img.css('margin-left','27px');img.css('margin-right','27px');}
if(!paneitem.sections)continue;var menupopup=MEE.Toolbar.appendElement(main,"div","tb_popupmenu");if(pane.type=="hmenus")
menupopup.addClass("tb_popupmenu_horiz");else
menupopup.addClass("tb_popupmenu_vert");menupopup.css("display","none");menupopup.attr('id',"popupmenu"+MEE.Toolbar.popupmenuid);var menuinner=MEE.Toolbar.appendElement(menupopup,"div","tb_popupmenu_inner");var menufooter=MEE.Toolbar.appendElement(menupopup,"div","tb_popupmenu_footer");if(paneitem.popupwidth)
menuinner.css('width',paneitem.popupwidth+'px');for(var p=0;p<paneitem.sections.length;p++){var section=paneitem.sections[p];if(!section)continue;MEE.Toolbar.appendElement(menuinner,"div","tbpm_header",section.heading);MEE.Toolbar.appendElement(menuinner,"div","clear");if(section.items){for(var q=0;q<section.items.length;q++){var item=section.items[q];if(!item)continue;var _class="tbpm_item";if(section._class)
_class=section._class;var item_elem=MEE.Toolbar.appendElement(menuinner,"div",_class);if(item._class){item_elem.addClass(item._class);item_elem.data('class',item._class);}
if(section.listwidth)
item_elem.css('width',section.listwidth+'px');item_elem.data('latex',item.latex);if(item.wlatex)
item_elem.data('wlatex',item.wlatex);if(item.mlatex)
item_elem.data('mlatex',item.mlatex);item_elem.data('text',item.display);if(item.command)
item_elem.data('command',item.command);if(section.history||pane.history)
item_elem.data('history',1);item_elem=MEE.Toolbar.appendElement(item_elem,"a");var div2=MEE.Toolbar.appendElement(item_elem,"div","icon");if(item.image){MEE.Toolbar.AddImage(div2,'tbicons/'+item.image);}
MEE.Toolbar.appendElement(item_elem,"div","label",item.display);}}}
MEE.Toolbar.popupmenuid++;}}
if(itemcount){if(pane.type=="menus"){pane.width=itemcount*61;}else if(pane.type=="bigicons"){pane.width=itemcount*60;}else if(pane.type=="icons"){itemcount=Math.ceil(itemcount/3);pane.width=itemcount*23;}else if(pane.type=="hmenus"){itemcount=Math.ceil(itemcount/3);pane.width=itemcount*103;}}
if(pane.width){pane_cont.css("width",pane.width);pane_elem.css("width",pane.width);pane_label.css("width",pane.width);}}}
this.toolbarelem=main;if(MEE.Edit.toolbar.activate)
MEE.Edit.toolbar.activate.activate();return main;},initEvents:function(){if(this.eventsinit)
return;this.eventsinit=true;this.hideTabs();$('.mt_tabblock').each(function(){$(this).children('div:last').css('border','none');});this.setMouseImages('.mt_home_popup_item_big');this.setMouseImages('.mt_home_popup_item');this.setMouseImages('.tb_menu_horiz');this.setMouseImages('.tb_menu');this.setMouseImages('.tb_symbol');this.setMouseImages('.tb_bigicons');this.setMouseImages('.tb_list');this.setMouseImages('.tbpm_item');this.setMouseImages('.tbpm_list');this.setMouseImages('.tbpm_listbig');this.setMouseImages('.tbpm_grid');this.setMouseImages('.tbpm_gridbig');this.setMouseImages('.tbpm_gridxbig');$(document).click(this.callback('docClick'));$('.mt_home',this.html_elem).click(this.callback('homeClick'));$('.mt_tab',this.html_elem).children('a').click(this.callback('tabClick'));$('.tb_menu_button',this.html_elem).click(this.callback('menuClick'));$('.tb_symbol',this.html_elem).click(this.callback('itemClick'));$('.tb_bigicons',this.html_elem).click(this.callback('itemClick'));$('.tb_list',this.html_elem).click(this.callback('itemClick'));$('.tbpm_item',this.html_elem).click(this.callback('itemClick'));$('.tbpm_list',this.html_elem).click(this.callback('itemClick'));$('.tbpm_listbig',this.html_elem).click(this.callback('itemClick'));$('.tbpm_grid',this.html_elem).click(this.callback('itemClick'));$('.tbpm_gridbig',this.html_elem).click(this.callback('itemClick'));$('.tbpm_gridxbig',this.html_elem).click(this.callback('itemClick'));$('.mt_home_popup').scale9Grid({top:4,bottom:15,left:4,right:15});MEE.Toolbar.ApplyImage('.mt_home a','toolbar/orb.png');$('.mt_home a').mouseenter(function(){MEE.Toolbar.ApplyImage($(this),'toolbar/orb_hover.png');});$('.mt_home a').mouseleave(function(){MEE.Toolbar.ApplyImage($(this),'toolbar/orb.png');});this.hidePopups();$('.mt_tabblock').hide();},hide:function(){if(this.toolbaralwayson==false){this.toolbarelem.hide();}},hideTabs:function(){this.visopt={};var tabonly=false;if(this.currentEdit){var baseelem=this.currentEdit.inputelement;var classList=$(baseelem).attr('class').split(/\s+/);for(var i=0;i<classList.length;i++){var class_name=classList[i];if(class_name.indexOf(':')>-1){var type=class_name.substr(0,class_name.indexOf(':'));var tabs=class_name.substr(class_name.indexOf(':')+1);tabs=tabs.split(/,/);var show="";if(type=="tabshow")
show="show";if(type=="tabhide")
show="hide";if(type=="tabonly"){tabonly=true;show="show";}
for(var k=0;k<tabs.length;k++){var tab=tabs[k];this.visopt[tab]=show;}}}}
var visopt=this.visopt;$('.mt_tab').each(function(){var visibility=$(this).data('visibility');var id=$(this).data('id');id=id.replace("mee_tab_",'');if(tabonly)
visibility="hide";if(id in visopt)
visibility=visopt[id];visopt[id]=visibility;if(visibility=="hide")
$(this).css('display','none');});},enableTab:function(tabname){if(!this.visopt)
return;if(this.visopt[tabname]=="hide")
return;$('#mee_tab_link_'+tabname).css('display','block');},disableTab:function(tabname){if(!this.visopt)
return;if(this.visopt[tabname]=="hide")
return;$('#mee_tab_link_'+tabname).css('display','none');if(MEE.Toolbar.activetab){var tabid=$(MEE.Toolbar.activetab).attr('href');if(tabid=='#mee_tab_'+tabname)
this.closeTabs();}},docClick:function(e){this.hidePopups();return true;},tabClick:function(e){this.hidePopups();if(MEE.Toolbar.activetab==e){this.closeTabs()}else{if(MEE.Toolbar.activetab!=null){this.closeTabs();}
this.openTab(e);}
if(MEE.Toolbar.activetab==null){$(e).parent().parent().parent().parent().parent().css('height','25px');}else{$(e).parent().parent().parent().parent().parent().css('height','116px');}
if(MEE.Edit.toolbar.currentEdit)
MEE.Edit.toolbar.currentEdit.changed();return false;},closeTabs:function(){if(MEE.Toolbar.activetab){var tabid=$(MEE.Toolbar.activetab).attr('href');$(tabid).hide();$(MEE.Toolbar.activetab).parent().removeClass('mt_tab_active');MEE.Toolbar.activetab=null;this.hideMenus();}},openTab:function(e){var tabid=$(e).attr('href');$(tabid).show();$(e).parent().addClass('mt_tab_active');MEE.Toolbar.activetab=e;},menuClick:function(element){var menuid=$(element).attr('popupmenu');this.hideHome();if(menuid==MEE.Toolbar.curpopupmenu)
return this.hideMenus();if(MEE.Toolbar.curpopupmenu)
this.hideMenus();this.showMenu(menuid);return false;},showMenu:function(menuid){var menu=$('#popupmenu'+menuid);if(menu){menu.css('display','block');if(!$(menu).attr('scaled')){$(menu).children('.tb_popupmenu_footer').scale9Grid({top:0,bottom:0,left:2,right:11});$(menu).scale9Grid({top:4,bottom:15,left:4,right:15});$(menu).attr('scaled',1);}
var menubutton=$('#popupmenubutton'+menuid);$(menu).css('left',menubutton.offset().left+'px');$(menu).css('top',menubutton.offset().top+menubutton.innerHeight()+'px');$(menubutton).trigger('mousedown');$(menubutton).data('showingmenu',1);if(this.currentEdit)
this.currentEdit.focusInput();}
MEE.Toolbar.curpopupmenu=menuid;},hideMenus:function(){if(MEE.Toolbar.curpopupmenu){var menu=$('#popupmenu'+MEE.Toolbar.curpopupmenu);$(menu).css('display','none');var menubutton=$('#popupmenubutton'+MEE.Toolbar.curpopupmenu);$(menubutton).data('showingmenu',0);$(menubutton).trigger('mouseout');MEE.Toolbar.curpopupmenu=null;}},homeClick:function(element){if(this.home_showing){this.hideHome();}else{this.showHome(element);}
return false;},showHome:function(element){this.home_showing=1;var pos=$(element).position();$('.mt_home_popup').css('left',pos.left+4+'px');$('.mt_home_popup').css('top',pos.top+21+'px');$('.mt_home_popup').css('display','block');},hideHome:function(){this.home_showing=0;$('.mt_home_popup').hide();},itemClick:function(item){if(this.currentEdit==null)
return true;this.hidePopups();var command=$(item).data('command');if(command){if(command.indexOf("|")!=-1){var parts=command.split("|");var command=parts.shift();if(parts.length==1){this.currentEdit[command](parts[0]);}else if(parts.length==2){this.currentEdit[command](parts[0],parts[1]);}else if(parts.length==3){this.currentEdit[command](parts[0],parts[1],parts[2]);}else if(parts.length==4){this.currentEdit[command](parts[0],parts[1],parts[2],parts[3]);}}else{this.currentEdit[command]();}}
var latex=$(item).data('latex');var wlatex=$(item).data('wlatex');var mlatex=$(item).data('mlatex');if(latex){this.currentEdit.toolbarCommand(latex,item,wlatex,mlatex);}
return false;},SetHighlighted:function(id){$('#'+id).trigger('mousedown');$('#'+id).data('showingmenu',1);},SetNormal:function(id){$('#'+id).data('showingmenu',0);$('#'+id).trigger('mouseout');},hidePopups:function(){this.hideHome();this.hideMenus();},setMouseImages:function(selector){$(selector,this.html_elem).each(function(){var width=$(this).outerWidth();var height=$(this).outerHeight();var size=width+'x'+height;if(size in MEE.Toolbar.images){if(MEE.Toolbar.images[size]==-1)
return;$(this).mouseover(function(){if($(this).data('showingmenu')==1)
return;MEE.Toolbar.ApplyImage(this,'toolbar/sizes/'+size+'-over.png');});$(this).mouseout(function(){if($(this).data('showingmenu')==1)
return;$(this).css('background-image','');});$(this).mousedown(function(){if($(this).data('showingmenu')==1)
return;MEE.Toolbar.ApplyImage(this,'toolbar/sizes/'+size+'-click.png');});$(this).mouseup(function(){if($(this).data('showingmenu')==1)
return;MEE.Toolbar.ApplyImage(this,'toolbar/sizes/'+size+'-over.png');});}else{icon='tall';MEE.Toolbar.images[size]=-1;if($.browser.msie)
return;var overlaydiv=$('<div>');overlaydiv.css('position','absolute');overlaydiv.css('z-index','2');overlaydiv.css('left','0px');overlaydiv.css('top','0px');overlaydiv.css('width',width+'px');overlaydiv.css('height',height+'px');overlaydiv.data('elem',this);overlaydiv.html('&nbsp;');$(this).css('position','relative');$(overlaydiv).mouseover(function(){var elem=$(this).data('elem');if($(elem).data('showingmenu')==1)
return;$(elem).remove9Grid();$(elem).css('background-image','url('+mee_baseurl+'images/toolbar/base/'+icon+'-over.png)');$(elem).scale9Grid({top:4,bottom:4,left:4,right:4});});$(overlaydiv).mouseout(function(){var elem=$(this).data('elem');if($(elem).data('showingmenu')==1)
return;$(elem).remove9Grid();});$(overlaydiv).mousedown(function(){var elem=$(this).data('elem');if($(elem).data('showingmenu')==1)
return;$(elem).remove9Grid();$(elem).css('background-image','url('+mee_baseurl+'images/toolbar/base/'+icon+'-click.png)');$(elem).scale9Grid({top:4,bottom:4,left:4,right:4});});$(overlaydiv).mouseup(function(){var elem=$(this).data('elem');if($(elem).data('showingmenu')==1)
return;$(elem).remove9Grid();$(elem).css('background-image','url('+mee_baseurl+'images/toolbar/base/'+icon+'-over.png)');$(elem).scale9Grid({top:4,bottom:4,left:4,right:4});});$(overlaydiv).click(function(){});$(this).prepend(overlaydiv);}});}});

$.Class.extend("MEE.Base",{Render:function(source,mcedoc){this.fontwaitlimit=10;MEE.Base.displays=new Array();MEE.Base.edits=new Array();if(!source)
source=document.body;var d=new Date;var eqns=$.makeArray($(source).find("div.mee, span.mee, input.mee").css('color','white'));var d=new Date;async.each(eqns,this.Process,function(){var d=new Date;console.log('MEE DONE '+d.getTime());$('body').trigger('mee/done',[]);});$(document.body).click(this.callback('pageClick'));},pageClick:function(){if(MEE.Edit.toolbar&&MEE.Edit.toolbar.currentEdit){var edit=MEE.Edit.toolbar.currentEdit;if(!$(edit.inputelement).hasClass('activate')){edit.deactivate();}
return false;}
return true;},Process:function(elem,callback){var proc={elem:elem,type:'display',inline:false};if(elem.tagName==='SPAN'){proc.inline=true;}
if(elem.tagName==='INPUT'){delete proc.inline;proc.type='edit';}
if(proc.type=="display"){var meeeqn=new MEE.Display(proc.elem,proc.inline,this.tinymce);MEE.Base.displays.push(meeeqn);proc.eqn=meeeqn;}else if(proc.type=="edit"){var meeeqn=new MEE.Edit(proc.elem);MEE.Base.edits.push(meeeqn);}
async.nextTick(function(){if(proc.eqn)
proc.eqn.Align();$(proc.elem).css('color','');if(!$(proc.elem).hasClass('meeInMCE')){var h=MEE.Base.replacePX(proc.elem.style.height)
+MEE.Base.replacePX(proc.elem.style.paddingTop)
+MEE.Base.replacePX(proc.elem.style.paddingBottom);var elem=proc.elem.parentNode;if(elem.tagName=='SPAN'){elem=elem.parentNode;}
if(elem.tagName=='TD'){elem=elem.parentNode;}
if(h==0&&MEE.Base.replacePX(elem.style.height)==0){elem.style.height='auto';}else if(elem.style.height==''||h>MEE.Base.replacePX(elem.style.height)){elem.style.minHeight=h+'px';elem.style.paddingTop=proc.elem.style.paddingTop;}}else{var w=MEE.Base.calcWidth(proc.elem,0);proc.elem.parentNode.style.width=w+'px';var h=MEE.Base.calcHeight(proc.elem,0);proc.elem.parentNode.style.height=h+'px';}
callback();});},ProcessNext_Fonts:function(){this.fontwaitlimit--;i=MEE.Base.current;if(i>=MEE.Base.to_process.length){MEE.Base.removeProgress();return;}
var proc=this.to_process[i];if(proc.eqn&&this.fontwaitlimit>0){if(!proc.eqn.FontsLoaded()){this.setProgressMessage("Waiting on Fonts");setTimeout("MEE.Base.ProcessNext_Fonts()",5);return;}}
setTimeout("MEE.Base.ProcessNext_Align()",5);},replacePX:function(val){val=parseInt(val);if(!val||val=='NaN'){return 0;}else{return val;}},calcWidth:function(e,w){if(e.childNodes){for(var i=0;i<e.childNodes.length;i++){if(e.childNodes[i].style){je=$(e.childNodes[i]);if(je.width()>w)
w+=je.width();}
w=this.calcWidth(e.childNodes[i],w);}
return w;}
return 0;},calcHeight:function(e,h){if(e.childNodes){for(var i=0;i<e.childNodes.length;i++){if(e.childNodes[i].style){je=$(e.childNodes[i]);h+=je.height();}
h=this.calcWidth(e.childNodes[i],h);}
return h;}
return 0;}},{});$.Class.extend("MEE.Align",{width:0,height:0,top:0,bottom:0,init:function(){},Merge:function(align){this.width+=align.width;if(this.height==0){this.height=align.height;}else{if(align.top>this.top)
this.height+=align.top-this.top;if(align.bottom>this.bottom)
this.height+=align.bottom-this.bottom;}
this.top=Math.max(this.top,align.top);this.bottom=Math.max(this.bottom,align.bottom);},toString:function(){return"w "+this.width+" h "+this.height+" t "+this.top+" b "+this.bottom;}});

MEE.Data.images={'toolbar/arrow_down.png':{left:0,top:0,width:5,height:3},'toolbar/arrow.png':{left:5,top:0,width:4,height:7},'toolbar/home_spacer.png':{left:9,top:0,width:16,height:13},'tbicons/frac-menu.png':{left:25,top:0,width:16,height:16},'tbicons/dots.png':{left:41,top:0,width:16,height:16},'tbicons/row_insert.png':{left:57,top:0,width:16,height:16},'tbicons/col_insert.png':{left:73,top:0,width:16,height:16},'tbicons/row_delete.png':{left:89,top:0,width:16,height:16},'tbicons/row_append.png':{left:105,top:0,width:16,height:16},'tbicons/isotope.png':{left:121,top:0,width:16,height:16},'tbicons/col_delete.png':{left:137,top:0,width:16,height:16},'tbicons/mod.png':{left:153,top:0,width:16,height:16},'tbicons/col_append.png':{left:169,top:0,width:16,height:16},'toolbar/arrow_down-16.png':{left:185,top:0,width:5,height:16},'tbicons/blank_1x16.png':{left:190,top:0,width:1,height:16},'tbicons/accents.png':{left:191,top:0,width:16,height:16},'toolbar/arrow-16.png':{left:207,top:0,width:4,height:16},'tbicons/textrm.png':{left:211,top:0,width:16,height:16},'tbicons/textbf.png':{left:227,top:0,width:16,height:16},'tbicons/textit.png':{left:243,top:0,width:16,height:16},'tbicons/sqrt-menu.png':{left:259,top:0,width:16,height:16},'toolbar/sizes/100x22-over.png':{left:275,top:0,width:100,height:22},'toolbar/sizes/100x22-click.png':{left:375,top:0,width:100,height:22},'toolbar/orb.png':{left:475,top:0,width:56,height:22},'toolbar/sizes/102x22-click.png':{left:531,top:0,width:102,height:22},'toolbar/orb_hover.png':{left:633,top:0,width:56,height:22},'toolbar/sizes/75x22-click.png':{left:689,top:0,width:75,height:22},'toolbar/sizes/102x22-over.png':{left:0,top:22,width:102,height:22},'toolbar/sizes/110x22-click.png':{left:102,top:22,width:110,height:22},'toolbar/sizes/110x22-over.png':{left:212,top:22,width:110,height:22},'toolbar/sizes/22x22-click.png':{left:322,top:22,width:22,height:22},'toolbar/sizes/75x22-over.png':{left:344,top:22,width:75,height:22},'toolbar/sizes/22x22-over.png':{left:419,top:22,width:22,height:22},'toolbar/sizes/50x24-over.png':{left:441,top:22,width:50,height:24},'toolbar/sizes/53x24-click.png':{left:491,top:22,width:53,height:24},'toolbar/sizes/50x24-click.png':{left:544,top:22,width:50,height:24},'toolbar/sizes/64x24-over.png':{left:594,top:22,width:64,height:24},'toolbar/sizes/53x24-over.png':{left:658,top:22,width:53,height:24},'toolbar/sizes/130x24-click.png':{left:0,top:46,width:130,height:24},'toolbar/sizes/96x24-click.png':{left:130,top:46,width:96,height:24},'toolbar/sizes/100x24-over.png':{left:226,top:46,width:100,height:24},'toolbar/sizes/100x24-click.png':{left:326,top:46,width:100,height:24},'toolbar/sizes/96x24-over.png':{left:426,top:46,width:96,height:24},'toolbar/sizes/64x24-click.png':{left:522,top:46,width:64,height:24},'toolbar/sizes/130x24-over.png':{left:586,top:46,width:130,height:24},'toolbar/sizes/32x32-click.png':{left:716,top:46,width:32,height:32},'toolbar/sizes/32x32-over.png':{left:748,top:46,width:32,height:32},'toolbar/home_undo_g.png':{left:0,top:78,width:32,height:32},'toolbar/sizes/220x32-over.png':{left:32,top:78,width:220,height:32},'toolbar/sizes/220x32-click.png':{left:252,top:78,width:220,height:32},'toolbar/home_redo.png':{left:472,top:78,width:32,height:32},'toolbar/home_undo.png':{left:504,top:78,width:32,height:32},'toolbar/home_tick.png':{left:536,top:78,width:32,height:32},'toolbar/home_tick_blank.png':{left:568,top:78,width:32,height:32},'toolbar/home_redo_g.png':{left:600,top:78,width:32,height:32},'tbicons/trig.png':{left:632,top:78,width:32,height:32},'tbicons/log.png':{left:664,top:78,width:32,height:32},'tbicons/bracket_lsize.png':{left:696,top:78,width:32,height:32},'tbicons/matrix-menu.png':{left:728,top:78,width:32,height:32},'tbicons/brackets.png':{left:760,top:78,width:32,height:32},'tbicons/boxed.png':{left:0,top:110,width:32,height:32},'tbicons/bracket_ltype.png':{left:32,top:110,width:32,height:32},'tbicons/bracket_rsize.png':{left:64,top:110,width:32,height:32},'tbicons/font.png':{left:96,top:110,width:32,height:32},'tbicons/chem.png':{left:128,top:110,width:32,height:32},'tbicons/bracket_rtype.png':{left:160,top:110,width:32,height:32},'tbicons/frac.png':{left:192,top:110,width:32,height:32},'tbicons/greek.png':{left:224,top:110,width:32,height:32},'tbicons/bonds.png':{left:256,top:110,width:32,height:32},'tbicons/basic.png':{left:288,top:110,width:32,height:32},'tbicons/superscript.png':{left:320,top:110,width:32,height:32},'tbicons/subscript.png':{left:352,top:110,width:32,height:32},'tbicons/symbols.png':{left:384,top:110,width:32,height:32},'tbicons/text.png':{left:416,top:110,width:32,height:32},'toolbar/home_clear.png':{left:448,top:110,width:32,height:32},'tbicons/sqrt.png':{left:480,top:110,width:32,height:32},'tbicons/sqrt-n.png':{left:512,top:110,width:32,height:32},'tbicons/reactions.png':{left:544,top:110,width:32,height:32},'tbicons/operators.png':{left:576,top:110,width:32,height:32},'tbicons/relations.png':{left:608,top:110,width:32,height:32},'tbicons/sqrt-3.png':{left:640,top:110,width:32,height:32},'tbicons/arrows.png':{left:672,top:110,width:32,height:32},'tbicons/sqrt-4.png':{left:704,top:110,width:32,height:32},'toolbar/sizes/220x35-over.png':{left:0,top:142,width:220,height:35},'toolbar/sizes/220x35-click.png':{left:220,top:142,width:220,height:35},'toolbar/sizes/120x36-click.png':{left:440,top:142,width:120,height:36},'toolbar/sizes/100x36-over.png':{left:560,top:142,width:100,height:36},'toolbar/sizes/100x36-click.png':{left:660,top:142,width:100,height:36},'toolbar/sizes/160x36-over.png':{left:0,top:178,width:160,height:36},'toolbar/sizes/120x36-over.png':{left:160,top:178,width:120,height:36},'toolbar/sizes/160x36-click.png':{left:280,top:178,width:160,height:36},'toolbar/home_raw.png':{left:440,top:178,width:55,height:55},'toolbar/home_wysiwyg.png':{left:495,top:178,width:55,height:55},'toolbar/sizes/220x58-click.png':{left:550,top:178,width:220,height:58},'toolbar/sizes/220x58-over.png':{left:0,top:236,width:220,height:58},'toolbar/sizes/64x64-click.png':{left:220,top:236,width:64,height:64},'tbicons/idotsint.png':{left:284,top:236,width:64,height:64},'toolbar/sizes/64x64-over.png':{left:348,top:236,width:64,height:64},'toolbar/sizes/60x69-over.png':{left:412,top:236,width:60,height:69},'toolbar/sizes/60x69-click.png':{left:472,top:236,width:60,height:69},'toolbar/divider.png':{left:532,top:236,width:3,height:90},'tbicons/matrix1.png':{left:535,top:236,width:96,height:96},'toolbar/sizes/96x96-click.png':{left:631,top:236,width:96,height:96},'toolbar/sizes/96x96-over.png':{left:0,top:332,width:96,height:96},'tbicons/matrix2.png':{left:96,top:332,width:96,height:96},'tbicons/matrix3.png':{left:192,top:332,width:96,height:96},'tbicons/matrix5.png':{left:288,top:332,width:96,height:96},'tbicons/matrix4.png':{left:384,top:332,width:96,height:96},'tbicons/matrix6.png':{left:480,top:332,width:96,height:96},'zzz':'zzz'};

$.Class.extend("MEE.Undo",{init:function(initial){MEE_Undo=this;this.items=new Array();if(initial){this.items.push(initial);this.position=0;}else{this.position=-1;}},Add:function(item){if(this.position!=this.items.length-1){this.items=this.items.splice(0,this.position+1);}
this.items.push(item);this.position=this.items.length-1;},CurrentUndo:function(){if(!this.canUndo())
return null;var item=this.items[this.position];return item;},Undo:function(){if(!this.canUndo())
return null;var item=this.items[this.position-1];this.position--;return item;},Redo:function(){if(!this.canRedo())
return null;var item=this.items[this.position+1];this.position++;return item;},canUndo:function(){if(this.items.length<2)
return false;if(this.position==0)
return false;return true;},canRedo:function(){if(this.items.length<2)
return false;if(this.position==this.items.length-1)
return false;return true;},dump:function(){var res="<pre>";res+="Position : "+this.position+"\n";for(var i=0;i<this.items.length;i++){res+=i+": "+this.items[i].latex+"\n";}
res+="</pre>";return res;}});

$.Class.extend("MEE.SymHist",{init:function(){this.items={};this.sets=5;this.perset=3;this.max=this.sets*this.perset;for(var i=0;i<this.sets;i++)
this.LoadFromCookie("symhist"+i);},LoadFromCookie:function(name){var ser=$.cookie(name);var items=$.parseJSON(ser);if(!items)
return;for(var i=0;i<items.length;i++)
this.items[items[i].latex]=items[i];},SaveToCookie:function(name,item){var ser=JSON.stringify(item);$.cookie(name,ser,{expires:30});},Add:function(item){var i=$(item);var hist={text:i.data('text'),latex:i.data('latex'),_class:i.data('class'),when:new Date().getTime()};this.items[hist.latex]=hist;this.SortItems();},SortItems:function(){var a=new Array();$.each(this.items,function(key,item){a.push(item);});a.sort(function(l,r){return l.when<r.when;});this.items={};var output=new Array();for(var i=0;i<this.sets;i++)
output[i]=new Array();var count=Math.min(this.max,a.length);for(var i=0;i<count;i++){if(!a[i])
continue;this.items[a[i].latex]=a[i];var set=i%this.perset;output[set].push(a[i]);}
for(var i=0;i<this.sets;i++)
this.SaveToCookie("symhist"+i,output[i]);this.SortToolbar();var k=0;},SortToolbar:function(){var tbpane=$('#mt_pane_elem_recentsym');tbpane.children().remove();var count=0;var a=new Array();$.each(this.items,function(key,item){a.push(item);});a.sort(function(a,b){return((a.latex.toLowerCase()==b.latex.toLowerCase())?0:((a.latex.toLowerCase()>b.latex.toLowerCase())?1:-1));});for(var i=0;i<a.length;i++){var obj=a[i];var div=$('<div>');div.addClass('tb_symbol');div.addClass('tb_recent');if(obj._class)
div.addClass(obj._class);div.data('latex',obj.latex);var link=$('<a>');link.html(obj.text);div.append(link);tbpane.append(div);div.css('width','22px');div.css('height','22px');div.click(this.callback('itemClick'));count++;}
MEE.Edit.toolbar.setMouseImages($('.tb_recent'));if(tbpane[0]){var parent=tbpane[0].parentNode;if(count<4)count=4;var width=Math.ceil(count/3)*23;$(parent).css('width',width+'px');$(parent).children().css('width',width+'px');}},itemClick:function(item){if(MEE.Edit.toolbar.currentEdit==null)
return true;var latex=$(item).data('latex');if(latex){MEE.Edit.toolbar.currentEdit.toolbarCommand(latex,item);}
return true;}});

$.Class.extend("MEE.Font",{fontsLoaded:Array(),inited:false,init:function(){$().ready(function(){MEE.Font.fontdiv=$('<div>');MEE.Font.fontdiv.html("YAY!");$('.testme').append(MEE.Font.fontdiv);var base=$('<span>');MEE.Font.fontdiv.append(base);base.html("ml&#x02DC;&#x2211;");base.css('font-size','72px');MEE.Font.base_width=base.outerWidth(true);MEE.Font.base_height=base.outerHeight(true);base.remove();});},isLoaded:function(font){if(font in this.fontsLoaded)
return true;if(this.checkFontLoaded(font)){this.fontsLoaded[font]=1;return true;}
return false;},checkFontLoaded:function(font){var base=$('<span>');this.fontdiv.append(base);base.css('font-family',font);base.html("ml&#x02DC;&#x2211;");base.css('font-size','72px');var width=base.outerWidth(true);var height=base.outerHeight(true);base.remove();if(width==this.base_width&&height==this.base_height){return false;}
this.fontsLoaded[font]=1;return true;}},{});

$.Class.extend("MEE.Maxima",{Convert:function(elementset){var maxima_parser=new MEE.Maxima();var maxima=maxima_parser.ProcessSet(elementset);return maxima;}},{init:function(token,eldata){this.parser=new MEE.Parser();},ProcessSet:function(elementset){var m_elems;var settype=elementset._name;if(settype=="MEE.ElemSetNormal"){m_elems=this.ProcessSet_Normal(elementset);}else if(settype=="MEE.ElemSetArray"){m_elems=this.ProcessSet_Array(elementset);}
var output="";var lastel={};lastel.type="";lastel.maxima="";m_elems.push(lastel);m_elems2=new Array();for(var i=0;i<m_elems.length-1;i++){var elm=m_elems[i];var nextel=m_elems[i+1];if(elm.type=="")
continue;if(elm.type=="digit"){for(var k=i+1;k<m_elems.length-1;k++){var elm2=m_elems[k];if(elm2.type=="digit"){elm.maxima+=elm2.maxima;}else{break;}}
i=k-1;m_elems2.push(elm);}else if(elm.type=="function"){if(elm.args==1){elm.maxima=" "+elm.maxima+"("+nextel.maxima+") ";i++;}else{output+=" "+elm.maxima+" ";}
m_elems2.push(elm);}else{m_elems2.push(elm);}}
m_elems2.push(lastel);for(var i=0;i<m_elems2.length-1;i++){var elm=m_elems2[i];var nextel=m_elems2[i+1];if(elm.type=="operator"){output+=" "+elm.maxima+" ";}else{output+=elm.maxima;}
if(nextel.type!=""&&elm.type!="operator"&&nextel.type!="operator"){output+=" * ";}}
if(m_elems2.length>2)
output="("+output+")";return output;},ProcessSet_Normal:function(elementset){var m_elems=new Array();for(var i=0;i<elementset.elements.length;i++){var elem=elementset.elements[i];if(elem._name=="MEE.ElemInput")
continue;if(elem.latex=="")
continue;var el_maxima=this.ProcessElem(elem);m_elems.push(el_maxima);}
return m_elems;},ProcessSet_Basic:function(elementset){var m_elems=new Array();return m_elems;},ProcessSet_Array:function(elementset){var m_elems=new Array();if(elementset.eldata.base=="base_matrix"){var m="matrix (";for(var r=0;r<elementset.rows;r++){var row=elementset['row'+r];m+="[";for(var c=0;c<row.cols;c++){var col=row['col'+c];m+=this.ProcessSet(col);if(c+1<row.cols)
m+=", ";}
m+="]";if(r+1<elementset.rows)
m+=", ";}
m+=")";var elm={type:"matrix",maxima:m};}else{var top=elementset.row0.col0;var bottom=elementset.row1.col0;var topm=this.ProcessSet(top);var bottomm=this.ProcessSet(bottom);var elm={type:"fraction",maxima:"("+topm+")/("+bottomm+")"};}
m_elems.push(elm);return m_elems;},ProcessElem:function(elem){var el_maxima={elem:elem,type:this.GetElementType(elem)};this.GetElementMaxima(elem,el_maxima);return el_maxima;},GetElementType:function(elem){var eldata=this.parser.getElementData(elem);if(eldata._name=="variable")
return"variable";if(eldata._name=="digit")
return"digit";if(eldata._name==".")
return"digit";if(eldata.base=="base_binary")
return"operator";if(eldata.base=="base_greek")
return"greek";if(eldata.base=="base_matrix")
return"matrix";if(eldata.base=="base_names")
return"function";if(elem.latex=="pbrackets")
return"brackets";if(elem.latex=="frac")
return"fraction";if(elem.latex=="sqrt")
return"root";return"";},GetElementMaxima:function(elem,el_maxima){var do_sup=true;if(el_maxima.type=="digit"){el_maxima.maxima=elem.latex;}else if(el_maxima.type=="variable"){el_maxima.maxima=elem.latex;}else if(el_maxima.type=="greek"){el_maxima.maxima="%"+elem.latex;}else if(el_maxima.type=="operator"||el_maxima.type=="function"){var op=elem.latex;var mapping=MEE.Maxima.Mappings[op];if(!mapping)
return;el_maxima.maxima=mapping.maxima;el_maxima.args=mapping.args;}else if(el_maxima.type=="brackets"){el_maxima.maxima="("+this.ProcessSet(elem.main)+")";}else if(el_maxima.type=="fraction"||el_maxima.type=="matrix"){el_maxima.maxima=this.ProcessSet(elem.main);}else if(el_maxima.type=="root"){do_sup=false;var ssmaxima;if(elem.superscript)
ssmaxima=this.ProcessSet(elem.superscript);if(ssmaxima){el_maxima.maxima="("+this.ProcessSet(elem.main)+")^(1/"+ssmaxima+")";}else{el_maxima.maxima="sqrt("+this.ProcessSet(elem.main)+")";}}
if(do_sup&&elem.superscript){var ssmaxima=this.ProcessSet(elem.superscript);if(ssmaxima!="")
el_maxima.maxima=el_maxima.maxima+"^"+ssmaxima;}}});MEE.Maxima.Mappings={'sin':{maxima:'sin',args:1},'cos':{maxima:'cos',args:1},'tan':{maxima:'tan',args:1},'sinh':{maxima:'sinh',args:1},'cosh':{maxima:'cosh',args:1},'tanh':{maxima:'tanh',args:1},'arcsin':{maxima:'asin',args:1},'arccos':{maxima:'acos',args:1},'arctan':{maxima:'atan',args:1},'log':{maxima:'log',args:1},'sqrt':{maxima:'sqrt',args:1},'exp':{maxima:'exp',args:1},'+':{maxima:'+'},'-':{maxima:'-'},'times':{maxima:'*'}};
